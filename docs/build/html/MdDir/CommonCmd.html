<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>常用命令 &mdash; MD 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="常见问题" href="CommonProblem.html" />
    <link rel="prev" title="Welcome to Py’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MD
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Welcome to Py’s documentation!</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">常用命令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#grep">1. grep</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sed">2. sed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#awk">3. awk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scp">4. scp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netcat">5. netcat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-parts">6. run-parts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lsscsi">7. lsscsi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#umask">8. umask</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pgrep">9. pgrep</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inotify">10. inotify</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iptables">11. 10 iptables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script">12. script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ssh">13. ssh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sshpass">14. sshpass</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">15. ssh免密登陆</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diff">16. diff</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stat">17. stat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netstat">18. netstat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pidstat">19. pidstat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iostat">20. iostat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chroot">21. chroot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ldd">22. ldd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#susu">23. su和su -</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cut">24. cut</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">25. 24 释放内存</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">26. 硬件查询命令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lsusb">26.1. 25.1 lsusb</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lspci">26.2. 25.2 lspci</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lsblk">26.3. 25.3 lsblk</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blkid">26.4. blkid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#find">27. find</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chown">28. chown</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">29. 标准输入和标准输出</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dd">30. dd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sync">31. sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xargs">32. xargs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fuser">33. fuser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sort">34. sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uniq">35. uniq</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tr">36. tr</a></li>
<li class="toctree-l3"><a class="reference internal" href="#split">37. split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#paste">38. paste</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eval">39. eval</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">40. 守护进程</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shift">41. shift</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mountpoint">42. mountpoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mount">43. mount</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lsmod">44. lsmod</a></li>
<li class="toctree-l3"><a class="reference internal" href="#depmod-depend-module">45. depmod（depend module）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modprobe">46. modprobe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ldconfig">47. ldconfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cp">48. cp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install">49. install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setcap">50. setcap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#md5sum">51. md5sum</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id">52. id</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arp">53. arp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">53.1. arp协议</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">53.2. ARP的作用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tcparp">53.3. 建立TCP连接与ARP的关系</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">53.4. 工作流程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">53.5. arp缓存</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">53.6. arp帧格式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">53.7. 免费arp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">53.8. 代理arp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">53.9. arp命令</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#faillog">54. faillog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">55. 用户相关</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sshsftp">56. ssh和sftp服务分离</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xdotool">57. xdotool</a></li>
<li class="toctree-l3"><a class="reference internal" href="#free">58. free</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tee">59. tee</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lsof">60. lsof</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ulimit">61. ulimit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tar">62. tar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#echo">63. echo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcpdump">64. tcpdump</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nmap">65. nmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#top">66. top</a></li>
<li class="toctree-l3"><a class="reference internal" href="#watch">67. watch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read">68. read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipmitool">69. ipmitool</a></li>
<li class="toctree-l3"><a class="reference internal" href="#history">70. history</a></li>
<li class="toctree-l3"><a class="reference internal" href="#man">71. man</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vim">72. vim？？？？？？？？</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utmpdump">73. utmpdump</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timedatectl">74. timedatectl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ping">75. ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xxd">76. xxd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">77. 文件 相关命令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#iconv">77.1. iconv</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file">77.2. file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#string">77.3. string</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id17">78. 磁盘相关命令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wipefs">78.1. wipefs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvs">78.2. pvs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvcreate">78.3. pvcreate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvremove">78.4. pvremove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vgs">78.5. vgs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vgcreate">78.6. vgcreate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vgremove">78.7. vgremove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lvs">78.8. lvs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lvcreate">78.9. lvcreate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lvremove">78.10. lvremove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mdadm">78.11. mdadm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vgdisplay">78.12. vgdisplay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvmove">78.13. pvmove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdparm">78.14. hdparm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#renice">79. renice</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sar">80. sar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#swap-off">81. swap off</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netdata">82. netdata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quota">83. quota</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dump">84. dump</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restore">85. restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sos">86. sos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aide">87. aide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suricata">88. suricata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jq">89. jq</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gnone">90. gnone桌面相关命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rev">91. rev</a></li>
<li class="toctree-l3"><a class="reference internal" href="#type">92. type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="CommonProblem.html">常见问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="OsBase.html">操作系统基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="ShellScript.html">shell脚本</a></li>
<li class="toctree-l2"><a class="reference internal" href="Systemd.html">systemd服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="ZStack.html">ZStack</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Welcome to Py’s documentation!</a></li>
      <li class="breadcrumb-item active">常用命令</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/MdDir/CommonCmd.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>常用命令<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<section id="grep">
<h2>1. grep<a class="headerlink" href="#grep" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grep</span></code>：查找匹配模式的行，grep对文本内容的处理是以行为单位，输出也是输出匹配的行。</p>
<ul>
<li><p>grep：仅支持基本正则表达式</p></li>
<li><p>egrep：支持扩展正则表达式。等同于<code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-E</span></code></p></li>
<li><p>fgrep：不支持正则表达式（所有元字符都当作普通字符处理）。等同于<code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-F</span></code>。如<code class="docutils literal notranslate"><span class="pre">fgrep</span> <span class="pre">&quot;^test&quot;</span> <span class="pre">test.txt</span></code>：匹配的是包含 ^test 的行，而在grep中匹配的是以test开头的行。</p>
<ul class="simple">
<li><p>基本正则表达式和扩展正则表达式</p>
<ul>
<li><p>基本正则表达式（BRE）：只承认<code class="docutils literal notranslate"><span class="pre">^</span></code>  <code class="docutils literal notranslate"><span class="pre">$</span></code>  <code class="docutils literal notranslate"><span class="pre">.</span></code>  <code class="docutils literal notranslate"><span class="pre">[</span></code>  <code class="docutils literal notranslate"><span class="pre">]</span></code>  <code class="docutils literal notranslate"><span class="pre">*</span></code> 这些是元字符，所有其他的字符都被识别为普通字符。</p></li>
<li><p>扩展正则表达是（ERE）：在BRE的基础上增加了<code class="docutils literal notranslate"><span class="pre">(</span></code>  <code class="docutils literal notranslate"><span class="pre">)</span></code>  <code class="docutils literal notranslate"><span class="pre">{</span></code>  <code class="docutils literal notranslate"><span class="pre">}</span></code>  <code class="docutils literal notranslate"><span class="pre">?</span></code>  <code class="docutils literal notranslate"><span class="pre">+</span></code>  <code class="docutils literal notranslate"><span class="pre">|</span></code> 等元字符。</p></li>
<li><p>注：只有在用反斜杠进行转义的情况下，字符<code class="docutils literal notranslate"><span class="pre">(</span></code>  <code class="docutils literal notranslate"><span class="pre">)</span></code>  <code class="docutils literal notranslate"><span class="pre">{</span></code>  <code class="docutils literal notranslate"><span class="pre">}</span></code>才会在扩展正则表达式（ERE）中被当作元字符处理，而在基本正则表达式（ERE）中，任何元字符前面加上反斜杠反而会使其被当作普通字符来处理。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>语法：grep [选项1] [选项2]… 匹配内容 [文件1] [文件2]…</p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">F</span><span class="err">：</span><span class="n">不支持正则表达式</span>
<span class="o">-</span><span class="n">E</span><span class="err">：</span><span class="n">支持ERE</span>
<span class="o">-</span><span class="n">P</span><span class="err">：</span><span class="n">支持Perl语言的正则表达式</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">取反</span><span class="err">。</span>
<span class="o">-</span><span class="n">i</span><span class="err">：</span><span class="n">忽略大小写</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">显示匹配的行号</span>
<span class="o">-</span><span class="n">w</span><span class="err">：</span><span class="n">匹配整个单词</span>
<span class="o">-</span><span class="n">l</span><span class="err">：</span> <span class="n">打印包含匹配项的文件名</span><span class="err">，</span><span class="n">而不是文本行本身</span> <span class="c1"># grep -l &quot;first&quot; *.txt：找出内容中含有first单词的.txt文件</span>
<span class="o">-</span><span class="n">L</span><span class="err">：</span><span class="n">相似于</span><span class="o">-</span><span class="n">l</span> <span class="n">选项</span><span class="err">，</span><span class="n">但是只是打印不包含匹配项的文件名</span> <span class="c1"># grep -l &quot;first&quot; *.txt：找出内容中不含有first单词的.txt文件</span>
<span class="o">-</span><span class="n">A</span> <span class="n">n</span><span class="err">：</span><span class="n">匹配行及匹配行的下面n行的内容</span><span class="err">（</span><span class="n">after</span><span class="err">）</span>
<span class="o">-</span><span class="n">B</span> <span class="n">n</span><span class="err">：</span><span class="n">匹配行及匹配行上面面n行的内容</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
<span class="o">-</span><span class="n">C</span> <span class="n">n</span><span class="err">：</span><span class="n">匹配行及匹配行的上面n行和下面n行的内容</span>
<span class="o">-</span><span class="n">q</span><span class="err">：</span><span class="n">安静模式</span><span class="err">，</span><span class="n">不打印任何标准输出</span><span class="err">。</span><span class="n">如果有匹配的内容返回状态值0</span><span class="err">。</span>
<span class="o">-</span><span class="n">d</span> <span class="n">action</span><span class="err">：</span><span class="n">读取目录的方式</span><span class="err">。</span><span class="n">action可以为read</span><span class="o">/</span><span class="n">recurse</span><span class="o">/</span><span class="n">skip</span><span class="err">。</span><span class="n">read</span><span class="p">:</span><span class="n">可以认为是默认的模式</span><span class="err">，</span><span class="n">只读取文件进行过滤</span><span class="err">，</span><span class="n">读取到目录会报错</span><span class="err">；</span><span class="n">rescurse</span><span class="p">:</span><span class="n">递归过滤目录和子目录下的所有文件</span><span class="err">；</span><span class="n">skip</span><span class="p">:</span><span class="n">是目录就跳过</span><span class="err">，</span><span class="n">只读取文件进行过滤</span><span class="err">。</span>
	<span class="c1"># grep -d read umask /etc/*：遇见目录时会报错 xxx:是一个目录，并不会读取，只读取文件进行过滤</span>
	<span class="c1"># grep -d recurse umask /etc/：递归过滤目录和子目录下的所有文件</span>
	<span class="c1"># grep -d skip umask /etc/* :遇见目录时会跳过，不会报错，只读取文件进行过滤</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">等同于</span><span class="o">-</span><span class="n">d</span> <span class="n">recurse递归搜索目录中的所有文件</span><span class="err">，</span><span class="n">将在当前目录及其子目录中的所有文件中搜索给定的模式</span><span class="err">。</span>
<span class="o">-</span><span class="n">H</span><span class="err">：</span><span class="n">为输出行打印文件名</span>
<span class="o">-</span><span class="n">h</span><span class="err">：</span><span class="n">输出时不显示文件名前缀</span>
<span class="o">--</span><span class="n">label</span><span class="o">=</span><span class="n">LABEL</span><span class="err">：</span><span class="n">将给定</span><span class="o">&lt;</span><span class="n">标签</span><span class="o">&gt;</span><span class="n">作为标准输入文件名前缀</span><span class="err">，</span><span class="n">主要用于管道</span>
	<span class="c1"># echo -e &quot;hello\n007&quot;  | grep --label=test -H 007</span>
	<span class="c1"># 输出： test:007</span>
<span class="o">-</span><span class="n">m</span> <span class="n">num</span><span class="err">：</span><span class="n">得到给定num次匹配后停止</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="sed">
<h2>2. sed<a class="headerlink" href="#sed" title="Link to this heading">¶</a></h2>
<ul>
<li><p>sed 命令是一个面向行处理的工具，它以“行”为处理单位，针对每一行进行处理，处理后的结果会输出到标准输出（STDOUT）。它不会对读取的文件做任何贸然的修改（除非加-i参数），而是将内容都输出到标准输出中。</p></li>
<li><p>sed的工作原理</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span></code> 命令是面向“行”进行处理的，每一次处理一行内容。处理时，sed 会把要处理的行存储在缓冲区中，接着用 sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。这个缓冲区被称为“模式空间”（pattern space）。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span></code>命令</p>
<ul>
<li><p>语法：sed [参数] ‘&lt;匹配条件&gt; [动作]’ [文件名]</p>
<ul>
<li><p>参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>：仅显示sed处理过的行;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span></code>：表示对文件进行编辑（不加-i只能看到处理后的结果不能修改文件）;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e</span></code>：设置多个 command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span></code>：支持扩展正则表达式（ERE）</p></li>
</ul>
</li>
<li><p>匹配条件：<code class="docutils literal notranslate"><span class="pre">'/关键字/'</span></code>关键字匹配，<code class="docutils literal notranslate"><span class="pre">/</span></code>可以换为<code class="docutils literal notranslate"><span class="pre">&#64;</span> <span class="pre">#</span> <span class="pre">！</span></code>; <code class="docutils literal notranslate"><span class="pre">'1,2'p</span></code>数字行号匹配</p></li>
<li><p>动作：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="err">：</span><span class="n">在匹配到的内容下一行增加内容</span>
<span class="n">i</span><span class="err">：</span><span class="n">在匹配到的内容上一行增加内容</span>
<span class="n">c</span><span class="err">：</span><span class="n">替换匹配到的当前行</span>
<span class="n">d</span><span class="err">：</span><span class="n">删除匹配到的内容</span>
<span class="n">s</span><span class="err">：</span><span class="n">替换匹配到的内容</span>
<span class="n">p</span><span class="err">：</span><span class="n">打印</span><span class="err">，</span><span class="n">指定了行则打印指定行</span><span class="err">，</span><span class="n">未指定打印所有</span>
<span class="n">r</span><span class="err">：</span><span class="n">将内容读入匹配到的行后面</span><span class="err">，</span><span class="n">如果匹配多行</span><span class="err">，</span><span class="n">则内容将显示在所有匹配行的下面</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;123</span><span class="se">\n</span><span class="s2">abc</span><span class="se">\n</span><span class="s2">454&quot;</span> <span class="o">|</span> <span class="n">sed</span> <span class="s2">&quot;2p&quot;</span>
<span class="c1"># 输出结果为：</span>
<span class="mi">123</span>
<span class="n">abc</span>
<span class="n">abc</span>
<span class="mi">454</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;123</span><span class="se">\n</span><span class="s2">abc</span><span class="se">\n</span><span class="s2">454&quot;</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;2p&quot;</span>
<span class="c1"># 输出结果为</span>
<span class="mi">123</span>
<span class="n">abc</span>
<span class="mi">454</span>
</pre></div>
</div>
<ul class="simple">
<li><p>以上可以看出不加<code class="docutils literal notranslate"><span class="pre">-n</span></code>参数时所有的原始文件内容都被输出来了，而且第二行被输出了两遍，但这就是 sed 命令的工作原理，它会不问青红皂白地把经过处理的行先输出出来，然后再执行后面的动作。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>选项会很严肃地警告 sed 命令：除非是明确表明要输出的行，否则不要给我胡乱输出。<code class="docutils literal notranslate"><span class="pre">-n</span></code>选项经常和 <code class="docutils literal notranslate"><span class="pre">p</span></code> 配合使用，其含义就是，输出那些匹配的行。</p></li>
</ul>
</li>
<li><p>替换文件中的内容：<code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'s/old/new/g'</span> <span class="pre">file</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code>：全局替换;不加g只会替换每一行的第一个匹配到的内容;<code class="docutils literal notranslate"><span class="pre">2g</span> <span class="pre">3g...</span></code>表示从每一行的第2,3…个匹配到的内容开始全部替换。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'行号s/old/new/列号'</span> <span class="pre">file</span></code>：替换第几行的第几个匹配到的内容。不加行号，表示替换每行匹配到的内容。</p></li>
</ul>
</li>
<li><p>删除：<code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'n1,n2d'</span> <span class="pre">文件名</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;/^$/d&#39;</span> <span class="n">file</span> <span class="c1">#删除空白行</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;$d&#39;</span> <span class="n">file</span> <span class="c1">#删除最后一行</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;2,$d&#39;</span> <span class="n">file</span> <span class="c1">#删除第二行到最后一行</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;/^test/d&#39;</span> <span class="n">file</span> <span class="c1">#删除所有一test开头的行</span>
</pre></div>
</div>
</li>
<li><p>n=<code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">.....</span></code>：将sed的输出赋值给变量n（单引号扩起来）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">':a;N;$!ba;s/\n//g'</span> <span class="pre">file</span></code>：去除换行符，不常用，一般用<code class="docutils literal notranslate"><span class="pre">tr</span></code>命令</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">'s/$//'</span></code>：在每一行后面追加空。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">'s/</span> <span class="pre">*//g'</span></code>：将空格删除。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"> <span class="pre">*</span></code>：空格星，代表多个空格。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="awk">
<h2>3. awk<a class="headerlink" href="#awk" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span></code></p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">[</span> <span class="pre">选项</span> <span class="pre">]</span>&#160; <span class="pre">'</span> <span class="pre">/模式/{操作}</span> <span class="pre">'</span>&#160;&#160; <span class="pre">文件名</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">F</span> <span class="n">指定域分隔符</span><span class="err">（</span><span class="n">默认为空格或tab键</span><span class="err">）</span>
<span class="o">-</span><span class="n">f</span> <span class="n">指定从脚本文件中读取awk命令</span>
<span class="o">-</span><span class="n">v</span> <span class="n">var</span><span class="o">=</span><span class="n">value</span>   <span class="n">赋值一个用户定义变量</span><span class="err">，</span><span class="n">将外部变量传递给awk</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：自定义的变量</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code>： awk -v test=”hello” -F: ‘{print test,$1}’</p></li>
<li><p>在BEGIN{}模式自定义变量：awk -F ‘:’ BEGIN{test=”hello”}{print test,$1}’</p></li>
</ul>
</li>
</ul>
</li>
<li><p>模式：模式可以是以下任何一个：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">正则表达式</span><span class="o">/</span><span class="err">：</span><span class="n">使用通配符的扩展集</span><span class="err">。</span>
<span class="n">关系表达式</span><span class="err">：</span><span class="n">使用运算符进行操作</span><span class="err">，</span><span class="n">可以是字符串或数字的比较测试</span><span class="err">。</span>
<span class="n">模式匹配表达式</span><span class="err">：</span><span class="n">用运算符</span><span class="err">（</span><span class="n">匹配</span><span class="err">）</span><span class="n">和</span><span class="err">!（</span><span class="n">不匹配</span><span class="err">）。</span>
<span class="n">BEGIN语句块</span><span class="err">、</span><span class="n">pattern语句块</span><span class="err">、</span><span class="n">END语句块</span>
</pre></div>
</div>
</li>
<li><p>操作：操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是：</p>
<ul>
<li><p>变量或数组赋值</p>
<ul>
<li><p>常用内置变量：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">$</span><span class="n">n</span><span class="err">：</span><span class="n">显示当前行第n列内容n为0时表示显示当前行所有内容</span><span class="err">。</span><span class="n">多个n时</span><span class="err">，</span><span class="n">用逗号隔开</span><span class="err">。</span><span class="n">如</span><span class="err">：`</span><span class="p">{</span><span class="nb">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">}</span><span class="err">`</span>
<span class="err">$</span><span class="n">NF</span><span class="err">：</span> <span class="s1">&#39;{print $NF}&#39;</span><span class="err">，</span><span class="n">打印最后一列的内容</span><span class="err">。</span><span class="s1">&#39;{print $(NF-1)}&#39;</span><span class="err">，</span><span class="n">打印倒数第二列的内容</span><span class="err">，</span><span class="n">一次类推</span><span class="err">。</span>
<span class="n">NR</span><span class="err">：</span><span class="s1">&#39;NR==1 </span><span class="si">{print}</span><span class="s1">&#39;</span><span class="err">，</span><span class="n">打印指定行</span><span class="p">(</span><span class="n">第一行</span><span class="p">)</span><span class="n">的内容</span><span class="p">(</span><span class="n">可以使用</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">等运算符打印大于</span><span class="o">/</span><span class="n">小于某行的内容</span><span class="p">)</span><span class="err">。‘</span><span class="p">{</span><span class="nb">print</span> <span class="n">NR</span><span class="p">}</span><span class="err">’</span><span class="n">打印出行号</span><span class="err">。</span>
<span class="n">FS</span><span class="err">：</span><span class="n">输入文件的列分隔符</span><span class="err">，</span><span class="n">缺省是连续的空格和Tab</span><span class="err">。</span><span class="n">FS就是awk用来定义</span><span class="err">“</span><span class="n">列</span><span class="err">”</span><span class="n">的</span><span class="err">，</span><span class="n">设置变量</span> <span class="n">FS</span> <span class="n">与使用</span> <span class="o">-</span><span class="n">F</span> <span class="n">参数是一样的</span><span class="err">。</span>
<span class="n">OFS</span><span class="err">：</span><span class="n">输出域分隔符</span>
<span class="n">RS</span><span class="err">：</span><span class="n">读取文件时的行分隔符</span><span class="err">，</span><span class="n">默认值为</span>\<span class="n">n</span><span class="err">，</span><span class="n">即以</span>\<span class="n">n为换行符</span><span class="err">。</span>
<span class="n">ORS</span><span class="err">：</span><span class="n">ORS则是awk输出时的行结束符</span><span class="err">，</span><span class="n">默认值为</span>\<span class="n">n</span><span class="err">。</span><span class="n">就是每行记录后面增加一个ORS变量所设定的值</span><span class="err">。</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">'1a2a3a4a5'</span> <span class="pre">|</span> <span class="pre">awk</span> <span class="pre">'BEGIN{RS=&quot;a&quot;}{print</span> <span class="pre">$1,$2}'</span></code>：读取文件时以a为换行符。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">5</span> <span class="pre">|</span> <span class="pre">awk</span> <span class="pre">'BEGIN{ORS=&quot;a&quot;}{print</span> <span class="pre">$0}'</span></code>：输出文件时每行后面增加一个a。</p></li>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>输出命令：<code class="docutils literal notranslate"><span class="pre">print</span></code> <code class="docutils literal notranslate"><span class="pre">printf</span></code></p>
<ul>
<li><p>printf(”%s”,$1)</p></li>
<li><p>print($1,$2)</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">printf</span></code>中<code class="docutils literal notranslate"><span class="pre">%s</span></code> <code class="docutils literal notranslate"><span class="pre">%c</span></code> <code class="docutils literal notranslate"><span class="pre">%d</span></code> <code class="docutils literal notranslate"><span class="pre">%f</span></code>都是格式替代符：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">s</span><span class="p">:</span><span class="n">字符串</span>
<span class="o">%</span><span class="n">c</span><span class="p">:</span><span class="n">字符</span>
<span class="o">%</span><span class="n">d</span><span class="p">:</span><span class="n">整数</span>
<span class="o">%</span><span class="n">f</span><span class="p">:</span><span class="n">浮点数</span>
<span class="o">%-</span><span class="mi">10</span><span class="n">s</span> <span class="n">指一个宽度为10个字符</span><span class="err">（</span><span class="o">-</span><span class="n">表示左对齐</span><span class="err">，</span><span class="n">没有则表示右对齐</span><span class="err">），</span><span class="n">任何字符都会被显示在10个字符宽的字符内</span><span class="err">，</span><span class="n">如果不足则自动以空格填充</span><span class="err">，</span><span class="n">超过也会将内容全部显示出来</span><span class="err">。</span>
<span class="o">%-</span><span class="mf">4.2</span><span class="n">f</span> <span class="n">左对齐</span><span class="err">，</span><span class="n">占4个字符的宽度</span><span class="err">，</span><span class="n">格式化为小数</span><span class="err">，</span><span class="n">其中</span><span class="mf">.2</span><span class="n">指保留2位小数</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>内置函数</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index(str,s)</span></code>:返回子字符串s在字符串str中的位置（位置从1开始）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;good 111</span><span class="se">\n</span><span class="s2">dog 222</span><span class="se">\n</span><span class="s2">pgine 333&quot;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print index($1, &quot;g&quot;)}&#39;</span>
<span class="c1"># 返回字符g在第一列中的位置</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">substr(str,end,len)</span></code>：返回返回字符串str从end开始,长度为len的部分。len，可选的，省略表示截取到末尾（位置从1开始）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;hello world&quot;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print substr($1,3)}&#39;</span>
<span class="c1"># 截取字符串&quot;hello world&quot;第一列从3开始到末尾</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>控制流语句</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BEGIN</span></code>和<code class="docutils literal notranslate"><span class="pre">END</span></code></p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">'BEGIN{</span> <span class="pre">commands</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">commands1}</span> <span class="pre">{commands2}.....</span> <span class="pre">END{</span> <span class="pre">commands</span> <span class="pre">}'</span></code></p></li>
<li><p>执行过程</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">第一步</span><span class="err">：</span><span class="n">执行BEGIN</span><span class="p">{</span> <span class="n">commands</span> <span class="p">}</span><span class="n">语句块中的语句</span><span class="err">；</span>
<span class="n">第二步</span><span class="err">：</span><span class="n">从文件或标准输入</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span><span class="n">读取一行</span><span class="err">，</span><span class="n">然后执行</span><span class="p">{</span> <span class="n">commands</span> <span class="p">}</span><span class="n">语句块</span><span class="err">，</span><span class="n">它逐行扫描文件</span><span class="err">，</span><span class="n">从第一行到最后一行重复这个过程</span><span class="err">，</span><span class="n">直到文件全部被读取完毕</span><span class="err">。</span><span class="n">有多个语句块时</span><span class="err">，</span><span class="n">会先扫描commands1的第一行</span><span class="err">，</span><span class="n">然后扫描</span> <span class="n">commands2的的一行</span><span class="o">.....</span><span class="n">扫描完后再回来扫描</span> <span class="n">commands1的第二行</span><span class="o">......</span>
<span class="n">第三步</span><span class="err">：</span><span class="n">当读至输入流末尾时</span><span class="err">，</span><span class="n">执行END</span><span class="p">{</span> <span class="n">commands</span> <span class="p">}</span><span class="n">语句块</span><span class="err">。</span>
<span class="n">BEGIN和END部分在awk中都仅执行一次</span><span class="err">。</span>
<span class="n">BEGIN在程序一开始时</span><span class="p">,</span> <span class="n">改变awk分隔数据行的方式</span><span class="err">、</span><span class="n">设定变量的起始值</span><span class="err">、</span><span class="n">印出一行title</span><span class="err">。</span><span class="n">此时不需要读入任何数据行</span><span class="err">。</span>
<span class="n">而END用来打印结尾信息或者用来输出统计信息等</span><span class="err">。</span>
</pre></div>
</div>
<ul>
<li><p>例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;一:50件:200.00</span><span class="se">\n</span><span class="s1">二:60件:300.00</span><span class="se">\n</span><span class="s1">三:70件:400.00&#39;</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span>
<span class="n">awk</span> <span class="s1">&#39;BEGIN{FS=&quot;:&quot;;print &quot;统计销售金额&quot;;total=0} {print $3;total=total+$3;} END{printf &quot;销售金额统计:</span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&quot;,total}&#39;</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span>
<span class="n">输出结果</span><span class="err">：</span><span class="n">首先执行BEGIN语句块中的语句</span><span class="err">，</span><span class="n">即以</span><span class="p">:</span><span class="n">为分隔符号</span><span class="err">，</span><span class="n">打印统计销售金额</span><span class="err">，</span><span class="n">变量赋值为0</span><span class="err">。</span><span class="n">然后执行中间的print语句</span><span class="err">，</span><span class="n">逐行扫描答应第三列的内容并且每行累加</span><span class="err">。</span><span class="n">最后执行END语句块的内容</span><span class="err">，</span><span class="n">打印出统计金额</span><span class="err">。</span>
<span class="n">统计销售金额</span>
<span class="mf">200.00</span>
<span class="mf">300.00</span>
<span class="mf">400.00</span>
<span class="n">销售金额统计</span><span class="p">:</span><span class="mf">900.00</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>流程控制语句</p>
<ul class="simple">
<li><p>if语句</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">-F</span> <span class="pre">&quot;:&quot;</span> <span class="pre">'{if</span> <span class="pre">($1==&quot;root&quot;)</span> <span class="pre">print</span> <span class="pre">$1;else</span> <span class="pre">print</span> <span class="pre">$2}'</span> <span class="pre">/etc/passwd</span></code>：如果第一个参数是root，打印第一列内容容，否则打印第二列内容。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">-F</span> <span class="pre">&quot;:&quot;</span> <span class="pre">'BEGIN</span> <span class="pre">{count=0}</span> <span class="pre">{if</span> <span class="pre">($3&gt;=50)</span> <span class="pre">count++}</span> <span class="pre">END{print</span> <span class="pre">count}'</span> <span class="pre">/etc/passwd</span></code>：打印用户id大于等于50的(普通用户)用户数量。</p></li>
</ul>
</li>
<li><p>while循环语句</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">'BEGIN{num=1;total=0;while(num&lt;=100){total+=num;num++}{print</span> <span class="pre">total}}'</span> </code>：1+..100</p></li>
</ul>
</li>
<li><p>for循环语句</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">'BEGIN{total=0;for(i=0;i&lt;=100;i++){total+=i}</span> <span class="pre">{print</span> <span class="pre">total}}'</span></code>：1+…100</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="scp">
<h2>4. scp<a class="headerlink" href="#scp" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">scp</span></code>：基于ssh登陆进行安全的远程文件拷贝命令。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">bash.test</span> <span class="pre">bash&#64;172.30.22.115:</span></code>:将文件拷到主机115的bash用户家目录下</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">bash&#64;172.30.22.115:~/bash.test</span> <span class="pre">./bash.test.1</span></code>:将主机115家目录下的文件拷贝到本机当前目录下</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="netcat">
<h2>5. netcat<a class="headerlink" href="#netcat" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">netcat</span></code></p>
<ul>
<li><p>作用：netcat命令，也被称为nc，是一个命令行工具，允许用户通过网络连接读写数据。它可以用来建立与服务器和客户端的连接，发送和接收数据，并执行其他各种与网络有关的任务。它通常用于网络故障排除、测试和通信。</p></li>
<li><p>常见用法：</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="run-parts">
<h2>6. run-parts<a class="headerlink" href="#run-parts" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">run-parts</span></code>：遍历目标文件夹，执行第一层目录下的可执行权限的文件。</p>
<ul>
<li><p>在很多系统中，用户目录下都有cron.daily之类的文件夹，里面的可执行文件每天都会被执行一次。也就是说如果想添加一个每天都被执行的任务的话，在目录下放置该任务的脚本即可。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="lsscsi">
<h2>7. lsscsi<a class="headerlink" href="#lsscsi" title="Link to this heading">¶</a></h2>
<ul>
<li><p>SCSI：SCSI(Small Computer System Interface)是一套完整的数据传输协议，其主要功能是在主机和存储设备之间传送命令、状态和块数据。</p></li>
<li><p>常见硬盘接口</p>
<ul class="simple">
<li><p>IDE接口的硬盘：Integrated Drive Electronics，常见的2.5英寸IDE硬盘接口它的本意是指把“硬盘控制器”与“盘体”集成在一起的硬盘驱动器。</p>
<ul>
<li><p>IDE代表着硬盘的一种类型，但在实际的应用中，人们也习惯用IDE来称呼最早出现IDE类型硬盘ATA-1，这种类型的接口随着接口技术的发展已经被淘汰了，而其后发展分支出更多类型的硬盘接口，比如ATA、Ultra ATA、DMA、Ultra DMA等接口都属于IDE硬盘</p></li>
<li><p>特点：低廉，兼容性强，性价比高，数据传输慢，不支持热插拔等等。</p></li>
</ul>
</li>
<li><p>SCSI接口硬盘：SCSI并不是专门为硬盘设计的接口，是一种广泛应用于小型机上的高速数据传输技术。</p>
<ul>
<li><p>SCSI接口具有应用范围广、多任务、带宽大、CPU占用率低，以及热插拔等优点，但较高的价格使得它很难如IDE硬盘般普及，因此SCSI硬盘主要应用于中、高端服务器和高档工作站中。</p></li>
<li><p>特点：传输速率高、读写性能好、可连接多个设备、可支持热插拔，但是价格相对来说比较贵</p></li>
</ul>
</li>
<li><p>SATA接口类型：Serial Advanced Technology Attachment。使用SATA（Serial ATA）口的硬盘又叫串口硬盘，是未来PC机硬盘的趋势。</p>
<ul>
<li><p>Serial ATA采用串行连接方式，串行ATA总线使用嵌入式时钟信号，具备了更强的纠错能力，与以往相比其最大的区别在于能对传输指令（不仅仅是数据）进行检查，如果发现错误会自动矫正，这在很大程度上提高了数据传输的可靠性。</p></li>
<li><p>特点：串行接口还具有结构简单、支持热插拔的优点</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsscsi</span></code>命令</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lsscsi</span></code>列出scsi/sata设备信息，比如硬盘驱动器，光盘驱动器。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsscsi</span></code>返回值详解：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>    <span class="n">disk</span>    <span class="n">ATA</span>      <span class="n">QEMU</span> <span class="n">HARDDISK</span>    <span class="mf">2.5</span><span class="o">+</span>  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span>
<span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>    <span class="n">cd</span><span class="o">/</span><span class="n">dvd</span>  <span class="n">QEMU</span>     <span class="n">QEMU</span> <span class="n">DVD</span><span class="o">-</span><span class="n">ROM</span>     <span class="mf">2.5</span><span class="o">+</span>  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sr0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>第1列：id,[host:channel:id:lun]</p></li>
<li><p>第2列：设备类型</p></li>
<li><p>第3列：设备厂商</p></li>
<li><p>第4列：型号</p></li>
<li><p>第5列：版本信息</p></li>
<li><p>第6列：设备主节点名</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="umask">
<h2>8. umask<a class="headerlink" href="#umask" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">umask</span></code></p>
<ul>
<li><p>umask 默认权限是用来给所有新建的文件和目录赋予初始权限的。</p></li>
<li><p>文件（或目录）的初始权限 = 文件（或目录）的最大默认权限 - umask权限</p>
<ul>
<li><p>目录最大权限：777</p></li>
<li><p>文件最大权限：666。系统不允许你在创建一个文本文件时就赋予它执行权限，必须在创建后用chmod命令增加这一权限。目录则允许设置执行权限，这样针对目录来 说，umask中各个数字最大可以到7。</p></li>
</ul>
</li>
<li><p>临时修改umask：<code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">033</span></code>。重启或重新登陆系统，就会失效。如果想让修改永久生效，则需要修改对应的环境变量配置文件 /etc/profile。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="pgrep">
<h2>9. pgrep<a class="headerlink" href="#pgrep" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pgrep</span></code></p>
<ul>
<li><p>pgrep是linux中常用的通过程序名称来查询进程的工具，一般是用来判断程序是否正在运行及查找正在运行进程的PID信息。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">pgrep</span> <span class="pre">[option]</span> <span class="pre">[进程名]</span></code></p>
<ul>
<li><p>option</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span><span class="err">，</span><span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="n">name</span><span class="err">：</span><span class="n">列出进程名称和进程ID</span>
<span class="o">-</span><span class="n">o</span><span class="err">，</span><span class="o">--</span><span class="n">oldest</span><span class="err">：</span><span class="n">仅显示最小</span><span class="p">(</span><span class="n">最早启动的进程</span><span class="p">)</span><span class="n">进程号</span>
<span class="o">-</span><span class="n">n</span><span class="err">，</span><span class="o">--</span><span class="n">newest</span><span class="err">：</span><span class="n">仅显示最大</span><span class="p">(</span><span class="n">最新启动的进程</span><span class="p">)</span><span class="n">进程号</span>
<span class="o">-</span><span class="n">u</span><span class="err">，</span><span class="o">--</span><span class="n">euid</span> <span class="n">euid</span><span class="err">：</span><span class="n">仅列出有效用户相关的进程ID号</span>
<span class="o">-</span><span class="n">U</span><span class="err">，</span><span class="o">-</span> <span class="n">uid</span><span class="err">：</span><span class="n">仅匹配列出实际用户ID的进程</span>
<span class="o">-</span><span class="n">P</span><span class="p">(</span><span class="n">大写</span><span class="p">)</span><span class="err">，</span><span class="o">--</span><span class="n">parent</span> <span class="n">ppid</span><span class="err">：</span><span class="n">仅列出父进程ID的子进程号</span>
<span class="o">-</span><span class="n">x</span><span class="err">，</span><span class="o">--</span><span class="n">exact</span><span class="p">(</span><span class="n">精确</span><span class="p">)</span><span class="err">：</span><span class="n">与进程中的命令名称精确匹配</span>
<span class="o">-</span><span class="n">d</span><span class="err">，</span><span class="o">--</span><span class="n">delimiter</span><span class="p">(</span><span class="n">分隔符</span><span class="p">)</span> <span class="err">：</span><span class="n">指定每个进程ID间的分隔符</span><span class="p">(</span><span class="n">默认为换行符</span><span class="p">)</span>
<span class="o">-</span><span class="n">a</span><span class="err">，</span><span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="n">full</span><span class="err">：</span><span class="n">列表显示进程的PID和进程所对应的程序以及运行时所带的参数</span><span class="err">。</span>
<span class="o">-</span><span class="n">t</span><span class="err">，</span><span class="o">--</span><span class="n">terminal</span> <span class="err">【</span><span class="n">tty1</span><span class="err">】</span><span class="o">|</span><span class="err">【</span><span class="n">pts</span><span class="o">/</span><span class="mi">0</span><span class="err">】：</span><span class="n">只显示指定控制终端下列出的进程ID</span><span class="err">。</span><span class="n">指定终端名称时没有</span><span class="err">“</span><span class="o">/</span> <span class="n">dev</span> <span class="o">/</span><span class="err">”</span><span class="n">前缀</span><span class="err">。</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">列出指定进程的个数</span><span class="err">。</span>
<span class="o">-</span><span class="n">v</span><span class="err">，</span><span class="o">--</span><span class="n">inverse</span><span class="p">(</span><span class="n">反向</span><span class="p">)</span><span class="err">：</span><span class="n">反向匹配</span><span class="err">。</span><span class="n">匹配所有的进程除了符合匹配条件的</span><span class="err">。</span><span class="n">这个选项通常用在pgrep的上下文中</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>例：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pgrep</span> <span class="pre">-ol</span></code>：列出最早启动的进程名及进程id(即进程id为1的进程systemd)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgrep</span> <span class="pre">-ol</span> <span class="pre">sshd</span></code>：列出进程id最小的sshd进程的进程名和进程id(有多个sshd进程)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgrep</span> <span class="pre">-lu</span> <span class="pre">wl</span></code>：列出所有wl用户相关的进程id和进程名(参数u只能放最后面)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="inotify">
<h2>10. inotify<a class="headerlink" href="#inotify" title="Link to this heading">¶</a></h2>
<ul>
<li><p>inotify-tools：<code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span> <span class="pre">inotify-tools</span></code></p>
<ul>
<li><p>inotifywait 仅执行阻塞，等待 inotify 事件，你可以使用它来监控任何一组文件和目录，或监控整个目录树（目录、子目录、子目录的子目录等等），并且可以结合 shell 脚本，更好的使用 inotifywait。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">inotifywait</span> <span class="pre">[-hcmrq]</span> <span class="pre">[-e</span> <span class="pre">]</span> <span class="pre">[-t</span> <span class="pre">]</span> <span class="pre">[--</span> <span class="pre">format</span> <span class="pre">]</span> <span class="pre">[--timefmt</span> <span class="pre">]</span> <span class="pre">[</span> <span class="pre">...</span> <span class="pre">]</span> <span class="pre">file/dir</span> <span class="pre">...</span></code></p>
<ul>
<li><p>选项参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">h</span><span class="p">,</span><span class="err">–</span><span class="n">help</span> <span class="c1"># 输出帮助信息</span>
<span class="o">@</span> <span class="c1"># 排除不需要监视的文件，可以是相对路径，也可以是绝对路径</span>
<span class="err">–</span><span class="n">fromfile</span> <span class="c1"># 从文件读取需要监视的文件或排除的文件，一个文件一行，排除的文件以@开头</span>
<span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="err">–</span><span class="n">monitor</span> <span class="c1"># 接收到一个事情而不退出，无限期地执行。默认行为是接收到一个事情后立即退出</span>
<span class="o">-</span><span class="n">d</span><span class="p">,</span><span class="err">–</span><span class="n">daemon</span> <span class="c1"># 跟–monitor一样，除了是在后台运行，需要指定 –outfile把事情输出到一个文件。也意味着使用了–syslog</span>
<span class="o">-</span><span class="n">o</span><span class="p">,</span><span class="err">–</span><span class="n">outfile</span> <span class="c1"># 输出事情到一个文件而不是标准输出。</span>
<span class="o">-</span><span class="n">s</span><span class="p">,</span><span class="err">–</span><span class="n">syslog</span> <span class="c1"># 输出错误信息到系统日志</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="err">–</span><span class="n">recursive</span> <span class="c1"># 监视一个目录下的所有子目录。</span>
<span class="o">-</span><span class="n">q</span><span class="p">,</span><span class="err">–</span><span class="n">quiet</span> <span class="c1"># 指定一次，不会输出详细信息，指定二次，除了致命错误，不会输出任何信息。</span>
<span class="err">–</span><span class="n">exclude</span> <span class="c1"># 正则匹配需要排除的文件，大小写敏感。</span>
<span class="err">–</span><span class="n">excludei</span> <span class="c1"># 正则匹配需要排除的文件，忽略大小写。</span>
<span class="o">-</span><span class="n">t</span><span class="err">，–</span><span class="n">timeout</span> <span class="c1"># 设置超时时间，如果为0，则无限期地执行下去。</span>
<span class="o">-</span><span class="n">e</span><span class="p">,</span><span class="err">–</span><span class="n">event</span> <span class="c1"># 指定监视的事件,多个事件用逗号隔开。</span>
<span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="err">–</span><span class="n">csv</span> <span class="c1"># 输出csv格式。</span>
<span class="o">--</span><span class="n">timefmt</span> <span class="c1"># 指定时间格式，用于–-format选项中的%T格式。</span>
<span class="o">--</span><span class="nb">format</span> <span class="c1"># 指定输出格式。</span>
	<span class="o">%</span><span class="n">w</span> <span class="n">表示发生事件的目录</span>
	<span class="o">%</span><span class="n">f</span> <span class="n">表示发生事件的文件</span>
	<span class="o">%</span><span class="n">e</span> <span class="n">表示发生的事件</span>
	<span class="o">%</span><span class="n">Xe</span> <span class="n">事件以</span><span class="err">“</span><span class="n">X</span><span class="err">”</span><span class="n">分隔</span>
	<span class="o">%</span><span class="n">T</span> <span class="n">使用由</span><span class="o">--</span><span class="n">timefmt定义的时间格式</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>可监听事件：<code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">event1,event2...</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">access</span><span class="err">：</span><span class="n">文件读取</span><span class="err">；</span>
<span class="n">modify</span><span class="err">：</span><span class="n">文件更改</span><span class="err">；</span>
<span class="n">attrib</span><span class="err">：</span><span class="n">文件属性更改</span><span class="err">，</span><span class="n">如权限</span><span class="err">，</span><span class="n">时间戳等</span><span class="err">；</span>
<span class="n">close_write</span><span class="err">：</span><span class="n">以可写模式打开的文件被关闭</span><span class="err">，</span><span class="n">不代表此文件一定已经写入数据</span><span class="err">；</span>
<span class="n">close_nowrite</span><span class="err">：</span><span class="n">以只读模式打开的文件被关闭</span><span class="err">；</span>
<span class="n">close</span><span class="err">：</span><span class="n">文件被关闭</span><span class="err">，</span><span class="n">不管它是如何打开的</span><span class="err">；</span>
<span class="nb">open</span><span class="err">：</span><span class="n">文件打开</span><span class="err">；</span>
<span class="n">moved_to</span><span class="err">：</span><span class="n">一个文件或目录移动到监听的目录</span><span class="err">，</span><span class="n">即使是在同一目录内移动</span><span class="err">，</span><span class="n">此事件也触发</span><span class="err">；</span>
<span class="n">moved_from</span><span class="err">：</span><span class="n">一个文件或目录移出监听的目录</span><span class="err">，</span><span class="n">即使是在同一目录内移动</span><span class="err">，</span><span class="n">此事件也触发</span><span class="err">；</span>
<span class="n">move</span><span class="err">：</span><span class="n">包括moved_to和</span> <span class="n">moved_from</span><span class="err">；</span>
<span class="n">move_self</span><span class="err">：</span><span class="n">文件或目录被移除</span><span class="err">，</span><span class="n">之后不再监听此文件或目录</span><span class="err">；</span>
<span class="n">create</span><span class="err">：</span><span class="n">文件或目录创建</span><span class="err">；</span>
<span class="n">delete</span><span class="err">：</span><span class="n">文件或目录删除</span><span class="err">；</span>
<span class="n">delete_self</span><span class="err">：</span><span class="n">文件或目录移除</span><span class="err">，</span><span class="n">之后不再监听此文件或目录</span><span class="err">；</span>
<span class="n">unmount</span><span class="err">：</span><span class="n">文件系统取消挂载</span><span class="err">，</span><span class="n">之后不再监听此文件系统</span><span class="err">；</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>inotifywatch 用来收集关于被监视的文件系统的统计数据，包括每个 inotify 事件发生多少次。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">inotifywatch</span> <span class="pre">[-hvzrqf]</span> <span class="pre">[-e</span> <span class="pre">]</span> <span class="pre">[-t</span> <span class="pre">]</span> <span class="pre">[-a</span> <span class="pre">]</span> <span class="pre">[-d</span> <span class="pre">]</span> <span class="pre">[</span> <span class="pre">...</span> <span class="pre">]</span></code></p>
<ul>
<li><p>参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">h</span><span class="err">，–</span><span class="n">help</span> <span class="c1"># 输出帮助信息</span>
<span class="o">-</span> <span class="n">v</span> <span class="err">，–</span><span class="n">verbose</span> <span class="c1"># 输出详细信息</span>
<span class="o">@</span> <span class="c1"># 排除不需要监视的文件，可以是相对路径，也可以是绝对路径。</span>
<span class="err">–</span><span class="n">fromfile</span> <span class="c1"># 从文件读取需要监视的文件或排除的文件，一个文件一行，排除的文件以@开头。</span>
<span class="o">-</span><span class="n">z</span><span class="err">，–</span><span class="n">zero</span> <span class="c1"># 输出表格的行和列，即使元素为空</span>
<span class="err">–</span><span class="n">exclude</span> <span class="c1"># 正则匹配需要排除的文件，大小写敏感。</span>
<span class="err">–</span><span class="n">excludei</span> <span class="c1"># 正则匹配需要排除的文件，忽略大小写。</span>
<span class="o">-</span><span class="n">r</span><span class="err">，–</span><span class="n">recursive</span> <span class="c1"># 监视一个目录下的所有子目录。</span>
<span class="o">-</span><span class="n">t</span><span class="err">，–</span><span class="n">timeout</span> <span class="c1"># 设置超时时间</span>
<span class="o">-</span><span class="n">e</span><span class="err">，–</span><span class="n">event</span> <span class="c1"># 只监听指定的事件。</span>
<span class="o">-</span><span class="n">a</span><span class="err">，–</span><span class="n">ascending</span> <span class="c1"># 以指定事件升序排列。</span>
<span class="o">-</span><span class="n">d</span><span class="err">，–</span><span class="n">descending</span> <span class="c1"># 以指定事件降序排列</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="iptables">
<h2>11. 10 iptables<a class="headerlink" href="#iptables" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span></code></p>
<ul>
<li><p>iptables是工作在用户空间中，定义规则的工具，本身并不算是防火墙。它们定义的规则，可以让在内核空间当中的netfilter来读取，并且实现让防火墙工作。而放入内核的地方必须要是特定的位置，必须是tcp/ip的协议栈经过的地方。而这个tcp/ip协议栈必须经过的地方，可以实现读取规则的地方就叫做 netfilter(网络过滤器)。</p></li>
<li><p>在内核空间中有了5个位置，
1.内核空间中：从一个网络接口进来，到另一个网络接口去的
2.数据包从内核流入用户空间的
3.数据包从用户空间流出的
4.进入/离开本机的外网接口
5.进入/离开本机的内网接口</p></li>
<li><p>这5个位置被称为五个钩子函数（hook functions）,也叫五个规则链。这是NetFilter规定的五个规则链，任何一个数据包，只要经过本机，必将经过这五个链中的其中一个链。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="mf">1.</span> <span class="n">INPUT</span> <span class="p">(</span><span class="n">数据包流入口</span><span class="err">，</span><span class="n">进内核</span><span class="p">)</span>
	<span class="mf">2.</span> <span class="n">OUTPUT</span><span class="p">(</span><span class="n">数据包出口</span><span class="err">，</span><span class="n">出内核</span><span class="p">)</span>
    <span class="mf">3.</span> <span class="n">FORWARD</span> <span class="p">(</span><span class="n">转发管卡</span><span class="p">)</span>
	<span class="mf">4.</span> <span class="n">PREROUTING</span> <span class="p">(</span><span class="n">路由前</span><span class="p">)</span>
    <span class="mf">5.</span> <span class="n">POSTROUTING</span><span class="err">（</span><span class="n">路由后</span><span class="err">）</span>
</pre></div>
</div>
</li>
<li><p>链的概念：防火墙的作用就在于对经过的报文匹配”规则”，然后执行对应的”动作”,所以，当报文经过这些关卡的时候，则必须匹配这个关卡上的规则，但是，这个关卡上可能不止有一条规则，而是有很多条规则，当我们把这些规则串到一个链条上的时候，就形成了”链”，每个经过这个”关卡”的报文，都要将这条”链”上的所有规则匹配一遍，如果有符合条件的规则，则执行规则对应的动作。</p></li>
<li><p>表的概念：我们对每个”链”上都放置了一串规则，但是这些规则有些很相似，比如，A类规则都是对IP或者端口的过滤，B类规则是修改报文，那么这个时候，把实现相同功能的规则放在一起。我们把具有相同功能的规则的集合叫做”表”，所以说，不同功能的规则，我们可以放置在不同的表中进行管理，而iptables已经为我们定义了4种表，每种表对应了不同的功能，而我们定义的规则也都逃脱不了这4种功能的范围。表，可以理解成配置文件，把每个钩子函数的参数写在配置文件中，才能生效。钩子函数本身就是个函数。</p>
<ol class="simple">
<li><p>filter表：负责过滤功能，防火墙；内核模块：iptables_filter</p></li>
<li><p>nat表：network address translation，网络地址转换功能；内核模块：iptable_nat</p></li>
<li><p>mangle表：拆解报文，做出修改，并重新封装 的功能；内核模块：iptable_mangle</p></li>
<li><p>raw表：关闭nat表上启用的连接追踪机制；内核模块：iptable_raw</p></li>
</ol>
</li>
<li><p>对应表中的规则能被哪些链使用：</p>
<ol class="simple">
<li><p>raw 表中的规则可以被哪些链使用：PREROUTING，OUTPUT</p></li>
<li><p>mangle 表中的规则可以被哪些链使用：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</p></li>
<li><p>nat 表中的规则可以被哪些链使用：PREROUTING，OUTPUT，POSTROUTING（centos7中还有INPUT，centos6中没有）</p></li>
<li><p>filter 表中的规则可以被哪些链使用：INPUT，FORWARD，OUTPU</p></li>
</ol>
</li>
<li><p>数据包经过一个”链”的时候，会将当前链的所有规则都匹配一遍，但是匹配时总归要有顺序，我们应该一条一条的去匹配，而且我们说过，相同功能类型的规则会汇聚在一张”表”中，那么，哪些”表”中的规则会放在”链”的最前面执行呢，这时候就需要有一个优先级的问题。</p>
<ul class="simple">
<li><p>当不同的表存在同一条”链”时，优先级次序（由高而低）：raw &gt; mangle &gt; nat &gt; filter</p>
<ul>
<li><p>prerouting链中的规则存放于三张表，优先级为：raw &gt; mangle &gt; nat</p></li>
</ul>
</li>
</ul>
</li>
<li><p>规则：根据指定的匹配条件来尝试匹配每个流经此处的报文，一旦匹配成功，则由规则后面指定的处理动作进行处理。</p>
<ul>
<li><p>匹配条件：基本匹配条件和扩展匹配条件。</p>
<ul class="simple">
<li><p>基本匹配条件：源地址Source IP，目标地址 Destination IP。</p></li>
<li><p>扩展匹配条件：除了上述的条件可以用于匹配，还有很多其他的条件可以用于匹配，这些条件泛称为扩展条件，这些扩展条件其实也是netfilter中的一部分，只是以模块的形式存在，如果想要使用这些条件，则需要依赖对应的扩展模块。</p></li>
</ul>
</li>
<li><p>处理动作：处理动作在iptables中被称为target（这样说并不准确，我们暂且这样称呼），动作也可以分为基本动作和扩展动作。以下是一些常用动作：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ACCEPT</span><span class="err">：</span><span class="n">允许数据包通过</span><span class="err">。</span>
<span class="n">DROP</span><span class="err">：</span><span class="n">直接丢弃数据包</span><span class="err">，</span><span class="n">不给任何回应信息</span><span class="err">，</span><span class="n">这时候客户端会感觉自己的请求泥牛入海了</span><span class="err">，</span><span class="n">过了超时时间才会有反应</span><span class="err">。</span>
<span class="n">REJECT</span><span class="err">：</span><span class="n">拒绝数据包通过</span><span class="err">，</span><span class="n">必要时会给数据发送端一个响应的信息</span><span class="err">，</span><span class="n">客户端刚请求就会收到拒绝的信息</span><span class="err">。</span>
<span class="n">SNAT</span><span class="err">：</span><span class="n">源地址转换</span><span class="err">，</span><span class="n">解决内网用户用同一个公网地址上网的问题</span><span class="err">。</span>
<span class="n">MASQUERADE</span><span class="err">：</span><span class="n">是SNAT的一种特殊形式</span><span class="err">，</span><span class="n">适用于动态的</span><span class="err">、</span><span class="n">临时会变的ip上</span><span class="err">。</span>
<span class="n">DNAT</span><span class="err">：</span><span class="n">目标地址转换</span><span class="err">。</span>
<span class="n">REDIRECT</span><span class="err">：</span><span class="n">在本机做端口映射</span><span class="err">。</span>
<span class="n">LOG</span><span class="err">：</span><span class="n">在</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">messages文件中记录日志信息</span><span class="err">，</span><span class="n">然后将数据包传递给下一条规则</span><span class="err">，</span><span class="n">也就是说除了记录以外不对数据包做任何其他操作</span><span class="err">，</span><span class="n">仍然让下一条规则去匹配</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span></code>规则写法：<code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">[-t</span> <span class="pre">table]</span> <span class="pre">COMMAND</span> <span class="pre">chain</span> <span class="pre">CRETIRIA</span> <span class="pre">-j</span> <span class="pre">ACTION</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">t</span> <span class="n">table</span> <span class="err">：</span><span class="n">指定表</span><span class="err">（</span><span class="nb">filter</span><span class="p">,</span><span class="n">nat</span><span class="p">,</span><span class="n">mangle</span><span class="p">,</span><span class="n">raw</span><span class="err">）</span>
<span class="n">COMMAND</span><span class="err">：</span><span class="n">定义如何对规则进行管理</span>
<span class="n">chain</span><span class="err">：</span><span class="n">指定你接下来的规则到底是在哪个链上操作的</span><span class="err">，</span><span class="n">当定义策略的时候</span><span class="err">，</span><span class="n">是可以省略的</span>
<span class="n">CRETIRIA</span><span class="p">:</span><span class="n">指定匹配标准</span>
<span class="o">-</span><span class="n">j</span> <span class="n">ACTION</span> <span class="p">:</span><span class="n">指定如何进行处理</span>
</pre></div>
</div>
<ul>
<li><p>例：不允许172.30.22.24的进行访问。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span>&#160; <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-s</span> <span class="pre">172.30.22.24</span>&#160; <span class="pre">-j</span> <span class="pre">REJECT</span></code></p></li>
</ul>
</li>
<li><p>COMMAND：</p>
<ul>
<li><p>链管理命令（这都是立即生效的）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">P</span> <span class="p">:</span><span class="n">设置默认策略的</span><span class="err">（</span><span class="n">设定默认门是关着的还是开着的</span><span class="err">），</span><span class="n">默认策略一般只有两种</span><span class="err">，</span><span class="n">iptables</span> <span class="o">-</span><span class="n">P</span> <span class="n">INPUT</span> <span class="p">(</span><span class="n">DROP</span><span class="o">|</span><span class="n">ACCEPT</span><span class="p">)</span>  <span class="n">默认是关的</span><span class="o">/</span><span class="n">默认是开的</span>
<span class="o">-</span><span class="n">F</span><span class="p">:</span> <span class="n">FLASH</span><span class="err">，</span><span class="n">清空规则链的</span><span class="p">(</span><span class="n">注意每个链的管理权限</span><span class="p">)</span>
<span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">NEW</span> <span class="n">新建一个链</span>
<span class="o">-</span><span class="n">X</span><span class="p">:</span> <span class="n">用于删除用户自定义的空链</span><span class="err">。</span><span class="n">使用方法跟</span><span class="o">-</span><span class="n">N相同</span><span class="err">，</span><span class="n">但是在删除之前必须要将里面的链给清空了</span>
<span class="o">-</span><span class="n">E</span> <span class="n">oldname</span> <span class="n">newname</span><span class="err">：</span><span class="n">用来Rename</span> <span class="n">chain主要是用来给用户自定义的链重命名</span>
<span class="o">-</span><span class="n">Z</span><span class="err">：</span><span class="n">清空链</span><span class="err">，</span><span class="n">及链中默认规则的计数器的</span><span class="err">（</span><span class="n">有两个计数器</span><span class="err">，</span><span class="n">被匹配到多少个数据包</span><span class="err">，</span><span class="n">多少个字节</span><span class="err">）</span>
</pre></div>
</div>
<ul>
<li><p>例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iptables</span> <span class="o">-</span><span class="n">P</span> <span class="n">INPUT</span> <span class="n">DROP</span> <span class="n">这就把默认规则给拒绝了</span><span class="err">。</span><span class="n">并且没有定义哪个动作</span><span class="err">，</span><span class="n">所以关于外界连接的所有规则包括Xshell连接之类的</span><span class="err">，</span><span class="n">远程连接都被拒绝了</span><span class="err">。</span> 
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">F</span> <span class="n">PREROUTING</span><span class="err">：</span><span class="n">清空nat表的PREROUTING链</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">F</span> <span class="err">：</span><span class="n">清空nat表的所有链</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">N</span> <span class="n">inbound_tcp_web</span> <span class="err">：</span><span class="n">新建一条链</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>规则管理命令</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">A</span> <span class="n">chain</span><span class="err">：</span><span class="n">追加</span><span class="err">，</span><span class="n">在当前链的最后新增一个规则</span>
<span class="o">-</span><span class="n">I</span> <span class="n">chain</span> <span class="n">num</span> <span class="p">:</span> <span class="n">插入</span><span class="err">，</span><span class="n">把当前规则插入为第几条</span><span class="err">。</span><span class="p">(</span><span class="n">大写的i</span><span class="p">)</span>
<span class="o">-</span><span class="n">R</span> <span class="n">chain</span> <span class="n">num</span><span class="err">：</span><span class="n">Replays替换</span><span class="o">/</span><span class="n">修改第几条规则</span>
<span class="o">-</span><span class="n">D</span> <span class="n">chain</span> <span class="n">num</span><span class="err">：</span><span class="n">删除</span><span class="err">，</span><span class="n">明确指定删除第几条规则</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-R</span> <span class="pre">INPUT</span> <span class="pre">2</span> <span class="pre">-s</span> <span class="pre">172.30.22.110</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：将INPUT链的第2条规则修改为该规则。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>查看管理命令 “-L”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以下为-L的附加子命令，需要与-L一起用。</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">以数字的方式显示ip</span><span class="err">，</span><span class="n">它会将ip直接显示出来</span><span class="err">，</span><span class="n">如果不加</span><span class="o">-</span><span class="n">n</span><span class="err">，</span><span class="n">则会将ip反向解析成主机名</span><span class="err">。</span>
<span class="o">-</span><span class="n">v</span><span class="o">/-</span><span class="n">vv</span><span class="o">/-</span><span class="n">vvv</span><span class="err">：</span><span class="n">显示详细信息</span><span class="err">，</span><span class="n">v越多越详细</span>
<span class="o">-</span><span class="n">x</span><span class="err">：</span><span class="n">在计数器上显示精确值</span><span class="err">，</span><span class="n">不做单位换算</span>
<span class="o">--</span><span class="n">line</span><span class="o">-</span><span class="n">numbers</span> <span class="p">:</span> <span class="n">显示规则的行号</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-L</span> <span class="pre">-x</span> <span class="pre">-n</span> <span class="pre">-v</span> <span class="pre">--line-numbers</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>匹配标准</p>
<ul>
<li><p>通用匹配：源地址目标地址的匹配。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">指定作为源地址匹配</span><span class="err">，</span><span class="n">这里不能指定主机名称</span><span class="err">，</span><span class="n">必须是IP</span><span class="err">。</span><span class="n">IP</span> <span class="o">|</span> <span class="n">IP</span><span class="o">/</span><span class="n">MASK</span> <span class="o">|</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mf">0.0.0.0</span><span class="err">。</span><span class="n">而且地址可以取反</span><span class="err">，</span><span class="n">加一个</span><span class="err">“!”</span><span class="n">表示除了哪个IP之外</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">表示匹配目标地址</span>
<span class="o">-</span><span class="n">p</span><span class="err">：</span><span class="n">用于匹配协议的</span><span class="err">（</span><span class="n">这里的协议通常有3种</span><span class="err">，</span><span class="n">TCP</span><span class="o">/</span><span class="n">UDP</span><span class="o">/</span><span class="n">ICMP</span><span class="err">）</span>
<span class="o">-</span><span class="n">i</span> <span class="n">eth0</span><span class="err">：</span><span class="n">从这块网卡流入的数据</span><span class="err">，</span><span class="n">流入一般用在INPUT和PREROUTING上</span>
<span class="o">-</span><span class="n">o</span> <span class="n">eth0</span><span class="err">：</span><span class="n">从这块网卡流出的数据</span><span class="err">，</span><span class="n">流出一般在OUTPUT和POSTROUTING上</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-s</span> <span class="pre">172.30.22.114</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：拒绝172.30.22.114连接到本机</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-d</span> <span class="pre">172.30.22.113</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：拒绝任何主机连接到本机（172.30.22.113）</p></li>
</ul>
</li>
</ul>
</li>
<li><p>扩展匹配：隐含扩展和显示扩展</p>
<ul>
<li><p>隐含扩展：对协议的扩展</p>
<ul>
<li><p>-p tcp :TCP协议的扩展。一般有三种扩展（必须与-p tcp连用）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">dport</span> <span class="n">XX</span><span class="o">-</span><span class="n">XX</span><span class="err">：</span><span class="n">指定目标端口</span><span class="p">,</span><span class="n">不能指定多个非连续端口</span><span class="p">,</span><span class="n">只能指定单个端口</span><span class="err">，</span><span class="n">比如</span><span class="err">：</span><span class="o">--</span><span class="n">dport</span> <span class="mi">21</span>  <span class="n">或者</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">21</span><span class="o">-</span><span class="mi">23</span> <span class="p">(</span><span class="n">此时表示21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
<span class="o">--</span><span class="n">sport</span><span class="err">：</span><span class="n">指定源端口</span>
<span class="o">--</span><span class="n">tcp</span><span class="o">-</span><span class="n">fiags</span><span class="err">：</span><span class="n">TCP的标志位</span><span class="err">（</span><span class="n">SYN</span><span class="p">,</span><span class="n">ACK</span><span class="err">，</span><span class="n">FIN</span><span class="p">,</span><span class="n">PSH</span><span class="err">，</span><span class="n">RST</span><span class="p">,</span><span class="n">URG</span><span class="err">），</span><span class="n">对于它</span><span class="err">，</span><span class="n">一般要跟两个参数</span><span class="err">：</span><span class="mf">1.</span><span class="n">检查的标志位</span><span class="err">，</span><span class="mf">2.</span><span class="n">必须为1的标志位</span>
<span class="o">--</span><span class="n">tcpflags</span> <span class="n">syn</span><span class="p">,</span><span class="n">ack</span><span class="p">,</span><span class="n">fin</span><span class="p">,</span><span class="n">rst</span> <span class="n">syn</span>   <span class="o">=</span>    <span class="o">--</span><span class="n">syn</span><span class="err">，</span><span class="n">表示检查这4个位</span><span class="err">，</span><span class="n">这4个位中syn必须为1</span><span class="err">，</span><span class="n">其他的必须为0</span><span class="err">。</span><span class="n">所以这个意思就是用于检测三次握手的第一次包的</span><span class="err">。</span><span class="n">对于这种专门匹配第一包的SYN为1的包</span><span class="err">，</span><span class="n">还有一种简写方式</span><span class="err">，</span><span class="n">叫做</span><span class="o">--</span><span class="n">syn</span><span class="err">。</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-p</span> <span class="pre">udp</span> <span class="pre">--dport</span> <span class="pre">177</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：拒绝XSMCP远程登录服务</p></li>
</ul>
</li>
</ul>
</li>
<li><p>-p udp：UDP协议的扩展</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">dport</span>
<span class="o">--</span><span class="n">sport</span>
</pre></div>
</div>
</li>
<li><p>-p icmp：icmp数据报文的扩展</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--icmp-type</span></code>：echo-request(请求回显)，一般用8 来表示，所以 <code class="docutils literal notranslate"><span class="pre">--icmp-type</span> <span class="pre">8</span></code> 匹配请求回显数据包；echo-reply （响应的数据包）一般用0来表示。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">OUTPUT</span> <span class="pre">-p</span> <span class="pre">icmp</span> <span class="pre">--icmp-type</span> <span class="pre">8</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：拒绝本机ping其它主机。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>显示扩展：<code class="docutils literal notranslate"><span class="pre">-m</span></code>，扩展各种模块。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">multiport</span></code>：表示启用多端口扩展，之后我们就可以启用比如 –dports 21,23,80</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">ACTION</span></code>：常用的ACTION</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span><span class="err">：</span><span class="n">悄悄丢弃</span><span class="err">，</span><span class="n">一般我们多用DROP来隐藏我们的身份</span><span class="err">，</span><span class="n">以及隐藏我们的链表</span><span class="err">。</span>
<span class="n">REJECT</span><span class="err">：</span><span class="n">明示拒绝</span>
<span class="n">ACCEPT</span><span class="err">：</span><span class="n">接受</span>
<span class="n">custom_chain</span><span class="err">：</span><span class="n">转向一个自定义的链</span>
<span class="n">DNAT</span><span class="err">：</span><span class="n">目的地址转换</span>
<span class="n">SNAT</span><span class="err">：</span><span class="n">源地址转换</span>
<span class="n">MASQUERADE</span><span class="err">：</span><span class="n">动态地址转换</span>
<span class="n">REDIRECT</span><span class="err">：</span><span class="n">重定向</span><span class="err">：</span><span class="n">主要用于实现端口重定向</span>
<span class="n">MARK</span><span class="err">：</span><span class="n">打防火墙标记的</span>
<span class="n">RETURN</span><span class="err">：</span><span class="n">返回</span><span class="err">，</span><span class="n">在自定义链执行完毕后使用返回</span><span class="err">，</span><span class="n">来返回原规则链</span><span class="err">。</span>
</pre></div>
</div>
</li>
<li><p>状态检测：</p>
<ul class="simple">
<li><p>该检测是一种显式扩展，用于检测会话之间的连接关系的，有了检测我们可以实现会话间功能的扩展。</p></li>
<li><p>什么是状态检测：</p>
<ul>
<li><p>NEW：对于整个TCP协议来讲，它是一个有连接的协议，三次握手中，第一次握手，我们就叫NEW连接。</p></li>
<li><p>ESTABLISHED：从第二次握手以后的，ack都为1，这是正常的数据传输，和tcp的第二次第三次握手，叫做已建立的连接（ESTABLISHED）。</p></li>
<li><p>INVALID：还有一种状态，比较诡异的，比如：SYN=1 ACK=1 RST=1,对于这种我们无法识别的，我们都称之为INVALID无法识别的。</p></li>
<li><p>RELATED：还有第四种，FTP这种古老的拥有的特征，每个端口都是独立的，21号和20号端口都是一去一回，他们之间是有关系的，这种关系我们称之为RELATED。</p></li>
<li><p>所以我们的状态一共有四种：NEW、 ESTABLISHED、RELATED、INVALID。对于iptables规则设置可以增加状态检测。比如进来的只允许状态为NEW和ESTABLISHED的进来，出去只允许ESTABLISHED的状态出去，这就可以将比较常见的反弹式木马有很好的控制机制。</p></li>
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-p</span> <span class="pre">tcp</span> <span class="pre">--dport</span> <span class="pre">22</span> <span class="pre">-m</span> <span class="pre">state</span> <span class="pre">--state</span> <span class="pre">NEW,ESTABLISHED</span> <span class="pre">-j</span> <span class="pre">REJECT</span></code>：连接状态为NEW,ESTABLISHED的ssh连接拒绝进来。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>SNAT和DNAT的实现</p>
<ul>
<li><p>由于我们现在IP地址十分紧俏，已经分配完了，这就导致我们必须要进行地址转换，来节约我们仅剩的一点IP资源。那么通过iptables如何实现NAT的地址转换呢？</p></li>
<li><p>SNAT：源地址转换</p>
<ul>
<li><p>基于源地址的转换一般用在我们的许多内网用户通过一个外网的口上网的时候，这时我们将我们内网的地址转换为一个外网的IP，我们就可以实现连接其他外网IP的功能。所以我们在iptables中就要定义到底如何转换：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#将所有192.168.10.0网段的IP在经过的时候全都转换成172.16.100.1这个外网ip</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">POSTROUTING</span> <span class="o">-</span><span class="n">s</span> <span class="mf">192.168.10.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">j</span> <span class="n">SNAT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">source</span> <span class="mf">172.16.100.1</span>
<span class="c1">#当我们使用联通或者电信上网的时候，一般它都会在每次你开机的时候随机生成一个外网的IP，意思就是外网地址是动态变换的。这时我们就要将外网地址换成 MASQUERADE(动态伪装):它可以实现自动寻找到外网地址，而自动将其改为正确的外网地址。所以，我们就需要这样设置：</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">POSTROUTING</span> <span class="o">-</span><span class="n">s</span> <span class="mf">192.168.10.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">j</span> <span class="n">MASQUERADE</span>
<span class="c1"># 注：地址伪装并不适用于所有的地方。</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>DNAT：目标地址转换</p>
<ul>
<li><p>对于目标地址转换，数据流向是从外向内的，外面的是客户端，里面的是服务器端通过目标地址转换，我们可以让外面的ip通过我们对外的外网ip来访问我们服务器不同的服务器，而我们的服务却放在内网服务器的不同的服务器上。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">d</span> <span class="mf">192.168.10.18</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">j</span> <span class="n">DNAT</span> <span class="o">--</span><span class="n">todestination</span> <span class="mf">172.16.100.2</span>
<span class="c1"># 目标地址转换要做在到达网卡之前进行转换,所以要做在PREROUTING这个位置上。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>控制规则的存放以及开启</p>
<ul>
<li><p>注：你所定义的所有内容，当你重启的时候都会失效，要想我们能够生效，需要使用一个命令将它保存起来。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">service</span> <span class="pre">iptables</span> <span class="pre">save</span></code>：将规则保存在/etc/sysconfig/iptables这个文件中。（有些系统不存在该命令）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables-save</span> <span class="pre">&gt;</span> <span class="pre">/opt/test</span></code>：将规则保存到指定的文件中。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iptables-restore</span> <span class="pre">&lt;</span> <span class="pre">/opt/test</span></code>：使/opt/test文件中的规则生效。（将该命令设置开机自启则可以是规则在开机即生效）</p>
<ul>
<li><p>方式一：将该命令加入<code class="docutils literal notranslate"><span class="pre">/etc/rc.local</span></code>中。</p></li>
<li><p>方式二：脚本放入<code class="docutils literal notranslate"><span class="pre">/etc/network/if-pre-up.d</span></code>目录下（该目录下的脚本会在网卡启动前运行）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vim /etc/network/if-pre-up.d/test</span>
<span class="c1">#！/bin/bash</span>
<span class="n">iptables</span><span class="o">-</span><span class="n">restore</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">test</span>
<span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">network</span><span class="o">/</span><span class="k">if</span><span class="o">-</span><span class="n">pre</span><span class="o">-</span><span class="n">up</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">test</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="script">
<h2>12. script<a class="headerlink" href="#script" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">script</span></code>：用来记录终端的行为及结果，并存储成本地文件，可以直接用编辑器打开进行查看。同时可以记录时间轴信息，利用<code class="docutils literal notranslate"><span class="pre">scriptreplay</span></code>命令进行动态查看。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">[options]</span> <span class="pre">[file]</span></code></p>
<ul>
<li><p>[file]：指定存储路径，不加该参数默认存在当前路径下的typescript中。</p></li>
<li><p>[options]:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">用来在现有的记录文件中进行追加</span><span class="err">，</span><span class="n">而不是覆盖</span><span class="err">。</span><span class="n">不加该参数默认为覆盖</span><span class="err">。</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">后面接一串命令</span><span class="err">，</span><span class="n">只是针对这一串命令进行记录</span><span class="err">，</span><span class="n">记录完毕就自动退出</span><span class="err">。</span>
<span class="o">-</span><span class="n">e</span><span class="err">：</span><span class="n">子进程中返回退出代码</span>
<span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">正常情况下没有停止记录的话</span><span class="err">，</span><span class="n">记录的结果是不会实时写入到文件中的</span><span class="err">。</span><span class="n">但是加了这个参数就可以强制性让记录实时写入文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">q</span><span class="err">：</span><span class="n">如果不想让终端提示记录的开始和结束可以用这个参数开启安静模式</span><span class="err">。</span>
<span class="o">-</span><span class="n">tfile</span><span class="err">：</span><span class="n">在另一个文件中保存时序信息</span><span class="err">，</span><span class="n">方便动态记录</span><span class="p">(</span><span class="o">-</span><span class="n">t参数和指定保存时序的文件之间没有空格</span><span class="err">！</span><span class="p">)</span><span class="err">。</span><span class="n">主要用于scriptreplay回放时使用</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scriptreplay</span></code>：回放<code class="docutils literal notranslate"><span class="pre">script记录的操作</span></code></p>
<ul class="simple">
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">scriptreplay</span> <span class="pre">[-t]</span> <span class="pre">时序文件</span> <span class="pre">[-s]</span> <span class="pre">操作记录文件</span></code></p></li>
<li><p>注：时许文件必不可少，且必须在操作记录文件前面</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ssh">
<h2>13. ssh<a class="headerlink" href="#ssh" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span></code>：SSH (Secure Shell)是一种安全通道协议，主要用来实现字符界面的远程登录、远程、复制等功能。SSH协议对通信双方的数据传输进行了加密处理，其中包括用户登录时输入的用户口令，SSH为建立在应用层和传输层基础上的安全协议。
- SSH客户端&lt;————–网络—————&gt;SSH服务端
- 数据传输是加密的，可以防止信息泄漏
- 数据传输是压缩的，可以提高传输速度
- SSH只是一种协议，存在多种实现，既有商业实现，也有开源实现。以下针对的实现是OpenSSH，它是自由软件，应用非常广泛。这里只讨论SSH在Linux Shell中的用法。</p>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="sshpass">
<h2>14. sshpass<a class="headerlink" href="#sshpass" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sshpass</span></code>：ssh 登陆不能在命令行中指定密码，sshpass 的出现则解决了这一问题。它允许你用 -p 参数指定明文密码，然后直接登录远程服务器，它支持密码从命令行、文件、环境变量中读取。</p>
<ul>
<li><p>格式：<code class="docutils literal notranslate"><span class="pre">sshpass</span> <span class="pre">[-f|-d|-p|-e]</span> <span class="pre">[-hV]</span> <span class="pre">command</span> <span class="pre">parameters</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># command parameters为你要执行的需要交互式输入密码的命令，如：ssh、scp等。当sshpass没有指定参数时会从stdin获取密码，几个密码输入相关参数如下：</span>
<span class="o">-</span><span class="n">f</span> <span class="n">filename</span><span class="err">：</span><span class="n">从文件中获取密码</span>
<span class="o">-</span><span class="n">d</span> <span class="n">number</span><span class="err">：</span><span class="n">使用数字作为获取密码的文件描述符</span>
<span class="o">-</span><span class="n">p</span> <span class="n">password</span><span class="err">：</span><span class="n">指定明文本密码输入</span><span class="p">(</span><span class="n">安全性较差</span><span class="p">)</span>
<span class="o">-</span><span class="n">e</span><span class="err">：</span><span class="n">从环境变量SSHPASS获取密码</span>
</pre></div>
</div>
</li>
</ul>
<p>例：
- <code class="docutils literal notranslate"><span class="pre">sshpass</span> <span class="pre">-p</span> <span class="pre">root</span> <span class="pre">ssh</span> <span class="pre">root&#64;172.30.22.113</span></code>：ssh登陆113主机，密码为root。
- <code class="docutils literal notranslate"><span class="pre">sshpass</span> <span class="pre">-p</span> <span class="pre">root</span> <span class="pre">ssh</span> <span class="pre">root&#64;172.30.22.113</span> <span class="pre">&quot;ls&quot;</span></code>：远程执行命令
- <code class="docutils literal notranslate"><span class="pre">sshpass</span> <span class="pre">-p</span> <span class="pre">root</span> <span class="pre">scp</span> <span class="pre">root&#64;172.30.22.113:/opt/test</span> <span class="pre">./test</span></code>：远程传输文件到本地</p>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id2">
<h2>15. ssh免密登陆<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh</span></code>免密登陆</p>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-keygen</span> <span class="pre">-t</span> <span class="pre">rsa</span></code>：本地生成密钥（私钥和公钥）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span></code>：把本地主机的公钥复制到远程主机的 authorized_keys 文件上，实现免密登录（如果还是要输入密码，确认ssh配置文件中以下三行未被注释）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vim /etc/ssh/sshd_config</span>
<span class="n">RSAAuthentication</span> <span class="n">yes</span>
<span class="n">PubkeyAuthentication</span> <span class="n">yes</span>
<span class="n">AuthorizedKeysFile</span> <span class="o">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span>
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span> <span class="pre">[-n]</span> <span class="pre">[-i</span> <span class="pre">[identity_file]]</span> <span class="pre">[-p</span> <span class="pre">port]</span> <span class="pre">[-o</span> <span class="pre">ssh_option]</span> <span class="pre">[user&#64;]hostname</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">&lt;</span><span class="n">identity_file</span><span class="o">&gt;</span> <span class="err">：</span><span class="n">指定认证文件</span><span class="p">(</span><span class="n">公钥</span><span class="p">)</span><span class="err">。</span><span class="p">(</span><span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="p">)</span>
<span class="o">-</span><span class="n">f</span> <span class="err">：</span><span class="n">强制模式</span><span class="err">。</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">测试</span><span class="err">，</span><span class="n">不实际替换</span><span class="err">。</span>
<span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span><span class="err">：</span><span class="n">指定端口</span><span class="err">。</span>
<span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">ssh_option</span><span class="o">&gt;</span><span class="err">：</span><span class="n">指定其他</span> <span class="n">ssh</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">参数</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="diff">
<h2>16. diff<a class="headerlink" href="#diff" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">diff</span></code>：diff（different）命令以逐行的方式，比较文本文件的异同处。如果指定要比较目录，则diff会比较目录中相同文件名的文件，但不会比较其中子目录。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">diff</span> <span class="pre">[options]...</span> <span class="pre">file1</span> <span class="pre">file2</span></code></p></li>
<li><p>常用options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">b</span> <span class="p">:</span> <span class="n">忽略空格</span>
<span class="o">-</span><span class="n">B</span> <span class="p">:</span> <span class="n">忽略空行</span>
<span class="o">-</span><span class="n">i</span>  <span class="p">:</span> <span class="n">忽略大小写</span>
<span class="o">-</span><span class="n">c</span> <span class="p">:</span> <span class="n">显示文件所有内容并标示不同</span>
<span class="o">-</span><span class="n">y</span> <span class="p">:</span> <span class="n">令对比结果并排格式输出</span>
<span class="o">-</span><span class="n">r</span> <span class="p">:</span> <span class="n">对比目录</span>
<span class="o">-</span><span class="n">u</span> <span class="p">:</span> <span class="n">合并输出</span>
</pre></div>
</div>
</li>
<li><p>diff 比较结果的含义:a = add；c = change；d = delete。如2c2表示两对比文件的第二行有改变。</p>
<ol class="simple">
<li><p>带 &lt; 的部分表示左边文件内容</p></li>
<li><p>中间的 - - - 则是两个文件内容的分隔符号。</p></li>
<li><p>带 &gt; 的部分表示右边文件内容</p></li>
</ol>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="stat">
<h2>17. stat<a class="headerlink" href="#stat" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">stat</span> <span class="pre">file</span></code>：stat命令用于显示文件的状态信息。stat命令的输出信息比ls命令的输出信息要更详细。stat命令可以查看的信息包括：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span><span class="err">：</span><span class="n">显示文件名</span>
<span class="n">Size</span><span class="err">：</span><span class="n">显示文件大小</span>
<span class="n">Blocks</span><span class="err">：</span><span class="n">文件使用的数据块总数</span>
<span class="n">IO</span> <span class="n">Block</span><span class="err">：</span><span class="n">IO块大小</span>
<span class="n">regular</span> <span class="n">file</span><span class="err">：</span><span class="n">文件类型</span><span class="err">（</span><span class="n">常规文件</span><span class="err">）</span>
<span class="n">Device</span><span class="err">：</span><span class="n">设备编号</span>
<span class="n">Inode</span><span class="err">：</span><span class="n">Inode号</span>
<span class="n">Links</span><span class="err">：</span><span class="n">链接数</span>
<span class="n">Access</span><span class="err">：</span><span class="n">文件的权限</span>
<span class="n">Gid</span><span class="err">、</span><span class="n">Uid</span><span class="err">：</span><span class="n">文件所有权的Gid和Uid</span>
<span class="n">access</span> <span class="n">time</span><span class="err">：</span><span class="n">表示我们最后一次访问</span><span class="err">（</span><span class="n">仅仅是访问</span><span class="err">，</span><span class="n">没有改动</span><span class="err">）</span><span class="n">文件的时间</span>
<span class="n">modify</span> <span class="n">time</span><span class="err">：</span><span class="n">表示我们最后一次修改文件的时间</span>
<span class="n">change</span> <span class="n">time</span><span class="err">：</span><span class="n">表示我们最后一次对文件属性改变的时间</span><span class="err">，</span><span class="n">包括权限</span><span class="err">，</span><span class="n">大小</span><span class="err">，</span><span class="n">属性等等</span>
<span class="n">Birth</span> <span class="n">time</span> <span class="p">:</span> <span class="n">文件创建时间</span><span class="err">，</span><span class="n">crtime</span><span class="err">，</span><span class="n">不过据查此属性linux已废弃</span><span class="err">，</span><span class="n">目前状态显示结果均为</span><span class="o">-</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="netstat">
<h2>18. netstat<a class="headerlink" href="#netstat" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">netstat</span></code>：控制台命令,是一个监控TCP/IP网络的非常有用的工具，它可以显示路由表、实际的网络连接以及每一个网络接口设备的状态信息。Netstat用于显示与IP、TCP、UDP和ICMP协议相关的统计数据，一般用于检验本机各端口的网络连接情况。</p>
<ul>
<li><p>格式：<code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">[options]</span></code></p></li>
<li><p>常用options</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a或</span><span class="o">--</span><span class="nb">all</span><span class="err">：</span><span class="n">显示所有连线中的Socket</span>
<span class="o">-</span><span class="n">n或</span><span class="o">--</span><span class="n">numeric</span><span class="err">：</span><span class="n">直接使用ip地址</span><span class="err">，</span><span class="n">而不通过域名服务器</span><span class="err">。</span><span class="n">以便显示ip地址而不是主机名</span>
<span class="o">-</span><span class="n">t或</span><span class="o">--</span><span class="n">tcp</span><span class="err">：</span><span class="n">显示TCP传输协议的连线状况</span>
<span class="o">-</span><span class="n">u或</span><span class="o">--</span><span class="n">udp</span><span class="err">：</span><span class="n">显示UDP传输协议的连线状况</span>
<span class="o">-</span><span class="n">l或</span><span class="o">--</span><span class="n">listening</span><span class="err">：</span><span class="n">显示监控中的服务器的Socket</span>
<span class="o">-</span><span class="n">p或</span><span class="o">--</span><span class="n">programs</span><span class="err">：</span><span class="n">显示正在使用Socket的程序识别码</span><span class="err">（</span><span class="n">PID</span><span class="err">）</span><span class="n">和程序名称</span>
<span class="o">-</span><span class="n">s或</span><span class="o">--</span><span class="n">statistice</span><span class="err">：</span><span class="n">显示网络工作信息统计表</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="pidstat">
<h2>19. pidstat<a class="headerlink" href="#pidstat" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pidstat</span></code>：pidstat是sysstat工具中的一个命令，用于监控进程的cpu、内存、线程、IO及上下文切换等系统资源的占用情况。</p>
<ul>
<li><p>格式：<code class="docutils literal notranslate"><span class="pre">pidstat</span> <span class="pre">[</span> <span class="pre">options</span> <span class="pre">]</span> <span class="pre">[</span> <span class="pre">&lt;interval&gt;</span> <span class="pre">[</span> <span class="pre">&lt;count&gt;</span> <span class="pre">]</span> <span class="pre">]</span></code>，interval:时间间隔；count:采集次数</p></li>
<li><p>options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">u</span>	<span class="n">默认的参数</span><span class="err">，</span><span class="n">显示各个进程的cpu使用统计</span>
<span class="o">-</span><span class="n">r</span>	<span class="n">显示各个进程的内存使用情况</span>
<span class="o">-</span><span class="n">d</span>	<span class="n">显示各个进程的IO使用情况</span>
<span class="o">-</span><span class="n">w</span>	<span class="n">显示各个进程的上下文切换情况</span>
<span class="o">-</span><span class="n">t</span>	<span class="n">显示线程</span>
<span class="o">-</span><span class="n">p</span>	<span class="n">指定进程号</span>
<span class="o">-</span><span class="n">l</span>	<span class="n">显示命令名和所有参数</span>
<span class="o">-</span><span class="n">C</span>	<span class="n">仅显示Command中包含匹配字符串的进程</span>
<span class="o">-</span><span class="n">G</span>	<span class="n">显示符合匹配进程名字的进程</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="iostat">
<h2>20. iostat<a class="headerlink" href="#iostat" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iostat</span></code>：iostat用于监视系统I/O设备负载。iostat通过观察设备处于活动状态的时间（相对于其平均传输速率）来整理实时报告输出 。主要用于监视nfs网络文件系统和本地文件系统。</p>
<ul>
<li><p>格式：<code class="docutils literal notranslate"><span class="pre">iostat</span> <span class="pre">[</span> <span class="pre">选项</span> <span class="pre">]</span> <span class="pre">[&lt;时间间隔&gt;</span> <span class="pre">&lt;次数&gt;</span> <span class="pre">]</span></code></p></li>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">显示CPU统计信息</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">仅显示磁盘统计信息</span>
<span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">以</span> <span class="n">mb</span> <span class="n">为单位显示</span>
<span class="o">-</span><span class="n">x</span><span class="err">：</span><span class="n">显示更详细的磁盘报告信息</span><span class="err">，</span><span class="n">默认只显示六列</span><span class="err">，</span><span class="n">加上该参数后会显示更详细的信息</span><span class="err">。</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">输出报告时显示系统时间</span><span class="err">。</span>
<span class="o">-</span><span class="n">y</span><span class="err">：</span><span class="n">跳过不显示第一次报告的数据</span><span class="err">，</span><span class="n">因为iostat使用的是采样统计</span><span class="err">，</span><span class="n">所以iostat的第一次输出的数据是自系统启动以来的累计的数据</span><span class="err">。</span>
</pre></div>
</div>
<ul class="simple">
<li><p>注：-y 这个参数非常重要，因为第一次数据不属于正常数据，所以如果做数据统计时，计入了统计，会影响最终数据结果。</p></li>
</ul>
</li>
<li><p>返回值详解</p>
<ul>
<li><p>avg-cpu 段：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">usr</span> 	<span class="c1"># CPU在用户模式下的时间百分比</span>
<span class="o">%</span><span class="n">nice</span> 	<span class="c1"># CPU处在带NICE值的用户模式下的时间百分比</span>
<span class="o">%</span><span class="n">system</span>  <span class="c1"># CPU在系统模式下的时间百分比</span>
<span class="o">%</span><span class="n">iowait</span> 	<span class="c1"># CPU等待输入输出完成时间的百分比</span>
<span class="o">%</span><span class="n">steal</span> 	<span class="c1"># 管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比</span>
<span class="o">%</span><span class="n">idle</span> 	<span class="c1"># CPU空闲时间百分比</span>
</pre></div>
</div>
</li>
<li><p>Device 段</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tps</span> 	<span class="c1"># 该设备每秒的传输次数（Indicate the number of transfers per second that were issued to the device.）。“一次传输&quot;意思是&quot;一次I/O请求”。多个逻辑请求可能会被合并为&quot;一次I/O请求&quot;。&quot;一次传输&quot;请求的大小是未知的。</span>
<span class="n">kB_read</span><span class="o">/</span><span class="n">s</span> 	<span class="c1"># 每秒从设备读取的数据量</span>
<span class="n">kB_wrtn</span><span class="o">/</span><span class="n">s</span> 	<span class="c1"># 每秒向设备写入的数据量</span>
<span class="n">kB_read</span> 	<span class="c1"># 读取的总数据量</span>
<span class="n">kB_wrtn</span> 	<span class="c1"># 写入的总数据量</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="chroot">
<h2>21. chroot<a class="headerlink" href="#chroot" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chroot</span></code>: 即 change root directory (更改 root 目录)。在 linux 系统中，系统默认的目录结构都是以 /，即是以根 (root) 开始的。而在使用 chroot 之后，系统的目录结构将以指定的位置作为 / 位置。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ldd">
<h2>22. ldd<a class="headerlink" href="#ldd" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ldd</span></code>: ldd用来打印或者查看程序运行所需的共享库,常用来解决程序因缺少某个库文件而不能运行的一些问题。ldd不是一个可执行程序，而只是一个shell脚本。</p>
<ul>
<li><p>格式：<code class="docutils literal notranslate"><span class="pre">ldd</span> <span class="pre">[optins]...</span> <span class="pre">file...</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">–</span><span class="n">help</span> <span class="p">:</span> <span class="n">获取指令帮助信息</span><span class="err">；</span>
<span class="err">–</span><span class="n">version</span> <span class="p">:</span> <span class="n">打印指令版本号</span><span class="err">；</span>
<span class="o">-</span><span class="n">d</span><span class="p">,</span><span class="err">–</span><span class="n">data</span><span class="o">-</span><span class="n">relocs</span> <span class="p">:</span> <span class="n">执行重定位和报告任何丢失的对象</span><span class="err">；</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">function</span><span class="o">-</span><span class="n">relocs</span> <span class="p">:</span> <span class="n">执行数据对象和函数的重定位</span><span class="err">，</span><span class="n">并且报告任何丢失的对象和函数</span><span class="err">；</span>
<span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">unused</span> <span class="p">:</span> <span class="n">打印未使用的直接依赖</span><span class="err">；</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span> <span class="p">:</span> <span class="n">详细信息模式</span><span class="err">，</span><span class="n">打印所有相关信息</span><span class="err">；</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="susu">
<h2>23. su和su -<a class="headerlink" href="#susu" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">su</span></code>和<code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-</span></code>：linux系统中su 和 su - 都是用于登录用于切换的命令</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">su</span></code>：切换用户，环境变量不变，路径不变（会使得某些命令不可用）,<code class="docutils literal notranslate"><span class="pre">su</span></code>切换用户生成的shell是非登陆shell。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-</span></code> : 切换用户，环境变量随切换用户发生改变，回到家目录,<code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-</span></code> 切换用户生成的shell是登陆shell。</p>
<ul>
<li><p><img alt="Alt text" src="../_images/2023-05-16_012319_593419.png" /></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="cut">
<h2>24. cut<a class="headerlink" href="#cut" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span></code> 命令 ：cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段输出。</p>
<ul>
<li><p>语法：cut [选项参数] file</p>
<ul>
<li><p>选项参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">d</span> <span class="n">分割符</span><span class="err">：</span><span class="n">指定分隔符</span><span class="err">，</span><span class="n">按照指定分隔符分割列</span><span class="err">。</span><span class="n">与</span> <span class="o">-</span><span class="n">f</span> <span class="n">一起使用</span>
<span class="o">-</span><span class="n">f</span> <span class="n">column</span><span class="p">,</span><span class="n">column1</span><span class="o">...</span><span class="err">：</span><span class="n">根据</span> <span class="err">`</span><span class="o">-</span><span class="n">d</span> <span class="n">分割符</span><span class="err">`</span><span class="n">的分隔符将一段信息分割成为数段</span><span class="err">，</span><span class="n">用</span> <span class="err">`</span><span class="o">-</span><span class="n">f</span> <span class="n">column</span> <span class="n">取出第几段的意思</span><span class="err">（</span><span class="n">column</span><span class="p">:</span><span class="n">列号</span><span class="err">，</span><span class="n">提取第几列</span><span class="err">，</span><span class="n">提取多列时用逗号分开列号</span><span class="err">）</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">以字符</span> <span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="n">的单位取出固定字符区间</span>
<span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">以字节为单位进行分割</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id3">
<h2>25. 24 释放内存<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<ul>
<li><p>释放内存</p>
<ul>
<li><p>在Linux系统下，我们一般不需要去释放内存，因为系统已经将内存管理的很好。但是凡事也有例外，有的时候内存会被缓存占用掉，导致系统使用SWAP空间影响性能，此时就需要执行释放内存（清理缓存）的操作了。</p></li>
<li><p>Linux系统的缓存机制是相当先进的，他会针对dentry（用于VFS，加速文件路径名到inode的转换）、Buffer Cache（针对磁盘块的读写）和Page Cache（针对文件inode的读写）进行缓存操作。但是在进行了大量文件操作之后，缓存会把内存资源基本用光。但实际上我们文件操作已经完成，这部分缓存已经用不到了。这个时候，我们就有必要来手动进行Linux下释放内存的操作，其实也就是释放缓存的操作了。</p></li>
<li><p>要达到释放缓存的目的，我们首先需要了解下关键的配置文件<code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/drop_caches</span></code>。这个文件中记录了缓存释放的参数，默认值为0，也就是不释放缓存。他的值可以为0~3之间的任意数字，代表着不同的含义：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="err">–</span> <span class="n">不释放</span>
<span class="mi">1</span> <span class="err">–</span> <span class="n">释放页缓存</span>
<span class="mi">2</span> <span class="err">–</span> <span class="n">释放dentries和inodes</span>
<span class="mi">3</span> <span class="err">–</span> <span class="n">释放所有缓存</span>
</pre></div>
</div>
</li>
<li><p>操作步骤：/proc/buddyinfo？？？？？？？？？？？？？？？？？？？？</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">free</span> <span class="pre">-h</span></code>：查看内存信息。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync</span></code>：将所有未写的系统缓冲区写到磁盘中，包含已修改的 i-node、已延迟的块 I/O 和读写映射文件。否则在释放缓存的过程中，可能会丢失未保存的文件。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">3</span> <span class="pre">&gt;</span> <span class="pre">/proc/sys/vm/drop_caches</span></code>：将需要的参数写进/proc/sys/vm/drop_caches文件中，比如我们需要释放所有缓存就写入3。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span> <span class="pre">-h</span></code>：查看内存信息。</p></li>
</ol>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id4">
<h2>26. 硬件查询命令<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<section id="lsusb">
<h3>26.1. 25.1 lsusb<a class="headerlink" href="#lsusb" title="Link to this heading">¶</a></h3>
<ul>
<li><p>usb：</p>
<ul class="simple">
<li><p>SB：是英文Universal Serial Bus（通用串行总线）的缩写，而其中文简称为“通串线”，是一个外部总线标准，用于规范电脑与外部设备的连接和通讯。是应用在PC领域的接口技术。USB接口支持设备的即插即用和热插拔功能。USB是在1994年底由英特尔、康柏、IBM、Microsoft等多家公司联合提出的。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsusb</span></code>：lsusb是显示系统中以及连接到系统的USB总线信息的工具。换句话说，lsusb命令用于显示本机的USB设备列表及其详细信息。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">lsusb</span> <span class="pre">[options]</span></code></p></li>
<li><p>options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span><span class="err">：</span><span class="n">显示USB设备的详细信息</span>
<span class="o">-</span><span class="n">vv</span><span class="err">：</span><span class="n">显示USB设备的完整信息</span>
<span class="o">-</span><span class="n">s</span> <span class="p">[[</span><span class="n">bus</span><span class="p">]:][</span><span class="n">devnum</span><span class="p">]</span><span class="err">：</span><span class="n">仅显示指定的总线和</span><span class="err">（</span><span class="n">或</span><span class="err">）</span><span class="n">设备号的设备</span><span class="err">。</span><span class="n">例</span><span class="err">：</span><span class="n">lsusb</span> <span class="o">-</span><span class="n">s</span> <span class="mi">008</span><span class="p">:</span><span class="mi">001</span>
<span class="o">-</span><span class="n">d</span> <span class="n">vendor</span><span class="p">:[</span><span class="n">product</span><span class="p">]</span><span class="err">：</span><span class="n">仅显示指定厂商和产品编号的设备</span>
<span class="o">-</span><span class="n">D</span><span class="err">：</span><span class="n">设备路径</span><span class="err">。</span><span class="n">不扫描</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">usb</span><span class="err">，</span><span class="n">而以指定的设备路径取代</span>
<span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">tree</span><span class="err">：</span><span class="n">以树状结构显示物理USB设备的层次</span>
<span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span><span class="err">：</span><span class="n">显示命令的版本信息</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span><span class="err">：</span><span class="n">显示命令用法和帮助信息</span>
</pre></div>
</div>
</li>
<li><p>返回值详解</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Bus</span> <span class="mi">00</span><span class="n">x</span><span class="err">：</span><span class="n">指明设备连接到哪条总线上</span><span class="err">，</span><span class="n">表示第x个usb主控制器</span><span class="err">（</span><span class="n">可以通过命令lspci</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">USB查看</span><span class="err">）。</span>
<span class="n">Device</span> <span class="n">xxx</span><span class="err">：</span><span class="n">表示系统给USB设备分配的设备号</span><span class="err">（</span><span class="n">devnum</span><span class="err">，</span><span class="n">对应usb_device</span><span class="o">.</span><span class="n">devnum</span><span class="err">），</span><span class="n">表明这是连接到总线上的第xxx个设备</span><span class="err">。</span>
<span class="n">ID</span><span class="err">：</span><span class="n">表示USB设备的ID</span><span class="err">，</span><span class="n">包括厂商ID</span><span class="err">（</span><span class="n">对应usb_device_descriptor</span><span class="o">.</span><span class="n">idVendor</span><span class="err">）</span><span class="n">和产品ID</span><span class="err">（</span><span class="n">对应usb_device_descriptor</span><span class="o">.</span><span class="n">idProduct</span><span class="err">），</span><span class="n">二者组合唯一标识该设备</span><span class="err">。</span><span class="n">格式</span> <span class="n">厂商ID</span><span class="p">:</span><span class="n">产品ID</span><span class="err">。</span>
<span class="n">Realtek</span> <span class="n">Semiconductor</span> <span class="n">Corp</span><span class="o">.</span> <span class="n">RTL8153</span> <span class="n">Gigabit</span> <span class="n">Ethernet</span> <span class="n">Adapter</span><span class="p">:</span><span class="n">生产商名字和设备名</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="lspci">
<h3>26.2. 25.2 lspci<a class="headerlink" href="#lspci" title="Link to this heading">¶</a></h3>
<ul>
<li><p>PCI</p>
<ul class="simple">
<li><p>PCI：PCI是一种外设总线规范。总线是一种传输信号的路径或信道。典型情况是，总线是连接于一个或多个导体的电气连线，总线上连接的所有设备可在同一时间收到所有的传输内容。总线由电气接口和编程接口组成。</p></li>
<li><p>PCI是Peripheral Component Interconnect（外围设备互联）的简称，是普遍使用在桌面及更大型的计算机上的外设总线。PCI架构被设计为ISA标准的替代品，它有三个主要目标：获得在计算机和外设之间传输数据时更好的性能；尽可能的与平台无关；简化往系统中添加和删除外设的工作。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lspci</span></code>：lspci是查看设备上pcie设备信息的命令。该命令的不同参数配合，在查看pcie设备和定位pcie问题时很有用。包括查看pcie设备中断号、查看配置空间内容、修改配置空间寄存器等操作。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">[options]</span></code></p></li>
<li><p>常用options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">v</span> <span class="err">：</span><span class="n">显示更多的</span> <span class="n">PCI</span> <span class="n">接口装置的详细信息</span>
<span class="o">-</span><span class="n">vv</span><span class="err">：</span><span class="n">比</span> <span class="o">-</span><span class="n">v</span> <span class="n">还要更详细的信息</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">以数字方式显示PCI厂商和设备代码</span><span class="err">；</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">以树状结构显示PCI设备的层次关系</span><span class="err">，</span><span class="n">包括所有的总线</span><span class="err">、</span><span class="n">桥</span><span class="err">、</span><span class="n">设备以及它们之间的联接</span><span class="err">；</span>
<span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">以总线为中心的视图</span><span class="err">；</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">仅显示给定厂商和设备的信息</span><span class="err">；</span>
<span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">仅显示指定总线</span><span class="err">、</span><span class="n">插槽上的设备和设备上的功能块信息</span><span class="err">；</span>
<span class="o">-</span><span class="n">i</span><span class="err">：</span><span class="n">指定PCI编号列表文件</span><span class="err">，</span><span class="n">而不使用默认的文件</span><span class="err">；</span>
<span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">以机器可读方式显示PCI设备信息</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="lsblk">
<h3>26.3. 25.3 lsblk<a class="headerlink" href="#lsblk" title="Link to this heading">¶</a></h3>
<ul>
<li><p>块设备和字符设备</p>
<ul class="simple">
<li><p>Linux中I/O设备分为两类：块设备和字符设备。两种设备本身没有严格限制，但是，基于不同的功能进行了分类。</p>
<ul>
<li><p>字符设备：提供连续的数据流，应用程序可以顺序读取，通常不支持随机存取。相反，此类设备支持按字节/字符来读写数据。举例来说，调制解调器是典型的字符设备。</p></li>
<li><p>块设备：应用程序可以随机访问设备数据，程序可自行确定读取数据的位置。硬盘是典型的块设备，应用程序可以寻址磁盘上的任何位置，并由此读取数据。此外，数据的读写只能以块(通常是512B)的倍数进行。与字符设备不同，块设备并不支持基于字符的寻址。</p></li>
<li><p>这两种设备本身并没用严格的区分，主要是字符设备和块设备驱动程序提供的访问接口（file I/O API）是不一样的。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsblk</span></code>：列出块设备信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>        <span class="n">MAJ</span><span class="p">:</span><span class="n">MIN</span> <span class="n">RM</span>   <span class="n">SIZE</span> <span class="n">RO</span> <span class="n">TYPE</span> <span class="n">MOUNTPOINT</span>
<span class="n">sda</span>           <span class="mi">8</span><span class="p">:</span><span class="mi">0</span>    <span class="mi">0</span>   <span class="mf">1.8</span><span class="n">T</span>  <span class="mi">0</span> <span class="n">disk</span> 
<span class="err">└─</span><span class="n">sda1</span>        <span class="mi">8</span><span class="p">:</span><span class="mi">1</span>    <span class="mi">0</span>   <span class="mf">1.8</span><span class="n">T</span>  <span class="mi">0</span> <span class="n">part</span> <span class="o">/</span><span class="n">home</span>
<span class="n">sdb</span>           <span class="mi">8</span><span class="p">:</span><span class="mi">16</span>   <span class="mi">1</span>  <span class="mf">28.7</span><span class="n">G</span>  <span class="mi">0</span> <span class="n">disk</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">wl</span><span class="o">/</span><span class="mi">6</span><span class="n">a427bf9</span><span class="o">-</span><span class="mi">086</span><span class="n">c</span><span class="o">-</span><span class="mi">4</span><span class="n">dea</span><span class="o">-</span><span class="mi">91</span><span class="n">df</span><span class="o">-</span><span class="n">e6ce9ac3</span>
</pre></div>
</div>
<ul class="simple">
<li><p>NAME : 这是块设备名。</p></li>
<li><p>MAJ:MIN : 显示主要和次要设备号；</p></li>
<li><p>RM : 设备是否可移动设备。RM值等于1，这说明他们是可移动设备；</p></li>
<li><p>SIZE :设备的容量大小信息。例如298.1G表明该设备大小为298.1GB，而1K表明该设备大小为1KB；</p></li>
<li><p>RO : 该项表明设备是否为只读。RO为1，不是只读的；</p></li>
<li><p>TYPE :块设备类型，比如disk磁盘，part分区，lvm逻辑卷，rom只读存储；</p></li>
<li><p>MOUNTPOINT: 设备挂载的挂载点</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="blkid">
<h3>26.4. blkid<a class="headerlink" href="#blkid" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">blkid</span></code>：打印块设备属性。blkid主要用来对系统的块设备（包括交换分区）所使用的文件系统类型、LABEL、UUID等信息进行查询。要使用这个命令必须安装<code class="docutils literal notranslate"><span class="pre">e2fsprogs</span></code>软件包。</p></li>
<li><p>语法：blkid [参数] [设备]</p>
<ul>
<li><p>常用参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="err">：</span><span class="n">指定cache文件</span><span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">blkid</span><span class="o">.</span><span class="n">tab</span><span class="p">,</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">=</span> <span class="n">none</span><span class="p">)</span>
<span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span> <span class="err">：</span><span class="n">显示指定信息</span><span class="err">，</span><span class="n">默认显示所有信息</span><span class="err">（</span><span class="o">-</span><span class="n">s</span> <span class="n">uuid显示UUID</span><span class="p">,</span><span class="o">-</span><span class="n">s</span> <span class="n">LABEL显示LABEL</span><span class="err">）</span>
<span class="o">-</span><span class="n">p</span><span class="err">：</span><span class="n">获得更详细的设备信息</span><span class="err">，</span><span class="n">后面必须跟一个设备</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
</section>
<hr class="docutils" />
<section id="find">
<h2>27. find<a class="headerlink" href="#find" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">find</span></code>：在目录结构中搜索文件，并执行指定的操作。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">pathname</span> <span class="pre">options</span> <span class="pre">[-print</span> <span class="pre">-exec</span> <span class="pre">-ok</span> <span class="pre">...]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathname</span></code>：ind 命令所查找的目录路径。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-print</span></code>：find 命令将匹配的文件输出到标准输出。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-exec</span></code>：find 命令对匹配的文件逐个执行该参数所给出的 shell 命令。相应命令的形式为<code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">{}</span> <span class="pre">\;</span></code>。<code class="docutils literal notranslate"><span class="pre">{}</span></code>占位符号，表示将find匹配到的内容放入其中；<code class="docutils literal notranslate"><span class="pre">;</span></code>表示命令结束；<code class="docutils literal notranslate"><span class="pre">\</span></code>转义<code class="docutils literal notranslate"><span class="pre">;</span></code>号。</p>
<ul class="simple">
<li><p>通过<code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">-atime</span> <span class="pre">+5</span> <span class="pre">-ok</span> <span class="pre">ls</span>&#160; <span class="pre">\;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">-atime</span> <span class="pre">+5</span> <span class="pre">-ok</span> <span class="pre">ls</span>&#160; <span class="pre">{}</span> <span class="pre">\;</span></code>可以看出<code class="docutils literal notranslate"><span class="pre">{}</span></code>的作用。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-user</span> <span class="pre">test1</span> <span class="pre">-exec</span> <span class="pre">cp</span> <span class="pre">-a</span> <span class="pre">{}</span> <span class="pre">/opt/dirtest/</span> <span class="pre">\;</span></code>：将属于test1的文件和目录拷贝到<code class="docutils literal notranslate"><span class="pre">/opt/dirtest/</span></code>目录下</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">name</span> <span class="n">按照文件名查找文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">perm</span> <span class="n">按照文件权限来查找文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">user</span> <span class="n">按照文件属主来查找文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">group</span> <span class="n">按照文件所属的组来查找文件</span><span class="err">。</span>
<span class="o">-</span> <span class="n">empty</span> <span class="n">查找空文件和空目录</span><span class="err">。</span>
<span class="o">-</span><span class="n">size</span> <span class="p">[</span><span class="o">+/-</span><span class="p">]</span><span class="n">n</span><span class="p">[</span><span class="n">bcwkMG</span><span class="p">]</span> <span class="n">按照文件大小来查找文件</span><span class="err">，</span><span class="o">+/-</span><span class="n">表示大于和小于</span>  <span class="c1"># 只有M G为大写</span>
	<span class="n">b</span>  <span class="c1"># 512字节的(默认单位)</span>
	<span class="n">c</span>  <span class="c1"># 1字节的</span>
	<span class="n">w</span> <span class="c1"># 2字节</span>
	<span class="n">k</span>  <span class="c1"># 1024字节</span>
	<span class="n">M</span>  <span class="c1"># 1024k</span>
	<span class="n">G</span>  <span class="c1"># 1024M</span>
<span class="o">-</span><span class="n">mtime</span> <span class="o">-</span><span class="n">n</span> <span class="o">+</span><span class="n">n</span> <span class="n">按照文件的更改时间来查找文件</span><span class="err">，</span> <span class="o">-</span> <span class="n">n</span> <span class="n">表示文件更改时间距现在</span> <span class="n">n</span> <span class="n">天以内</span><span class="err">，</span><span class="o">+</span> <span class="n">n</span> <span class="n">表示文件更改时间距现在</span> <span class="n">n</span> <span class="n">天以前</span><span class="err">。</span>
<span class="o">-</span><span class="n">nogroup</span> <span class="n">查找无有效所属组的文件</span><span class="err">，</span><span class="n">即该文件所属的组在</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">groups</span> <span class="n">中不存在</span><span class="err">。</span>
<span class="o">-</span><span class="n">nouser</span> <span class="n">查找无有效属主的文件</span><span class="err">，</span><span class="n">即该文件的属主在</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span> <span class="n">中不存在</span><span class="err">。</span>
<span class="o">-</span><span class="n">newer</span> <span class="n">file1</span> <span class="err">!</span> <span class="n">file2</span> <span class="n">查找更改时间比文件</span> <span class="n">file1</span> <span class="n">新但比文件</span> <span class="n">file2</span> <span class="n">旧的文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">prune</span> <span class="n">使用这一选项可以使</span> <span class="n">find</span> <span class="n">命令不在当前指定的目录中查找</span><span class="err">，</span><span class="n">如果同时使用</span><span class="o">-</span><span class="n">depth</span> <span class="n">选项</span><span class="err">，</span><span class="n">那么</span><span class="o">-</span><span class="n">prune</span> <span class="n">将被</span> <span class="n">find</span> <span class="n">命令忽略</span><span class="err">。</span>
<span class="o">-</span><span class="nb">type</span> <span class="n">查找某一类型的文件</span><span class="err">，</span><span class="n">诸如</span><span class="err">：</span>
	<span class="c1"># b - 块设备文件。</span>
	<span class="c1"># d - 目录。</span>
	<span class="c1"># c - 字符设备文件。</span>
	<span class="c1"># p - 管道文件。</span>
	<span class="c1"># l - 符号链接文件。</span>
	<span class="c1"># f - 普通文件。</span>
<span class="o">-</span><span class="n">depth</span><span class="err">：</span><span class="n">在查找文件时</span><span class="err">，</span><span class="n">首先查找当前目录中的文件</span><span class="err">，</span><span class="n">然后再在其子目录中查找</span><span class="err">。</span>
<span class="o">-</span><span class="n">fstype</span><span class="err">：</span><span class="n">查找位于某一类型文件系统中的文件</span><span class="err">，</span><span class="n">这些文件系统类型通常可以在配置文件</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span> <span class="n">中找到</span><span class="err">，</span><span class="n">该配置文件中包含了本系统中有关文件系统的信息</span><span class="err">。</span>
<span class="o">-</span><span class="n">mount</span><span class="err">：</span><span class="n">在查找文件时不跨越文件系统</span> <span class="n">mount</span> <span class="n">点</span><span class="err">。</span>
<span class="o">-</span><span class="n">follow</span><span class="err">：</span><span class="n">如果</span> <span class="n">find</span> <span class="n">命令遇到符号链接文件</span><span class="err">，</span><span class="n">就跟踪至链接所指向的文件</span><span class="err">。</span>
<span class="o">-</span><span class="n">cpio</span><span class="err">：</span><span class="n">对匹配的文件使用</span> <span class="n">cpio</span> <span class="n">命令</span><span class="err">，</span><span class="n">将这些文件备份到磁带设备中</span><span class="err">。</span>
<span class="n">另外</span><span class="err">，</span><span class="n">下面三个的区别</span><span class="err">：</span>
<span class="o">-</span><span class="n">amin</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">N</span> <span class="n">分钟访问的文件</span>
<span class="o">-</span><span class="n">atime</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">n</span><span class="o">*</span><span class="mi">24</span> <span class="n">小时访问的文件</span>
<span class="o">-</span><span class="n">cmin</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">N</span> <span class="n">分钟被改变文件状态的文件</span>
<span class="o">-</span><span class="n">ctime</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">n</span><span class="o">*</span><span class="mi">24</span> <span class="n">小时被改变文件状态的文件</span>
<span class="o">-</span><span class="n">mmin</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">N</span> <span class="n">分钟被改变文件数据的文件</span>
<span class="o">-</span><span class="n">mtime</span> <span class="n">n</span> <span class="n">查找系统中最后</span> <span class="n">n</span><span class="o">*</span><span class="mi">24</span> <span class="n">小时被改变文件数据的文件</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="chown">
<h2>28. chown<a class="headerlink" href="#chown" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">chown</span></code>：指定文件的拥有者改为指定的用户或组，用户可以是用户名或者用户ID；组可以是组名或者组ID；文件是以空格分开的要改变权限的文件列表，支持通配符。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">chown</span> <span class="pre">[选项]...</span> <span class="pre">[所有者][:[组]]</span> <span class="pre">文件...</span></code></p></li>
<li><p>常用选项</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span> <span class="n">显示更改的部分的信息</span>
<span class="o">-</span><span class="n">f</span> <span class="n">忽略错误信息</span>
<span class="o">-</span><span class="n">h</span> <span class="n">仅更改链接文件而非更改所指向的文件</span><span class="err">（</span><span class="n">不加默认修改所指向的文件</span><span class="err">）</span>
<span class="o">-</span><span class="n">R</span> <span class="n">处理指定目录以及其子目录下的所有文件</span>
<span class="o">-</span><span class="n">v</span> <span class="n">显示详细的处理信息</span>
<span class="o">--</span><span class="n">dereference</span> <span class="n">仅更改链接所指向的文件</span><span class="err">，</span><span class="n">而不修改链接文件本身</span><span class="err">（</span><span class="n">与默认一样</span><span class="err">）</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id5">
<h2>29. 标准输入和标准输出<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>标准输入和标准输出：执行一个 Shell 命令行时通常会自动打开三个标准文件。</p>
<ul>
<li><p>标准输入文件（stdin），通常对应终端的键盘。</p></li>
<li><p>标准输出文件（stdout），对应终端的屏幕，进程将从标准输入文件中得到输入数据，将正常输出数据输出到标准输出文件。</p></li>
<li><p>标准错误输出文件（stderr），对应终端的屏幕。进程将从标准输入文件中得到输入数据，将错误信息送到标准错误文件中。</p></li>
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cat</span></code>：如果cat的命令行中没有参数，它就会从标准输入（终端的键盘）中读取数据，并将其送到标准输出（终端的屏幕）。即用户输入的每一行都立刻被cat命令输出到屏幕上。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="dd">
<h2>30. dd<a class="headerlink" href="#dd" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dd</span></code>：用于读取、转换并输出数据。可从标准输入或文件中读取数据，根据指定的格式来转换数据，再输出到文件、设备或标准输出。</p>
<ul>
<li><p>dd默认从标准输入中读取，并写入到标准输出中，但可以用选项if（input file，输入文件）和of（output file，输出文件）改变</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=/opt/test1</span> <span class="pre">bs=1M</span> <span class="pre">count=10</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">代表输入文件</span><span class="err">。</span><span class="n">如果不指定</span> <span class="k">if</span><span class="err">，</span><span class="n">默认就会从</span> <span class="n">stdin</span><span class="p">(</span><span class="n">标准输入</span><span class="p">)</span> <span class="n">中读取输入</span><span class="err">。</span>
<span class="n">of</span> <span class="n">代表输出文件</span><span class="err">。</span><span class="n">如果不指定</span> <span class="n">of</span><span class="err">，</span><span class="n">默认就会将</span> <span class="n">stdout</span> <span class="p">(</span><span class="n">标准输出</span><span class="p">)</span><span class="n">作为默认输出</span><span class="err">。</span>
<span class="n">bs</span> <span class="n">同时设置读写块的大小为</span> <span class="nb">bytes</span><span class="err">。</span><span class="n">输入和输出的默认块大小为512字节</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span><span class="err">（</span><span class="n">传统的磁盘块及POSIX规定的</span><span class="err">“</span><span class="n">块</span><span class="err">”</span><span class="n">大小</span><span class="err">）</span>
<span class="n">count</span> <span class="n">代表被复制的块数</span><span class="err">，</span><span class="n">块大小等于</span> <span class="n">bs</span> <span class="n">指定的字节数</span><span class="err">。</span><span class="c1"># bs=1M，count=10就为10M；bs=1G,count=1就为1G</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">是一个字符设备</span><span class="err">，</span><span class="n">会不断返回</span> <span class="mi">0</span> <span class="n">值字节</span><span class="err">（</span>\<span class="mi">0</span><span class="err">）。</span>
</pre></div>
</div>
</li>
<li><p>例：</p>
<ul class="simple">
<li><p>创建指定大小的文件：<code class="docutils literal notranslate"><span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=/tmp/1G.txt</span> <span class="pre">bs=1M</span> <span class="pre">count=1024</span></code></p></li>
<li><p>测试磁盘写能力：<code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=/test.dbf</span> <span class="pre">bs=8k</span> <span class="pre">count=300000</span></code></p>
<ul>
<li><p>因为/dev/zero是一个伪设备，它只产生空字符流，对它不会产生IO，所以，IO都会集中在of文件中，of文件只用于写，所以这个命令相当于测试磁盘的写能力。</p></li>
</ul>
</li>
<li><p>测试磁盘读能力：<code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">dd</span> <span class="pre">if=/dev/sdb1</span> <span class="pre">of=/dev/null</span> <span class="pre">bs=8k</span> </code></p>
<ul>
<li><p>因为/dev/sdb1是一个物理分区，对它的读取会产生IO，/dev/null是伪设备，相当于黑洞，of到该设备不会产生IO，所以，这个命令的IO只发生在/dev/sdb1上，也相当于测试磁盘的读能力。</p></li>
</ul>
</li>
<li><p>测试同时读写能力：time dd if=/dev/sdb1 of=/test1.dbf bs=8k</p>
<ul>
<li><p>这个命令下，一个是物理分区，一个是实际的文件，对它们的读写都会产生IO（对/dev/sdb1是读，对/test1.dbf是写），假设他们都在一个磁盘中，这个命令就相当于测试磁盘的同时读写能力。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="sync">
<h2>31. sync<a class="headerlink" href="#sync" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sync</span></code>：强制将内存中的文件缓冲写入磁盘，更新块信息。</p>
<ul>
<li><p>在 linux/unix 系统中，在文件或数据处理过程中一般先放到内存缓冲区中，等到适当的时候再写入磁盘，以提高系统的运行效率。这样虽然可以提高磁盘写入数据的效率，但是也带来了安全隐患，如果数据还未写入磁盘时，系统断电或者其他严重问题出现时，将会导致数据丢失。</p></li>
<li><p>所以可以使用 sync 命令强制将内存缓冲区中的数据立即写入磁盘。用户通常无需执行 sync 命令，系统会自动执行 update 或 bdflush 操作，将缓冲区的数据写入磁盘。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="xargs">
<h2>32. xargs<a class="headerlink" href="#xargs" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xargs</span></code>：将标准输入转换成命令行参数。xargs可以读取标准输入和管道中的数据，用于弥补有些命令(如echo、kill、rm、ls等)不能从管道中读取数据的不足。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span> <span class="pre">-d</span> <span class="pre">:</span> <span class="pre">-f</span> <span class="pre">1,2,3,4</span> <span class="pre">/etc/passwd</span> <span class="pre">|</span> <span class="pre">echo</span></code>：使用echo，输出结果为空，因为管道右侧的echo不接受管道传来的标准输入作为参数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;hello</span> <span class="pre">world&quot;</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">echo</span></code>：xargs将管道左侧的标准输入，转为命令行参数hello world，传给第二个echo命令。<code class="docutils literal notranslate"><span class="pre">xargs</span></code>后面的命名默认是<code class="docutils literal notranslate"><span class="pre">echo</span></code>，即<code class="docutils literal notranslate"><span class="pre">xargs</span> <span class="pre">echo</span></code>。</p></li>
<li><p>命令格式：<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">command</span> <span class="pre">|</span> <span class="pre">]</span> <span class="pre">xargs</span> <span class="pre">[options]</span>&#160; <span class="pre">[command]</span></code></p>
<ul>
<li><p>真正的输出为xargs后面的command，这个command接受xargs传来的参数。</p></li>
<li><p>options：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">d</span> <span class="n">分隔符</span>		<span class="c1"># 指定分隔符。xargs默认将换行符和空格作为分隔符，把标准输入分解成一个个命令行参数。</span>
<span class="o">-</span><span class="n">p</span> 		<span class="c1"># -p参数打印出要执行的命令，询问用户是否要执行。</span>
<span class="o">-</span><span class="n">t</span> 		<span class="c1"># -t参数则是打印出最终要执行的命令，然后直接执行，不需要用户确认。</span>
<span class="o">-</span><span class="n">a</span> <span class="n">file</span> 	<span class="c1"># 从文件中读入作为 stdin</span>
<span class="o">-</span><span class="n">E</span> <span class="n">flag</span> 	<span class="c1"># 注意有的时候可能会是-e，flag必须是一个以空格分隔的标志，当xargs分析到含有flag这个标志的时候就停止。</span>
<span class="o">-</span><span class="n">n</span> <span class="n">num</span> 		<span class="c1"># 后面加次数，表示命令在执行的时候一次用的argument的个数，默认是用所有的。</span>
<span class="o">-</span><span class="n">i</span> 		<span class="c1"># -i参数直接用， {}就能代替管道之前的标准输出的内容。</span>
<span class="o">-</span><span class="n">r</span> <span class="n">no</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">empty</span> 		<span class="c1"># 当xargs的输入为空的时候则停止xargs，不用再去执行了。</span>
<span class="o">-</span><span class="n">s</span> <span class="n">num</span> 		<span class="c1"># 命令行的最大字符数，指的是 xargs 后面那个命令的最大命令行字符数。</span>
<span class="o">-</span><span class="n">L</span> <span class="n">num</span> 		<span class="c1"># 从标准输入一次读取 num 行送给 command 命令。</span>
<span class="o">-</span><span class="n">l</span> 		<span class="c1"># 同 -L。</span>
<span class="o">-</span><span class="n">x</span> 		<span class="c1"># exit的意思，主要是配合-s使用。。</span>
<span class="o">-</span><span class="n">P</span> 		<span class="c1"># 修改最大的进程数，默认是1</span>
</pre></div>
</div>
</li>
<li><p>例：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;test1</span> <span class="pre">test2</span> <span class="pre">test3&quot;</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">mkdir</span></code>：xargs将one two three分解成三个命令行参数(默认以换行和空格作为分割符)，等同于<code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">one</span> <span class="pre">two</span> <span class="pre">three</span></code>。如果不加xargs就会报错，提示mkdir缺少操作参数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;test1</span> <span class="pre">test2</span> <span class="pre">&#64;</span> <span class="pre">test4&quot;</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">-E</span> <span class="pre">&#64;</span> <span class="pre">mkdir</span></code>：只会创建test1和test2目录，<code class="docutils literal notranslate"><span class="pre">-E</span> <span class="pre">&#64;</span></code>指定遇到<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>就停止。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span> <span class="pre">&quot;</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">-n3</span></code>：输出的结果为两行，一行3个数。<code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">3</span></code>表示命令在执行的时候一次用的argument的个数。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="fuser">
<h2>33. fuser<a class="headerlink" href="#fuser" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fuser</span></code>：用以由文件或设备去找出使用文件、或设备的进程。可以显示出当前哪个程序在使用磁盘上的某个文件、挂载点、甚至网络端口，并给出程序进行的详细信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">i</span><span class="err">：</span><span class="n">interactive</span> <span class="n">杀掉进程前询问用户</span><span class="err">，</span><span class="n">如果没有</span><span class="o">-</span><span class="n">k这个选项会被忽略</span><span class="err">。</span>
<span class="o">-</span><span class="n">k</span><span class="err">：</span><span class="n">kill</span> <span class="n">杀掉访问文件的进程</span><span class="err">。</span>
<span class="o">-</span><span class="n">m</span><span class="p">:</span><span class="n">mount</span> <span class="n">指定一个挂载文件系统上的文件或者被挂载的块设备</span><span class="err">。</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span> <span class="n">namespace</span> <span class="n">指定一个不同的命名空间</span><span class="err">，</span><span class="n">支持的空间有</span><span class="err">：</span><span class="n">文件名</span><span class="err">（</span><span class="n">默认</span><span class="err">）、</span><span class="n">tcp</span><span class="err">（</span><span class="n">本地tcp端口</span><span class="err">）、</span><span class="n">udp</span><span class="err">（</span><span class="n">本地udp端口</span><span class="err">），</span><span class="n">对于端口号或者名称</span><span class="err">，</span><span class="n">如果不会引起歧义那么可以使用简单表示的形式</span><span class="err">，</span><span class="n">例如</span><span class="err">：</span><span class="n">name</span><span class="o">/</span><span class="n">space</span><span class="err">（</span><span class="n">即形如</span><span class="err">：</span><span class="mi">5000</span><span class="o">/</span><span class="n">tcp的表示</span><span class="err">）。</span>
<span class="o">-</span><span class="n">u</span><span class="err">：</span><span class="n">user</span> <span class="n">在每个进程后显示所属的用户名</span><span class="err">。</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">verbose</span> <span class="n">输出详细信息</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="sort">
<h2>34. sort<a class="headerlink" href="#sort" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span></code></p>
<ul>
<li><p>以行为单位对文件内容进行排序，也可以根据不同的数据类型来排序。</p></li>
<li><p>比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。</p>
<ul class="simple">
<li><p>以数字开头的行，将出现在以字母开头的行之前。</p></li>
<li><p>排在字母表前面的字母的行，将出现在排在字母表后字母行的之前。</p></li>
<li><p>以小写字母开头的行，将出现在以大写字母开头的行之前。</p></li>
</ul>
</li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">[options]</span> <span class="pre">[file]</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">n</span>	<span class="err">：</span><span class="n">按照数字进行排序</span>
<span class="o">-</span><span class="n">r</span>	<span class="err">：</span><span class="n">反向排序</span><span class="p">(</span><span class="n">默认从小到大</span><span class="p">)</span>
<span class="o">-</span><span class="n">u</span>	<span class="err">：</span><span class="n">等同于uniq</span><span class="err">，</span><span class="n">表示相同的数据仅显示一行</span>
<span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">分隔符号</span><span class="o">&gt;</span>	<span class="err">：</span><span class="n">指定字段分隔符</span><span class="err">，</span><span class="n">默认使用</span><span class="p">[</span><span class="n">Tab</span><span class="p">]</span><span class="n">键分隔</span>
<span class="o">-</span><span class="n">k</span> <span class="n">n</span>	<span class="err">：</span><span class="n">指定排序字段</span><span class="err">，</span><span class="n">n为列数</span>
<span class="o">-</span><span class="n">f</span>	<span class="err">：</span><span class="n">忽略大小写</span><span class="err">，</span><span class="n">会将小写字母都转换为大写字母来进行比较</span>
<span class="o">-</span><span class="n">b</span>	<span class="err">：</span><span class="n">忽略每行前面的空格</span>
<span class="o">-</span><span class="n">o</span>	<span class="o">&lt;</span><span class="n">输出文件</span><span class="o">&gt;</span><span class="err">：</span><span class="n">将排序后的结果转存至指定文件</span>
<span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span><span class="o">-</span><span class="n">sort</span><span class="err">：</span><span class="n">在文本内进行自然版本排序</span>
</pre></div>
</div>
</li>
<li><p>例：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">-t</span> <span class="pre">':'</span> <span class="pre">-k</span> <span class="pre">4</span> <span class="pre">-nr</span> <span class="pre">/etc/passwd</span></code> -o test：以<code class="docutils literal notranslate"><span class="pre">:</span></code>为分隔符，第4列为排序字段，按照数字反向排序并将结果转存到test文件(覆盖写入的)。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="uniq">
<h2>35. uniq<a class="headerlink" href="#uniq" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uniq</span></code>：去重，统计重复次数。用于报告或者忽略文件中连续的重复行（注意连续，当重复的行不相邻时，uniq是不起作用的），所以常与 sort 命令结合使用。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">uniq</span> <span class="pre">[options]</span> <span class="pre">[file]</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span>	<span class="err">：</span><span class="n">进行计数</span><span class="err">，</span><span class="n">并删除文件中重复出现的行</span>
<span class="o">-</span><span class="n">d</span>	<span class="err">：</span><span class="n">仅显示连续的重复行</span>
<span class="o">-</span><span class="n">u</span>	<span class="err">：</span><span class="n">仅显示出现一次的行</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="tr">
<h2>36. tr<a class="headerlink" href="#tr" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tr</span></code>：替换，删除，压缩。常用来对来自标准输入的字符进行替换、压缩和删除。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">tr</span> <span class="pre">[options]</span> <span class="pre">set1</span> <span class="pre">[set2]</span></code>。<code class="docutils literal notranslate"><span class="pre">set1</span></code>字符集1，<code class="docutils literal notranslate"><span class="pre">set2</span></code>字符集2</p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span>	<span class="err">：</span><span class="n">保留字符集1的字符</span><span class="err">，</span><span class="n">其他的字符</span><span class="err">（</span><span class="n">包括换行符</span>\<span class="n">n</span><span class="err">）</span><span class="n">用字符集2替换</span>
<span class="o">-</span><span class="n">d</span>	<span class="err">：</span><span class="n">删除所有属于字符集1的字符</span>
<span class="o">-</span><span class="n">s</span>	<span class="err">：</span><span class="mf">1.</span><span class="n">将重复出现的字符串压缩为一个字符串</span><span class="err">；</span><span class="mf">2.</span><span class="n">用字符集2</span> <span class="n">替换</span> <span class="n">字符集12023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">26</span> <span class="mi">10</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">11</span> <span class="n">星期三</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span>&#160; <span class="pre">-d</span>&#160; <span class="pre">&quot;aa\n\n\n\n\nbb&quot;</span>&#160; <span class="pre">|</span>&#160; <span class="pre">tr</span>&#160; <span class="pre">-s</span>&#160; <span class="pre">&quot;\n&quot;</span></code>：删除空行；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">'thhhhhhis</span> <span class="pre">iiisssss</span> <span class="pre">mmmmy</span> <span class="pre">firrrrrst</span> <span class="pre">wrrrrrrite'</span> <span class="pre">|</span> <span class="pre">tr</span> <span class="pre">-s</span> <span class="pre">'hismr'</span></code>：将重复出现的字符串压缩为一个字符串；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;abc&quot;</span> <span class="pre">|</span> <span class="pre">tr</span> <span class="pre">-s</span> <span class="pre">&quot;ac&quot;</span> <span class="pre">&quot;12&quot;</span></code>:将ac替换为12。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="split">
<h2>37. split<a class="headerlink" href="#split" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span></code>:拆分文件，将一个大的文件拆分成若干小文件。</p>
<ul>
<li><p>语法：split [options] [file] [拆分后设置的文件名前缀]。前缀不指定默认为x。</p>
<ul>
<li><p>常用选项</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="err">：</span><span class="n">以行数拆分</span>
<span class="o">-</span><span class="n">b</span> <span class="n">nK</span><span class="o">|</span><span class="n">M</span><span class="o">|</span><span class="n">G</span><span class="o">|</span><span class="n">T</span><span class="o">|</span><span class="n">P</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">Z</span><span class="o">|</span><span class="n">Y</span><span class="err">：</span><span class="n">以大小拆分</span><span class="err">，</span><span class="n">指定每个输出文件的字节大小为nK</span><span class="o">|</span><span class="n">M</span><span class="o">|</span><span class="n">G</span><span class="o">|</span><span class="n">T</span><span class="o">|</span><span class="n">P</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">Z</span><span class="o">|</span><span class="n">Y</span><span class="p">,</span><span class="n">默认为byte</span>
<span class="o">-</span><span class="n">d</span> <span class="err">：</span><span class="n">使用数字后缀代替字母后缀</span>
<span class="o">-</span><span class="n">a</span> <span class="n">N</span><span class="err">：</span><span class="n">指定后缀长度为N</span> <span class="p">(</span><span class="n">默认为2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>例</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span> <span class="pre">-b</span> <span class="pre">3</span> <span class="pre">-d</span> <span class="pre">-a</span> <span class="pre">1</span> <span class="pre">test.txt</span> <span class="pre">te</span></code>：每三行拆分文件，输出的文件名以te为前缀，数字为后缀且后缀长度为1。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="paste">
<h2>38. paste<a class="headerlink" href="#paste" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">paste</span></code>：将每个指定文件里的每一行整合到对应一行里写到标准输出，之间用制表符分隔。</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">paste</span> <span class="pre">[选项]...</span> <span class="pre">[文件1]</span> <span class="pre">[文件2]...</span></code></p>
<ul>
<li><p>常用选项</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">指定输出后的内容的分隔符号</span><span class="err">，</span><span class="n">默认为制表符</span><span class="err">。</span>
<span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">不使用平行的行目输出模式</span><span class="err">，</span><span class="n">而是每个文件占用一行</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="eval">
<h2>39. eval<a class="headerlink" href="#eval" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">eval</span></code>：扫描两次执行命令（放在命令前使用）</p>
<ul>
<li><p>命令前加上eval时，shell就会在执行命令之前扫描它两次.</p></li>
<li><p>eval命令将首先会先扫描命令行进行所有的置换，然后再执行该命令。</p></li>
<li><p>该命令适用于那些一次扫描无法实现其功能的变量。该命令对变量进行两次扫描。</p></li>
<li><p>例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;test&#39;</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span>
<span class="n">var</span><span class="o">=</span><span class="s2">&quot;cat test.txt&quot;</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">var</span>   <span class="c1"># 此时输出结果为 cat test.txt</span>
<span class="nb">eval</span> <span class="err">$</span><span class="n">var</span>   <span class="c1"># 此时输出结果为 test</span>
</pre></div>
</div>
</li>
<li><p>例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;#!/bin/bash</span><span class="se">\n</span><span class="s1">eval echo \$$#&#39;</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">.</span><span class="n">sh</span>
<span class="n">bash</span> <span class="n">test</span><span class="o">.</span><span class="n">sh</span> <span class="mi">1</span> <span class="mi">2</span>   <span class="c1"># 输出结果为2</span>
<span class="n">bash</span> <span class="n">test</span><span class="o">.</span><span class="n">sh</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="c1">#输出结果为3</span>
<span class="n">先输出</span><span class="err">$</span><span class="c1">#，即当前脚本传入参数的数量(比如3个)；再输出$3，即输出第三个参数的值。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id6">
<h2>40. 守护进程<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>守护进程(daemon)是一类在后台运行的特殊进程，用于执行特定的系统任务。很多守护进程在系统引导的时候启动，并且一直运行直到系统关闭。另一些只在需要的时候才启动，完成任务后就自动结束。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="shift">
<h2>41. shift<a class="headerlink" href="#shift" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">shift</span></code></p>
<ul>
<li><p>用于对参数的移动（左移），通常用于在不知道传入参数个数的情况下依次遍历每个参数然后进行相应处理。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift</span></code>（shift 1)命令每执行一次，变量的个数<code class="docutils literal notranslate"><span class="pre">$#</span></code>减一（之前的<code class="docutils literal notranslate"><span class="pre">$1</span></code>变量被销毁，之后的<code class="docutils literal notranslate"><span class="pre">$2</span></code>就变成了<code class="docutils literal notranslate"><span class="pre">$1</span></code>），而变量值提前一位。</p></li>
<li><p>同理，<code class="docutils literal notranslate"><span class="pre">shift</span> <span class="pre">n</span></code>后，前n位参数都会被销毁，如：输入5个参数（a b c d e），那么$1=a，$2=b，$3=c，$4=d，$5=e，执行shift 3操作后，前3个参数a、b、c被销毁，就剩下了2个参数：d，e（这时d=$1，e=$2，其中d由$4 变为 $1，e由$5 变为 $2），参考示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vim test.sh</span>
<span class="c1">#!/bin/bash</span>
<span class="n">until</span> <span class="p">[</span> <span class="err">$</span><span class="c1"># -eq 0 ]</span>
<span class="n">do</span>
	<span class="n">echo</span> <span class="s2">&quot;第一个参数为：$1 参数个数为：$#&quot;</span>
	<span class="n">shift</span>
<span class="n">done</span>

<span class="n">执行以上程序</span><span class="err">：</span> <span class="o">./</span><span class="n">test</span><span class="o">.</span><span class="n">sh</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span>
<span class="c1"># 结果如下：</span>
<span class="n">第一个参数为</span><span class="p">:</span> <span class="n">a</span> <span class="n">参数个数为</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">第一个参数为</span><span class="p">:</span> <span class="n">b</span> <span class="n">参数个数为</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">第一个参数为</span><span class="p">:</span> <span class="n">c</span> <span class="n">参数个数为</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">第一个参数为</span><span class="p">:</span> <span class="n">d</span> <span class="n">参数个数为</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">第一个参数为</span><span class="p">:</span> <span class="n">e</span> <span class="n">参数个数为</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="mountpoint">
<h2>42. mountpoint<a class="headerlink" href="#mountpoint" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mountpoint</span></code>命令用来判断指定的目录是否是加载点，如果是挂载点返回0，如果不是就返回非0;</p></li>
<li><p>设备总是挂载在某个指定的目录下，所以就可以使用mountpoint这条命令来确认某个目录是否“临时性”的被文件系统占用。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">mountpoint</span> <span class="pre">[参数]</span> <span class="pre">[目录]</span></code></p>
<ul>
<li><p>常用参数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">q</span><span class="err">：</span><span class="n">不打印任何信息</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">打印文件系统的主设备号和次设备号</span>
<span class="o">-</span><span class="n">x</span><span class="err">：</span><span class="n">打印块数设备的主设备号和次设备号</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="mount">
<h2>43. mount<a class="headerlink" href="#mount" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mount</span></code>可以将分区挂接到Linux的一个文件夹下，从而将分区和该目录联系起来，因此我们只要访问这个文件夹，就相当于访问该分区了。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">语法</span></code>：<code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">[-t</span> <span class="pre">vfstype]</span> <span class="pre">[-o</span> <span class="pre">options]</span> <span class="pre">device</span> <span class="pre">dir</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">vfstype</span></code>：指定文件系统的类型，通常不必指定，mount 会自动选择正确的类型。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">光盘或光盘镜像</span><span class="err">：</span><span class="n">iso9660</span> 
<span class="n">DOS</span> <span class="n">fat16文件系统</span><span class="err">：</span><span class="n">msdos</span> 
<span class="n">Windows</span> <span class="mi">9</span><span class="n">x</span> <span class="n">fat32文件系统</span><span class="err">：</span><span class="n">vfat</span> 
<span class="n">Windows</span> <span class="n">NT</span> <span class="n">ntfs文件系统</span><span class="err">：</span><span class="n">ntfs</span> 
<span class="n">Mount</span> <span class="n">Windows文件网络共享</span><span class="err">：</span><span class="n">smbfs</span> 
<span class="n">UNIX</span><span class="p">(</span><span class="n">LINUX</span><span class="p">)</span> <span class="n">文件网络共享</span><span class="err">：</span><span class="n">nfs</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">options</span></code>：主要用来描述设备或档案的挂接方式。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span><span class="err">：</span><span class="n">用来把一个文件当成硬盘分区挂接上系统</span> 
<span class="n">ro</span><span class="err">：</span><span class="n">采用只读方式挂接设备</span> 
<span class="n">rw</span><span class="err">：</span><span class="n">采用读写方式挂接设备</span> 
<span class="n">iocharset</span><span class="err">：</span><span class="n">指定访问文件系统所用字符集</span>
</pre></div>
</div>
</li>
<li><p>device：要挂接(mount)的设备。</p></li>
<li><p>dir：设备在系统上的挂接点(mount point)。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="lsmod">
<h2>44. lsmod<a class="headerlink" href="#lsmod" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lsmod</span></code>：执行lsmod指令，会列出所有已载入系统的模块。实际是读取、分析<code class="docutils literal notranslate"><span class="pre">/proc/modules</span></code>，可以用<code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/modules</span></code>命令输出已加载模块信息。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lsmod</span></code>其实就是list modules的缩写，即列出所有模块.</p></li>
</ul>
</li>
<li><p>返回值详解</p>
<ul>
<li><p>以<code class="docutils literal notranslate"><span class="pre">scsi_mod		249856</span>&#160; <span class="pre">10</span> <span class="pre">virtio_scsi,sd_mod,scsi_transport_iscsi,mptctl,iscsi_tcp,ib_iser,libiscsi,libata,sg,sr_mod</span></code> 为例：</p>
<ul>
<li><p>第1列：表示模块的名称，如scsi_mod表示scsi模块。</p></li>
<li><p>第2列：表示模块的大小，如249856表示scsi_mod模块的大小为249856字节。</p></li>
<li><p>第3列：表示依赖模块的个数，如7表示有10个模块依赖scsi_mod模块。</p></li>
<li><p>第4列：表示依赖模块的内容</p></li>
</ul>
</li>
</ul>
</li>
<li><p>通常使用<code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">linxsmp</span></code>这样的命令来查询当前系统是否加载了某些模块。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="depmod-depend-module">
<h2>45. depmod（depend module）<a class="headerlink" href="#depmod-depend-module" title="Link to this heading">¶</a></h2>
<ul>
<li><p>depmod分析您的内核模块（在目录<code class="docutils literal notranslate"><span class="pre">/lib/modules/kernel-release</span></code>中）并创建一个依赖项列表（名为<code class="docutils literal notranslate"><span class="pre">modules.dep</span></code>），以便在使用<code class="docutils literal notranslate"><span class="pre">modprobe</span></code>添加和删除模块时，没有其他模块的模块就不会存在要求。同时，它创建一个映射，将硬件标识符与处理它们的模块相关联。该映射用于在硬件请求时找到正确的模块。</p></li>
<li><p>内核依靠depmod和modprobe将其原始数据传递给其模块，以使其需要加载它们的顺序。</p></li>
<li><p>Linux内核模块可以提供供其他模块使用的服务（称为“符号”）（使用代码中的EXPORT_SYMBOL变体之一）。如果第二个模块使用此符号，则该第二个模块显然取决于第一个模块。这些依赖关系可能变得非常复杂。<code class="docutils literal notranslate"><span class="pre">depmod</span></code>通过读取<code class="docutils literal notranslate"><span class="pre">/lib/modules/kernel-release</span></code>下的每个模块并确定导出的符号和所需的符号来创建模块依赖关系列表。默认情况下，此列表写入同一目录下的<code class="docutils literal notranslate"><span class="pre">modules.dep</span></code>和二进制散列版本模块<code class="docutils literal notranslate"><span class="pre">modules.dep.bin</span></code>中。如果在命令行上给出了文件名，则仅检查那些模块（除非列出了所有模块，否则很少有用）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depmod</span></code>还会在名为<code class="docutils literal notranslate"><span class="pre">modules.symbols</span></code>的文件及其二进制哈希版本<code class="docutils literal notranslate"><span class="pre">modules.symbols.bin</span></code>中创建模块提供的符号列表。</p></li>
<li><p>最后，如果模块提供了特殊的设备名称（devname），则应在启动时通过<code class="docutils literal notranslate"><span class="pre">/dev</span></code>等实用程序填充特殊的设备名称（devname），从而depmod将输出一个名为<code class="docutils literal notranslate"><span class="pre">modules.devname</span></code>的文件。</p></li>
<li><p>如果提供了版本，则使用该内核版本的模块目录，而不是当前内核版本（由uname -r返回）</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">depmod</span> <span class="pre">[-adeisvV][-m</span> <span class="pre">&lt;文件&gt;][--help][模块名称]</span></code></p>
<ul>
<li><p>参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a或</span><span class="o">--</span><span class="nb">all</span><span class="err">：</span><span class="n">分析所有可用的模块</span><span class="err">，</span><span class="n">以便使用</span><span class="err">`</span><span class="n">modprobe</span><span class="err">`</span><span class="n">添加或删除模块</span><span class="err">，</span><span class="n">以确保我们正在安装的模块知道所有现有模块和依赖项</span>
<span class="o">-</span><span class="n">d或debug</span><span class="err">：</span><span class="n">执行排错模式</span>
<span class="o">-</span><span class="n">e</span><span class="err">：</span><span class="n">输出无法参照的符号</span>
<span class="o">-</span><span class="n">i</span><span class="err">：</span><span class="n">不检查符号表的版本</span>
<span class="o">-</span><span class="n">s或</span><span class="o">--</span><span class="n">system</span><span class="o">-</span><span class="n">log</span><span class="err">：</span><span class="n">在系统记录中记录错误</span>
<span class="o">-</span><span class="n">v或</span><span class="o">--</span><span class="n">verbose</span><span class="err">：</span><span class="n">执行时显示详细的信息</span>
<span class="o">-</span><span class="n">V或</span><span class="o">--</span><span class="n">version</span><span class="err">：</span><span class="n">显示版本信息</span>
<span class="o">-</span><span class="n">m</span><span class="o">&lt;</span><span class="n">文件</span><span class="o">&gt;</span><span class="n">或system</span><span class="o">-</span><span class="nb">map</span><span class="o">&lt;</span><span class="n">文件</span><span class="o">&gt;</span><span class="err">：</span><span class="n">使用指定的符号表文件</span>
<span class="o">--</span><span class="n">help</span><span class="err">：</span><span class="n">显示帮助</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="modprobe">
<h2>46. modprobe<a class="headerlink" href="#modprobe" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">modprobe</span></code>可以显示内核中的模块、查看模块的配置文件、加载模块及卸载模块。<code class="docutils literal notranslate"><span class="pre">modprobe</span></code>可载入指定的个别模块，或是加载一组有依赖关系的模块。<code class="docutils literal notranslate"><span class="pre">modprobe</span></code>会根据<code class="docutils literal notranslate"><span class="pre">depmod</span></code>所产生的相依关系，决定要载入哪些模块。若在载入过程中发生错误，在<code class="docutils literal notranslate"><span class="pre">modprobe</span></code>会卸载整组的模块。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">modprobe</span> <span class="pre">[options]</span> <span class="pre">[模块名]</span></code></p>
<ul>
<li><p>options</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">载入全部的模块</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">查看模块的配置文件</span><span class="err">，</span><span class="n">比如模块的别名等信息</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">使用排错模式</span>
<span class="o">-</span><span class="n">l</span><span class="err">：</span><span class="n">显示可用的模块</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">卸载模块</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">指定模块类型</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">执行时显示详细的信息</span>
<span class="o">-</span><span class="n">V</span><span class="err">：</span><span class="n">显示版本信息</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ldconfig">
<h2>47. ldconfig<a class="headerlink" href="#ldconfig" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>主要是在默认搜寻目录<code class="docutils literal notranslate"><span class="pre">/lib/</span></code>和<code class="docutils literal notranslate"><span class="pre">/usr/lib/</span></code>以及动态库配置文件<code class="docutils literal notranslate"><span class="pre">/etc/ld.so.conf</span></code>内所列的目录下，搜索出可共享的动态链接库（格式如lib*.so*）,进而创建出动态装入程序(ld.so)所需的连接和缓存文件，缓存文件默认为<code class="docutils literal notranslate"><span class="pre">/etc/ld.so.cache</span></code>，此文件保存已排好序的动态链接库名字列表。linux下的共享库机制采用了类似高速缓存机制，将库信息保存在<code class="docutils literal notranslate"><span class="pre">/etc/ld.so.cache</span></code>，程序连接的时候首先从这个文件里查找，然后再到<code class="docutils literal notranslate"><span class="pre">ld.so.conf</span></code>的路径中查找。为了让动态链接库为系统所共享，需运行动态链接库的管理命令<code class="docutils literal notranslate"><span class="pre">ldconfig</span></code>，此执行程序存放在/sbin目录下。</p></li>
<li><p>从以上可知，在<code class="docutils literal notranslate"><span class="pre">/lib</span></code>和<code class="docutils literal notranslate"><span class="pre">/usr/lib</span></code>里面添加库文件，是无需将路径添加到<code class="docutils literal notranslate"><span class="pre">/etc/ld.so.conf</span></code>中去的，但是需要使用命令<code class="docutils literal notranslate"><span class="pre">ldconfig</span></code>,否则无法找到库文件。在上述两个目录之外的路径添加库文件，需要先将将库文件的路径追加入文件<code class="docutils literal notranslate"><span class="pre">/etc/ld.so.conf</span></code>。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="cp">
<h2>48. cp<a class="headerlink" href="#cp" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span></code>：将源文件内容复制至目标文件，或将多个源文件复制至目标目录。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">[选项]...</span> <span class="pre">源文件...</span> <span class="pre">目录/文件</span></code></p>
<ul>
<li><p>多个源文件只能复制到目录内</p></li>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">此参数的效果和同时指定</span><span class="s1">&#39;-dpr&#39;</span><span class="n">参数相同</span><span class="err">；</span>
<span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">删除</span><span class="err">，</span><span class="n">覆盖目标文件之前的备份</span><span class="err">，</span><span class="n">备份文件会在字尾加上一个备份字符串</span><span class="err">；</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">当复制符号连接时</span><span class="err">，</span><span class="n">把目标文件或目录也建立为符号连接</span><span class="err">，</span><span class="n">并指向与源文件或目录连接的原始文件或目录</span><span class="err">；</span>
<span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">强行复制文件或目录</span><span class="err">，</span> <span class="n">不论目的文件或目录是否已经存在</span><span class="err">；</span>
<span class="o">-</span><span class="n">i</span><span class="err">：</span><span class="n">覆盖文件之前先询问用户</span><span class="err">；</span>
<span class="o">-</span><span class="n">l</span><span class="err">：</span><span class="n">对源文件建立硬链接</span><span class="err">，</span><span class="n">而非复制文件</span><span class="err">；</span>
<span class="o">-</span><span class="n">p</span><span class="err">：</span><span class="n">小写p</span><span class="p">,</span><span class="n">保留源文件或目录的属性</span><span class="err">，</span><span class="n">包括所有者</span><span class="err">、</span><span class="n">所属组</span><span class="err">、</span><span class="n">权限与时间</span><span class="err">；</span>
<span class="o">-</span><span class="n">P</span><span class="err">：</span><span class="n">大写P</span><span class="p">,</span><span class="n">保留源文件或目录的路径</span><span class="err">，</span><span class="n">此路径可以是绝对路径或相对路径</span><span class="err">，</span><span class="n">且目的目录必须已经存在</span><span class="err">；</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">递归处理</span><span class="err">，</span><span class="n">将指定目录下的文件与子目录一并处理</span><span class="err">。</span><span class="n">若源文件或目录的形态</span><span class="err">，</span><span class="n">不属于目录或符号链接</span><span class="err">，</span><span class="n">则一律视为普通文件处理</span><span class="err">；</span>
<span class="o">-</span><span class="n">R</span><span class="err">：</span><span class="n">递归处理</span><span class="err">，</span><span class="n">将指定目录下的文件及子目录一并处理</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="install">
<h2>49. install<a class="headerlink" href="#install" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">install</span></code>：安装或升级软件或备份数据，它的使用权限是所有用户。install命令和cp命令类似，都可以将文件或目录拷贝到指定的地点。但是，install允许你控制目标文件的属性。install通常用于程序的makefile，使用它来将程序拷贝到目标（安装）目录。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">[选项]...</span> <span class="pre">源文件...</span> <span class="pre">目录/文件</span></code></p>
<ul>
<li><p>多个源文件只能复制到目录内</p></li>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">自行设定权限模式</span> <span class="p">(</span><span class="n">像chmod</span><span class="p">)</span><span class="err">，</span><span class="n">如</span><span class="o">-</span><span class="n">m</span> <span class="mi">777</span><span class="p">;</span>
<span class="o">-</span><span class="n">o</span><span class="err">：</span><span class="n">自行设定所有者</span> <span class="p">(</span><span class="n">只适用于超级用户</span><span class="p">);</span>
<span class="o">-</span><span class="n">g</span><span class="err">：</span><span class="n">自行设定所属组</span><span class="err">，</span><span class="n">而不是进程目前的所属组</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="setcap">
<h2>50. setcap<a class="headerlink" href="#setcap" title="Link to this heading">¶</a></h2>
<ul>
<li><p>从2.1版开始,Linux内核有了能力(capability)的概念,即它打破了UNIX/LINUX操作系统中超级用户/普通用户的概念,由普通用户也可以做只有超级用户可以完成的工作。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Capabilities</span></code>的主要思想在于分割root用户的特权，即将root的特权分割成不同的能力，每种能力代表一定的特权操作。</p>
<ul class="simple">
<li><p>例如：能力<code class="docutils literal notranslate"><span class="pre">CAP_SYS_MODULE</span></code>表示用户能够加载(或卸载)内核模块的特权操作，而<code class="docutils literal notranslate"><span class="pre">CAP_SETUID</span></code>表示用户能够修改进程用户身份的特权操作。在Capbilities中系统将根据进程拥有的能力来进行特权操作的访问控制。</p></li>
</ul>
</li>
<li><p>在Capilities中，只有进程和可执行文件才具有能力。</p>
<ul class="simple">
<li><p>每个进程拥有三组能力集。- 分别称为<code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>, <code class="docutils literal notranslate"><span class="pre">cap_inheritable</span></code>, <code class="docutils literal notranslate"><span class="pre">cap_permitted</span></code>(分别简记为:pE,pI,pP)。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_permitted</span></code>：表示进程所拥有的最大能力集；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>：表示进程当前可用的能力集，可以看做是cap_permitted的一个子集；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_inheitable</span></code>：表示进程可以传递给其子进程的能力集。</p></li>
<li><p>系统根据进程的<code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>能力集进行访问控制，<code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>为<code class="docutils literal notranslate"><span class="pre">cap_permitted</span></code>的子集，进程可以通过取消c<code class="docutils literal notranslate"><span class="pre">ap_effective</span></code>中的某些能力来放弃进程的一些特权。</p></li>
</ul>
</li>
<li><p>可执行文件也拥有三组能力集，对应于进程的三组能力集。分别称为<code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>, <code class="docutils literal notranslate"><span class="pre">cap_allowed</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cap_forced</span></code>（分别简记为fE,fI,fP）。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_allowed</span></code>：表示程序运行时可从原进程的cap_inheritable中集成的能力集；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_forced</span></code>：表示运行文件时必须拥有才能完成其服务的能力集；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cap_effective</span></code>：表示文件开始运行时可以使用的能力。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>各种能力</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CAP_CHOWN</span><span class="p">:</span><span class="n">修改文件属主的权限</span>
<span class="n">CAP_DAC_OVERRIDE</span><span class="p">:</span><span class="n">忽略文件的DAC访问限制</span>
<span class="n">CAP_DAC_READ_SEARCH</span><span class="p">:</span><span class="n">忽略文件读及目录搜索的DAC访问限制</span>
<span class="n">CAP_FOWNER</span><span class="err">：</span><span class="n">忽略文件属主ID必须和进程用户ID相匹配的限制</span>
<span class="n">CAP_FSETID</span><span class="p">:</span><span class="n">允许设置文件的setuid位</span>
<span class="n">CAP_KILL</span><span class="p">:</span><span class="n">允许对不属于自己的进程发送信号</span>
<span class="n">CAP_SETGID</span><span class="p">:</span><span class="n">允许改变进程的组ID</span>
<span class="n">CAP_SETUID</span><span class="p">:</span><span class="n">允许改变进程的用户ID</span>
<span class="n">CAP_SETPCAP</span><span class="p">:</span><span class="n">允许向其他进程转移能力以及删除其他进程的能力</span>
<span class="n">CAP_LINUX_IMMUTABLE</span><span class="p">:</span><span class="n">允许修改文件的IMMUTABLE和APPEND属性标志</span>
<span class="n">CAP_NET_BIND_SERVICE</span><span class="p">:</span><span class="n">允许绑定到小于1024的端口</span>
<span class="n">CAP_NET_BROADCAST</span><span class="p">:</span><span class="n">允许网络广播和多播访问</span>
<span class="n">CAP_NET_ADMIN</span><span class="p">:</span><span class="n">允许执行网络管理任务</span>
<span class="n">CAP_NET_RAW</span><span class="p">:</span><span class="n">允许使用原始套接字</span>
<span class="n">CAP_IPC_LOCK</span><span class="p">:</span><span class="n">允许锁定共享内存片段</span>
<span class="n">CAP_IPC_OWNER</span><span class="p">:</span><span class="n">忽略IPC所有权检查</span>
<span class="n">CAP_SYS_MODULE</span><span class="p">:</span><span class="n">允许插入和删除内核模块</span>
<span class="n">CAP_SYS_RAWIO</span><span class="p">:</span><span class="n">允许直接访问</span><span class="o">/</span><span class="n">devport</span><span class="p">,</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mem</span><span class="p">,</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">kmem及原始块设备</span>
<span class="n">CAP_SYS_CHROOT</span><span class="p">:</span><span class="n">允许使用chroot</span><span class="p">()</span><span class="n">系统调用</span>
<span class="n">CAP_SYS_PTRACE</span><span class="p">:</span><span class="n">允许跟踪任何进程</span>
<span class="n">CAP_SYS_PACCT</span><span class="p">:</span><span class="n">允许执行进程的BSD式审计</span>
<span class="n">CAP_SYS_ADMIN</span><span class="p">:</span><span class="n">允许执行系统管理任务</span><span class="err">，</span><span class="n">如加载或卸载文件系统</span><span class="err">、</span><span class="n">设置磁盘配额等</span>
<span class="n">CAP_SYS_BOOT</span><span class="p">:</span><span class="n">允许重新启动系统</span>
<span class="n">CAP_SYS_NICE</span><span class="p">:</span><span class="n">允许提升优先级及设置其他进程的优先级</span>
<span class="n">CAP_SYS_RESOURCE</span><span class="p">:</span><span class="n">忽略资源限制</span>
<span class="n">CAP_SYS_TIME</span><span class="p">:</span><span class="n">允许改变系统时钟</span>
<span class="n">CAP_SYS_TTY_CONFIG</span><span class="p">:</span><span class="n">允许配置TTY设备</span>
<span class="n">CAP_MKNOD</span><span class="p">:</span><span class="n">允许使用mknod</span><span class="p">()</span><span class="n">系统调用</span>
<span class="n">CAP_LEASE</span><span class="p">:</span><span class="n">允许修改文件锁的FL_LEASE标志</span>
<span class="n">cap_chown</span><span class="o">=</span><span class="n">eip是将chown的能力以cap_effective</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="n">cap_inheritable</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">cap_permitted</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="n">三种位图的方式授权给相关的程序文件</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="md5sum">
<h2>51. md5sum<a class="headerlink" href="#md5sum" title="Link to this heading">¶</a></h2>
<ul>
<li><p>用于计算和校验文件的MD5值.</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">md5sum</span> <span class="pre">[选项]</span> <span class="pre">文件</span></code></p>
<ul>
<li><p>常用选项</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">以二进制模式读取文件</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">以文本模式读入文件内容</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">根据已生成的md5值</span><span class="err">，</span><span class="n">对现存文件进行校验</span>
<span class="o">-</span><span class="n">w</span><span class="err">：</span><span class="n">检查输入的md5信息有没有非法行</span><span class="err">，</span><span class="n">若有则输出相应信息</span>
<span class="err">–</span><span class="n">status</span><span class="err">：</span><span class="n">校验完成后</span><span class="err">，</span><span class="n">不生成错误或正确的提示信息</span><span class="err">，</span><span class="n">可以通过命令的返回值来判断</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id">
<h2>52. id<a class="headerlink" href="#id" title="Link to this heading">¶</a></h2>
<ul>
<li><p>打印指定 USER(用户) 的用户名和组信息，或者当前用户（未提供 USER）。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">[OPTION]...</span> <span class="pre">[USER]</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Z</span><span class="err">：</span><span class="n">只打印进程的安全上下文</span>
<span class="o">-</span><span class="n">g</span><span class="err">：</span><span class="n">只打印有效组ID</span>
<span class="o">-</span><span class="n">G</span><span class="err">：</span><span class="n">打印所有组ID</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">打印一个名称而不是数字</span><span class="err">，</span><span class="n">用于</span> <span class="o">-</span><span class="n">ugG</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">打印真实ID而不是有效ID</span><span class="err">，</span><span class="n">和</span> <span class="o">-</span><span class="n">ugG</span> <span class="n">一起使用</span>
<span class="o">-</span><span class="n">u</span><span class="err">：</span><span class="n">打印当前用户id</span>
<span class="o">-</span><span class="n">z</span><span class="err">：</span><span class="n">用</span> <span class="n">NUL</span> <span class="n">分隔条目</span><span class="err">，</span><span class="n">而不是空格</span><span class="err">。</span><span class="n">在默认格式中不允许使用</span><span class="err">。</span>
</pre></div>
</div>
</li>
<li><p>如果不附带任何选项，程序会显示一些可供识别用户身份的有用信息。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="arp">
<h2>53. arp<a class="headerlink" href="#arp" title="Link to this heading">¶</a></h2>
<section id="id7">
<h3>53.1. arp协议<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>arp协议位于二层（数据链路层）和三层（网络层）之间，<code class="docutils literal notranslate"><span class="pre">Address</span> <span class="pre">Resolution</span> <span class="pre">Protocol</span></code>，是根据IP地址获取物理地址的一个TCP/IP协议；</p></li>
<li><p>IP地址属于网络层，但ip地址在传输的时候需要跨越不同的物理网络进行交换，此时如果一台主机要将一个帧发送到另一台主机，光知道其ip地址是不够的，还需要知道其有效的“硬件地址”；</p></li>
<li><p>ARP（地址解析协议）就提供了一种在32位IPv4地址和以太网的48位MAC地址（硬件地址）之间的映射；</p></li>
<li><p>ARP提供的是网络层地址到相关硬件地址的“动态映射”，即：会自动执行和随时间变化，而不需要系统管理员的配置。（如一台主机改变了它的网卡后（mac地址改变），ARP可以在一定延时后继续正常工作）。</p></li>
</ul>
</section>
<section id="id8">
<h3>53.2. ARP的作用<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>要了解ARP的作用，首先要分清两个“地址”：</p>
<ol class="simple">
<li><p>TCP/IP的32bit IP地址。仅知道主机的IP地址不能让内核发送数据帧给主机；</p></li>
<li><p>网络接口的硬件地址，它是一个48bit的值，用来标识不同的以太网或令牌环网络接口。在硬件层次上，进行数据交换必须有正确的接口地址，内核必须知道目的端的硬件地址才能发送数据。</p></li>
</ol>
</li>
<li><p>简言之，就是在以太网中，一台主机要把数据帧发送到同一局域网上的另一台主机时，设备驱动程序必须知道以太网地址才能发送数据。而我们只知道IP地址，这时就需要采用ARP协议将IP地址映射为以太网地址；</p></li>
<li><p>要注意一点，一般认为ARP协议只使适用于局域网。</p></li>
</ul>
</section>
<section id="tcparp">
<h3>53.3. 建立TCP连接与ARP的关系<a class="headerlink" href="#tcparp" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>应用接受用户提交的数据，触发TCP建立连接，TCP的第一个SYN报文通过connect函数到达IP层，IP层通过查询路由表：</p>
<ul>
<li><p>如果目的IP和自己在同一个网段：</p>
<ul>
<li><p>当IP层的ARP高速缓存表中存在目的IP对应的MAC地址时:</p>
<ul>
<li><p>则调用网络接口send函数（参数为IP Packet和目的MAC））将数据提交给网络接口，网络接口完成Ethernet Header + IP + CRC的封装，并发送出去；</p></li>
</ul>
</li>
<li><p>当IP层的ARP高速缓存表中不存在目的IP对应的MAC地址时:</p>
<ul>
<li><p>则IP层将TCP的SYN缓存下来，发送ARP广播请求目的IP的MAC，收到ARP应答之后，将应答之中的<code class="docutils literal notranslate"><span class="pre">&lt;IP地址，对应的MAC&gt;</span></code>对缓存在本地ARP高速缓存表中，然后完成TCP SYN的IP封装，调用网络接口send函数（参数为IP Packet和目的MAC））将数据提交给网络接口，网络接口完成Ethernet Header + IP + CRC的封装，并发送出去；。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>如果目的IP地址和自己不在同一个网段，就需要将包发送给默认网关，这需要知道默认网关的MAC地址：</p>
<ul>
<li><p>当IP层的ARP高速缓存表中存在默认网关对应的MAC地址时:</p>
<ul>
<li><p>则调用网络接口send函数（参数为IP Packet和默认网关的MAC）将数据提交给网络接口，网络接口完成Ethernet Header + IP + CRC</p></li>
</ul>
</li>
<li><p>当IP层的ARP高速缓存表中不存在默认网关对应的MAC地址时:</p>
<ul>
<li><p>则IP层将TCP的SYN缓存下来，发送ARP广播请求默认网关的MAC，收到ARP应答之后，将应答之中的<code class="docutils literal notranslate"><span class="pre">&lt;默认网关地址，对应的MAC&gt;</span></code>对缓存在本地ARP高速缓存表中，然后完成TCP SYN的IP封装，调用网络接口send函数（参数为IP Packet和默认网关的MAC）将数据提交给网络接口，网络接口完成Ethernet Header + IP + CRC的封装，并发送出去。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id9">
<h3>53.4. 工作流程<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">地址解析协议</span></code>是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。相关协议有RARP、代理ARP。NDP用于在IPv6中代替地址解析协议。</p></li>
<li><p>arp请求和应答具体工作流程如下：</p>
<ul>
<li><p><img alt="Alt text" src="../_images/2023-07-06_110052_234064.png" /></p></li>
</ul>
</li>
<li><p>主机A(172.30.22.24)访问主机B(172.30.22.111)</p>
<ol class="simple">
<li><p>应用程序要求TCP协议建立一条到主机B(172.30.22.111)的连接；</p></li>
<li><p>TCP尝试向远程主机B发送一个连接请求（此时由于假定的是直接交付，所以中途不经过任何路由器）；</p></li>
<li><p>本地主机A查看<code class="docutils literal notranslate"><span class="pre">ARP缓存（或表）</span></code>中是否已经缓存了主机B的<code class="docutils literal notranslate"><span class="pre">ip地址与mac地址之间的映射</span></code>，如果有缓存，直接返回与之对应的MAC地址；如果没有缓存，则进入下面的步骤：
（1） 在一个共享的链路层网段上（ARP协议多用于局域网内的直接交付），ARP向本地网络的<code class="docutils literal notranslate"><span class="pre">所有主机</span></code>发送一个称为<code class="docutils literal notranslate"><span class="pre">ARP请求</span></code>的以太网帧。这种行为被称为“以太网广播”（也叫链路层广播），源主机A的IP地址和MAC地址都包括在ARP请求中；
（2）本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配，如果某主机发现请求的IPv4地址(172.30.22.111)与自己一致，则将<code class="docutils literal notranslate"><span class="pre">主机A的IP地址和MAC地址映射</span></code>添加到本地<code class="docutils literal notranslate"><span class="pre">ARP缓存</span></code>中；IP地址不匹配的主机会主动丢弃掉ARP请求；
（3）找到了<code class="docutils literal notranslate"><span class="pre">使用172.30.22.111作为IPv4地址</span></code>的主机B，那么主机B的ARP协议需要响应一个<code class="docutils literal notranslate"><span class="pre">ARP应答</span></code>。该应答包含该主机的IPv4地址和MAC地址。该应答会直接发送给请求的发送方即主机A；(ARP协议就是用这种方式，知道了主机B(172.30.22.111)地址所对应的MAC地址);
（4）当主机A收到从主机B发来的ARP应答时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了；</p></li>
<li><p>发送方将数据报封装在以太网帧中，使用通过ARP协议获取到的接收方的MAC地址，直接将以太网帧发送给接收方；</p></li>
<li><p>由此该以太网帧仅指向正确的目的主机，其他主机或路由不会接收到这个数据报。</p></li>
</ol>
</li>
</ul>
</section>
<section id="id10">
<h3>53.5. arp缓存<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<ul>
<li><p>ARP高速缓存表在IP层使用。如果每次建立TCP连接都发送ARP请求，会降低效率，因此在主机、交换机、路由器上都会有ARP缓存表。建立TCP连接时先查询ARP缓存表，如果有效，直接读取ARP表项的内容进行第二层数据包的发送；只有表失效时才进行ARP请求和应答进行MAC地址的获取，以建立TCP连接。</p></li>
<li><p>ARP缓存是个用来储存IP地址和MAC地址的缓冲区，其本质就是一个<code class="docutils literal notranslate"><span class="pre">IP地址--&gt;MAC地址的对应表</span></code>；</p></li>
<li><p>表中每一个条目分别记录了网络上其他主机的<code class="docutils literal notranslate"><span class="pre">IP地址和对应的MAC地址</span></code>；</p></li>
<li><p>每一个以太网或令牌环网络适配器都有自己单独的表。当地址解析协议被询问一个<code class="docutils literal notranslate"><span class="pre">已知IP地址节点的MAC地址</span></code>时，先在<code class="docutils literal notranslate"><span class="pre">ARP缓存</span></code>中查看，若存在，就直接返回与之对应的MAC地址，若不存在，才发送ARP请求向局域网查询；</p></li>
<li><p>为使广播量最小，ARP维护IP地址到MAC地址映射的缓存以便将来使用。ARP缓存可以包含<code class="docutils literal notranslate"><span class="pre">动态和静态项目</span></code>；</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">动态项目</span></code>随时间推移自动添加和删除。每个动态ARP缓存项的潜在生命周期是10分钟。新加到缓存中的项目带有时间戳，如果某个项目添加后2分钟内没有再使用，则此项目过期并从ARP缓存中删除；如果某个项目已在使用，则又收到2分钟的生命周期；如果某个项目始终在使用，则会另外收到2分钟的生命周期，一直到10分钟的最长生命周期	- <code class="docutils literal notranslate"><span class="pre">静态项目</span></code>一直保留在缓存中，直到重新启动计算机为止</p></li>
</ul>
</li>
<li><p>每个映射的缓存项目包含5个元素(通过<code class="docutils literal notranslate"><span class="pre">arp</span></code>命令查看)：<code class="docutils literal notranslate"><span class="pre">主机名（对应一个ip地址）</span></code>、<code class="docutils literal notranslate"><span class="pre">硬件地址类型</span></code>、<code class="docutils literal notranslate"><span class="pre">硬件地址</span></code>、<code class="docutils literal notranslate"><span class="pre">标志</span></code>、<code class="docutils literal notranslate"><span class="pre">本地网络接口</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Address</span>                  <span class="n">HWtype</span>  <span class="n">HWaddress</span>           <span class="n">Flags</span> <span class="n">Mask</span>            <span class="n">Iface</span>
<span class="mf">172.30.22.108</span>            <span class="n">ether</span>   <span class="mi">00</span><span class="p">:</span><span class="mi">1</span><span class="n">a</span><span class="p">:</span><span class="mi">4</span><span class="n">a</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">90</span><span class="p">:</span><span class="mi">1</span><span class="n">c</span>   <span class="n">C</span>                     <span class="n">eth1</span>
<span class="mf">172.30.22.254</span>            <span class="n">ether</span>   <span class="mi">7</span><span class="n">c</span><span class="p">:</span><span class="n">d</span> <span class="mi">9</span><span class="p">:</span><span class="n">a</span> <span class="mi">0</span><span class="p">:</span><span class="mi">75</span><span class="p">:</span><span class="mi">69</span><span class="p">:</span><span class="mi">08</span>   <span class="n">C</span>                     <span class="n">eth1</span>
<span class="mf">172.30.22.24</span>             <span class="n">ether</span>   <span class="mi">38</span><span class="p">:</span><span class="n">c</span> <span class="n">a</span><span class="p">:</span><span class="mi">8</span> <span class="mi">4</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">6</span><span class="n">f</span><span class="p">:</span><span class="mi">44</span>   <span class="n">C</span>                     <span class="n">eth1</span>
</pre></div>
</div>
<ul>
<li><p>其中<code class="docutils literal notranslate"><span class="pre">标志</span></code>包含了一个符号：<code class="docutils literal notranslate"><span class="pre">C</span></code>、<code class="docutils literal notranslate"><span class="pre">M</span></code>或<code class="docutils literal notranslate"><span class="pre">P</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="err">：</span><span class="n">是动态ARP表项</span><span class="err">，</span><span class="n">通过分组报文学习而来</span>
<span class="n">M</span><span class="err">：</span><span class="n">是静态ARP表项</span><span class="err">，</span><span class="n">通过手动设置</span>
<span class="n">P</span><span class="err">：</span><span class="n">是免费ARP表项</span><span class="err">，</span><span class="n">对外主动应答</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id11">
<h3>53.6. arp帧格式<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<ul>
<li><p><img alt="Alt text" src="../_images/2023-07-06_131300_723897.png" /></p>
<ul>
<li><p>前14个字节（MAC头部）是一个标准的以太网帧头部；</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DST</span><span class="err">：</span><span class="n">表示目的MAC地址</span>
<span class="n">SRC</span><span class="err">：</span><span class="n">表示源MAC地址</span>
<span class="n">长度或类型</span><span class="err">：</span><span class="n">用于确定头部后面的数据类型</span><span class="err">，</span><span class="n">常见的值包括</span><span class="err">：</span><span class="mh">0x0800</span><span class="err">（</span><span class="n">IPv4</span><span class="err">）、</span><span class="mh">0x86DD</span><span class="err">（</span><span class="n">IPv6</span><span class="err">）、</span><span class="mh">0x0806</span><span class="err">（</span><span class="n">ARP</span><span class="err">）</span>
</pre></div>
</div>
</li>
<li><p>前14个字节之后，由ARP协议来定义，ARP帧的前8个字节时通用；</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">硬件类型字段</span><span class="err">：</span><span class="n">指出硬件地址类型</span><span class="err">，</span><span class="n">对于以太网</span><span class="err">，</span><span class="n">该值为1</span><span class="o">.</span>
<span class="n">协议类型字段</span><span class="err">：</span><span class="n">指出映射的协议地址类型</span><span class="err">，</span><span class="n">对于IPv4地址</span><span class="err">，</span><span class="n">该值为0x0800</span><span class="err">。（</span><span class="n">当以太网帧包含</span><span class="err">“</span><span class="n">IPv4数据报</span><span class="err">”</span><span class="n">时</span><span class="err">，</span><span class="n">长度或类型字段与协议字段可能一样</span><span class="err">，</span><span class="n">即都是0x0800</span><span class="err">）</span>
<span class="n">硬件大小</span><span class="err">：</span><span class="n">指出硬件地址的字节数</span><span class="err">（</span><span class="n">对于以太网中使用IPv4地址的ARP应答</span><span class="err">，</span><span class="n">其值为6</span><span class="err">）</span>
<span class="n">协议大小</span><span class="err">：</span><span class="n">协议地址的字节数</span><span class="err">。（</span><span class="n">对于以太网中使用IPv4地址的ARP应答</span><span class="err">，</span><span class="n">其值为4</span><span class="err">）</span>
<span class="n">Op字段</span><span class="err">：</span><span class="n">指出该操作是</span><span class="err">：</span><span class="n">ARP请求</span><span class="err">（</span><span class="n">值为1</span><span class="err">）、</span><span class="n">ARP应答</span><span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="n">RARP请求</span><span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="n">RARP应答</span><span class="err">（</span><span class="mi">4</span><span class="err">）</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id12">
<h3>53.7. 免费arp<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>免费 ARP（Gratuitous ARP）包是一种特殊的ARP请求，一台主机发送ARP请求以获取自己的地址。</p></li>
<li><p>免费ARP报文与普通ARP请求报文的区别在于报文中的目标IP地址。普通ARP报文中的目标IP地址是其他主机的IP地址；而免费ARP的请求报文中，目标IP地址是自己的IP地址。</p></li>
<li><p>有四个作用：</p>
<ol class="simple">
<li><p>确定是否有其他主机配置了相同的IPv4地址；</p>
<ul>
<li><p>正常情况下发送免费ARP请求不会收到ARP应答，如果收到了一个ARP应答，则说明网络中存在与本机相同的IP地址的主机，发生了地址冲突</p></li>
</ul>
</li>
<li><p>更新其他主机上的ARP缓存。</p>
<ul>
<li><p>如果发送免费ARP的主机正好改变了硬件地址，如更换了接口卡。其他主机接收到这个ARP请求的时候，发现自己的ARP高速缓存表中存在对应的IP地址，但是MAC地址不匹配，那么就需要利用接收的ARP请求来更新本地的ARP高速缓存表表</p></li>
</ul>
</li>
<li><p>网关利用免费ARP防止ARP攻击</p>
<ul>
<li><p>有些网关设备在一定的时间间隔内向网络主动发送免费ARP报文，让网络内的其他主机更新ARP表项中的网关MAC地址信息，以达到防止或缓解ARP攻击的效果。</p></li>
</ul>
</li>
<li><p>利用免费ARP进行ARP攻击</p>
<ul>
<li><p>ARP协议并不只在发送了ARP请求才接收ARP应答，计算机只要接收到ARP应答数据包，就会使用应答中的IP和MAC地址对本地的ARP缓存进行更新。</p></li>
<li><p>主机可以构造虚假的免费ARP应答，将ARP的源MAC地址设为错误的MAC地址，并把这个虚假的免费ARP应答发送到网络中，那么所有接收到这个免费ARP应答的主机都会更新本地ARP表项中相应IP地址对应的MAC地址。更新成功后，这些主机的数据报文就会被转发到错误的MAC地址，从而实现了ARP欺骗的攻击。</p></li>
</ul>
</li>
</ol>
</li>
<li><p>在RFC中描述了一种 IPv4地址冲突检测(ACD) 机制，可用来检测IPv4地址冲突情况。</p>
<ul>
<li><p>ACD定义了两种ARP分组：</p>
<ul>
<li><p>ARP探测分组：是一个ARP请求，其中发送方协议地址被设置为0，目的协议地址为候选IPv4地址。</p></li>
<li><p>ARP通告分组：发送方协议地址和目的地址都为候选IPv4地址。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id13">
<h3>53.8. 代理arp<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>代理ARP就是通过使用一个主机(通常为router)，来作为指定的设备使用自己的 MAC 地址来对另一设备的ARP请求作出应答。</p></li>
<li><p>为什么需要代理ARP？</p>
<ul>
<li><p>先要了解，路由器的重要功能之一就是把局域网的广播包限制在该网内，阻止其扩散，否则会造成网络风暴；</p></li>
<li><p>ARP请求是个广播包，它询问的对象如果在同一个局域网内，就会收到应答。但是如果询问的对象不在同一个局域网该如何处理？路由器就提供的代理ARP为这个问题提供了解决方案。</p></li>
</ul>
</li>
<li><p>工作流程</p>
<ul>
<li><p>当局域网内部主机发起跨网段的ARP请求时，出口路由器/网关设备将自身MAC地址回复该请求时，这个过程称为代理ARP，也被称为混杂ARP（Promiscuous ARP）。</p>
<ul>
<li><p><img alt="Alt text" src="../_images/2023-07-06_134857_821437.png" /></p></li>
<li><p>如上图所示：PC1和PC2位于两个网段，PC1发送ARP请求PC2的硬件地址，此时Router回复该ARP请求，并且将MAC地址填为自身地址，然后将PC1发给PC2的数据包再转发给PC2；</p></li>
<li><p>PC1和PC2看起来互相隐身，可以屏蔽复杂网络拓扑。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>代理ARP的优缺点</p>
<ul>
<li><p>优点：代理ARP能在不影响路由表的情况下添加一个新的Router，使子网对该主机变得透明化。一般代理ARP应该使用在主机没有配置默认网关或没有任何路由策略的网络上。</p></li>
<li><p>缺点：从工作工程可以看到，这其实是一种ARP欺骗。而且，通过两个物理网络之间的路由器的代理ARP功能其实互相隐藏了物理网络，这导致无法对网络拓扑进行网络概括。此外，代理ARP增加了使用它的那段网络的ARP流量，主机需要更大的ARP缓存空间，也不会为不使用ARP进行地址解析的网络工作。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id14">
<h3>53.9. arp命令<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">arp</span></code>（Address Resolution Protocol）操作主机的 ARP 缓存，可以显示 arp 缓冲区中的所有条目、删除指定的条目或者添加静态的 IP 地址与 MAC 地址对应关系。
常用命令：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arp</span> <span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">使用BSD风格查看</span><span class="err">。</span>
<span class="n">arp</span> <span class="o">-</span><span class="n">e</span><span class="err">：</span><span class="n">默认的Linux风格查看</span><span class="err">。</span>
<span class="n">arp</span> <span class="o">-</span><span class="n">ev</span><span class="err">：</span><span class="n">输出更多的信息</span><span class="err">。</span>
<span class="n">arp</span> <span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">表示不解析IP地址为域名</span><span class="err">，</span><span class="n">直接输出数字形式的地址</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">arp-scan</span></code>：该工具可以进行单一目标扫描，也可以进行批量扫描。批量扫描的时候，用户可以通过CIDR地址范围或者列表文件的方式指定。该工具允许用户定制ARP包，构建非标准数据包。同时，该工具会自动解析Mac地址，给出MAC对应的硬件厂商，帮助用户确认目标。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arp-scan</span> <span class="pre">-l:查看本地网段下的所有主机</span></code></p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
</section>
<hr class="docutils" />
<section id="faillog">
<h2>54. faillog<a class="headerlink" href="#faillog" title="Link to this heading">¶</a></h2>
<ul>
<li><p>语法：faillog [参数]</p>
<ul>
<li><p>常用参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">--</span><span class="nb">all</span><span class="err">：</span><span class="n">显示所有用户的登录失败记录</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span><span class="err">：</span><span class="n">显示本帮助信息并退出</span>
<span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">--</span><span class="n">lock</span><span class="o">-</span><span class="n">time</span> <span class="n">秒数</span><span class="err">：</span><span class="n">在登录失败后锁定帐户</span><span class="err">“</span><span class="n">秒数</span><span class="err">”</span><span class="n">秒</span>
<span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">--</span><span class="n">maximum</span> <span class="n">最大值</span><span class="err">：</span><span class="n">将最大登录失败次数设为</span><span class="err">“</span><span class="n">最大值</span><span class="err">”</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">reset</span><span class="err">：</span><span class="n">将登录失败计数器归零</span>
<span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">time</span> <span class="n">天数</span><span class="err">：</span><span class="n">显示最近</span><span class="err">“</span><span class="n">天数</span><span class="err">”</span><span class="n">天以来的登录失败记录</span>
<span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">user</span> <span class="n">登录</span><span class="err">：</span><span class="n">仅显示用户</span><span class="err">“</span><span class="n">登录</span><span class="err">”</span><span class="n">的登录失败记录</span><span class="err">，</span><span class="n">或设置用户</span><span class="err">“</span><span class="n">登录</span><span class="err">”</span><span class="n">的登录失败计数器及限制</span><span class="p">(</span><span class="n">如果和</span> <span class="o">-</span><span class="n">r</span><span class="err">、</span><span class="o">-</span><span class="n">m</span> <span class="n">或</span> <span class="o">-</span><span class="n">l</span> <span class="n">选项合用</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="id15">
<h2>55. 用户相关<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<ul>
<li><p>创建用户：<code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">[选项]</span> <span class="pre">用户名</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">建立用户时强制建立用户的家目录</span><span class="err">。</span><span class="n">在建立系统用户时</span><span class="err">，</span><span class="n">该选项是默认的</span><span class="err">。</span>
<span class="o">-</span><span class="n">s</span> <span class="n">shell</span><span class="err">：</span><span class="n">指定用户的登录</span> <span class="n">Shell</span><span class="err">，</span><span class="n">默认是</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span><span class="err">。</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">创建系统用户</span><span class="err">，</span><span class="n">也就是UID在1</span><span class="o">-</span><span class="mi">499</span><span class="err">。</span>
<span class="o">-</span><span class="n">d</span> <span class="n">home_dir</span><span class="err">：</span><span class="n">设定使用者的家目录为</span> <span class="n">home_dir</span> <span class="err">，</span><span class="n">预设值为预设的</span> <span class="n">home</span> <span class="n">后面加上使用者帐号</span> <span class="n">loginid</span>
<span class="o">-</span><span class="n">e</span> <span class="n">expire_date</span><span class="err">：</span><span class="n">设定此帐号的使用期限</span><span class="err">（</span><span class="n">格式为</span> <span class="n">YYYY</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">DD</span><span class="err">），</span><span class="n">预设值为永久有效</span>
<span class="o">-</span><span class="n">c</span> <span class="n">comment</span><span class="err">：</span><span class="n">新使用者位于密码档</span><span class="err">（</span><span class="n">通常是</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="err">）</span><span class="n">的注解资料</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>修改用户：<code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">[选项]</span> <span class="pre">用户名</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">comment</span> <span class="n">COMMENT</span><span class="err">：</span><span class="n">修改用户帐号的备注文字</span>
<span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="n">home</span> <span class="n">HOME_DIR</span><span class="err">：</span><span class="n">单独使用时</span><span class="err">，</span><span class="n">只是把保存在</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd这个配置文件当中的源目录名改成指定的新目录名</span>
<span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">与</span><span class="o">-</span><span class="n">d一起使用时会将原有的家目录移动要指定目录并根据需要改名</span>
<span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">expiredate</span> <span class="n">EXPIRE_DATE</span><span class="err">：</span><span class="n">修改帐号的有效期限</span><span class="err">，</span><span class="o">-</span><span class="n">e后设置的是有效期日期或者从1970年1月1日开始计算的天数</span><span class="err">。</span>
<span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">inactive</span> <span class="n">INACTIVE</span><span class="err">：</span><span class="n">修改在密码过期后多少天即关闭该帐号</span>
<span class="o">-</span><span class="n">g</span><span class="p">,</span> <span class="o">--</span><span class="n">gid</span> <span class="n">GROUP</span><span class="err">：</span><span class="n">修改用户所属的群组</span>
<span class="o">-</span><span class="n">G</span><span class="p">,</span> <span class="o">--</span><span class="n">groups</span> <span class="n">GROUPS</span><span class="err">：</span><span class="n">修改用户所属的附加群组</span>
<span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">--</span><span class="n">append</span><span class="err">：</span><span class="n">将用户附加到</span><span class="o">-</span><span class="n">G选项提到的补充组中</span><span class="err">，</span><span class="n">而不将其从其他组中移除</span>
<span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">--</span><span class="n">login</span> <span class="n">NEW_LOGIN</span><span class="err">：</span><span class="n">修改用户帐号名称</span>
<span class="o">-</span><span class="n">L</span><span class="p">,</span> <span class="o">--</span><span class="n">lock</span><span class="err">：</span><span class="n">锁定账户</span><span class="err">，</span><span class="n">锁定后root账户可以切换到该用户</span><span class="err">，</span><span class="n">但是直接登录会验证失败</span><span class="err">。</span>
<span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">--</span><span class="n">move</span><span class="o">-</span><span class="n">home</span><span class="err">：</span><span class="n">将主目录的内容移动到新位置</span><span class="err">（</span><span class="n">仅与</span><span class="o">-</span><span class="n">d一起使用</span><span class="err">）</span>
<span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">non</span><span class="o">-</span><span class="n">unique</span><span class="err">：</span><span class="n">允许使用重复</span><span class="err">（</span><span class="n">非唯一</span><span class="err">）</span><span class="n">UID</span>
<span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span><span class="err">：</span><span class="n">修改用户密码</span><span class="err">，</span><span class="n">后面跟的是密文</span><span class="err">，</span><span class="n">可通过python中crypt模块加密</span><span class="err">：</span><span class="nb">print</span><span class="p">(</span><span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="s1">&#39;passwd&#39;</span><span class="p">,</span><span class="n">salt</span><span class="p">)),</span><span class="n">接受两个参数</span><span class="err">，</span><span class="n">一个为需要加密的字符串</span><span class="err">，</span><span class="n">第二个为盐值</span><span class="err">（</span><span class="n">就是加密干扰值</span><span class="err">，</span><span class="n">如果没有提供</span><span class="err">，</span><span class="n">则默认由PHP自动生成</span><span class="err">）；</span><span class="n">返回散列后的字符串或一个少于</span> <span class="mi">13</span> <span class="n">字符的字符串</span><span class="err">，</span><span class="n">后者为了区别盐值</span><span class="err">。</span>
<span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">root</span> <span class="n">CHROOT_DIR</span><span class="err">：</span><span class="n">修改导入目录</span>
<span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">shell</span> <span class="n">SHELL</span><span class="err">：</span><span class="n">修改用户登入后所使用的shell</span>
<span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">uid</span> <span class="n">UID</span><span class="err">：</span><span class="n">修改用户ID</span>
<span class="o">-</span><span class="n">U</span><span class="p">,</span> <span class="o">--</span><span class="n">unlock</span><span class="err">：</span><span class="n">解除密码锁定</span>
<span class="o">-</span><span class="n">Z</span><span class="p">,</span> <span class="o">--</span><span class="n">selinux</span><span class="o">-</span><span class="n">user</span> <span class="n">SEUSER</span><span class="err">：</span><span class="n">用户帐户设置新SELinux用户映射</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>删除用户：<code class="docutils literal notranslate"><span class="pre">userdel</span> <span class="pre">[选项]</span> <span class="pre">用户名</span></code></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">强制删除用户</span><span class="err">，</span><span class="n">即使用户当前已登录</span><span class="err">；</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">删除用户主目录及其中的任何文件</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="sshsftp">
<h2>56. ssh和sftp服务分离<a class="headerlink" href="#sshsftp" title="Link to this heading">¶</a></h2>
<ul>
<li><p>默认linux的ssh和sftp端口都是22，有时候为了安全考虑，我们只想给某些用户sftp传输文件，不想他们拥有ssh的权限，这时需要将ssh和sftp的端口分离</p></li>
<li><p>配置文件分离：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/etc/ssh/sshd_config</span> <span class="pre">/etc/ssh/sftpd_config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vim</span> <span class="pre">/etc/ssh/sftpd_config</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在 #Port 22 的下面增加</span>
	<span class="c1"># 设置sftp端口</span>
	<span class="n">Port</span> <span class="mi">20022</span>
<span class="c1"># 在 #PidFile /var/run/sshd.pid 的下面增加</span>
	<span class="c1"># 设置sftp进程文件</span>
	<span class="n">PidFile</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">sftpd</span><span class="o">.</span><span class="n">pid</span>
<span class="c1"># 注释 Subsystem sftp /usr/libexec/openssh/sftp-server，并在其下方增加</span>
	<span class="c1"># 指定使用sftp服务使用系统自带的internal-sftp</span>
	<span class="n">Subsystem</span> <span class="n">sftp</span> <span class="n">internal</span><span class="o">-</span><span class="n">sftp</span>
	<span class="c1"># 匹配sftp的用户组</span>
	<span class="n">Match</span> <span class="n">Group</span> <span class="n">sftpusers</span>
	<span class="c1"># 禁止用户使用端口转发</span>
	<span class="n">X11Forwarding</span> <span class="n">no</span>
	<span class="c1"># 禁止用户使用端口转发</span>
	<span class="n">AllowTcpForwarding</span> <span class="n">no</span>
	<span class="c1"># 只能用于sftp登录</span>
	<span class="n">ForceCommand</span> <span class="n">internal</span><span class="o">-</span><span class="n">sftp</span>
	<span class="c1"># 限制用户的根目录</span>
	<span class="n">ChrootDirectory</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sftp</span>
</pre></div>
</div>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</li>
<li><p>服务分离：</p>
<ul>
<li><p>复制配置文件</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/lib/systemd/system/ssh.service</span> <span class="pre">/lib/systemd/system/sftpd.service</span></code>：复制单元配置文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/etc/pam.d/sshd</span> <span class="pre">/etc/pam.d/sftpd</span></code>：复制pam配置文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/etc/default/ssh</span>&#160; <span class="pre">/etc/default/sftp</span></code></p></li>
</ul>
</li>
<li><p>修改配置文件</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vim</span> <span class="pre">/lib/systemd/system/sftpd.service</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 修改描述项Description</span>
	<span class="n">Description</span><span class="o">=</span><span class="n">sftpd</span> <span class="n">server</span> <span class="n">daemon</span>
<span class="c1"># 修改服务环境参数文件</span>
	<span class="n">EnvironmentFile</span><span class="o">=-/</span><span class="n">etc</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">sftp</span>
<span class="c1"># 修改启动命令</span>
	<span class="c1"># sftp服务绑定sftp、配置文件</span>
	<span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sftpd</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sftpd_config</span>
<span class="c1"># 修改服务别名</span>
	<span class="n">Alias</span><span class="o">=</span><span class="n">sftpd</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>创建链接文件</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-sf</span>&#160; <span class="pre">/usr/sbin/sshd</span>&#160; <span class="pre">/usr/sbin/sftpd</span></code></p></li>
</ul>
</li>
<li><p>生成sftp进程号文件</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">/var/run/sftpd.pid</span></code></p></li>
</ul>
</li>
<li><p>取消22端口的sftp功能</p>
<ul>
<li><p>注释<code class="docutils literal notranslate"><span class="pre">/etc/ssh/sshd_config</span></code>文件中的如下内容</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subsystem     sftp    /usr/libexec/openssh/sftp-server</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>创建只能sftp登陆的用户</p>
<ul class="simple">
<li><p>新建组：<code class="docutils literal notranslate"><span class="pre">grooupadd</span> <span class="pre">sftpusers</span></code></p></li>
<li><p>新建目录：<code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">/home/sftp/</span></code></p></li>
<li><p>修改目录所属用户和组：<code class="docutils literal notranslate"><span class="pre">chown</span> <span class="pre">root：root</span> <span class="pre">/home/sftp</span></code></p></li>
<li><p>新建测试用户</p>
<ul>
<li><p>useradd -g sftpusers -m -d /home/sftp/test1 test1</p></li>
<li><p>passwd test1</p></li>
<li><p>useradd -g sftpusers -m -d /home/sftp/test2 test2</p></li>
<li><p>passwd test2</p></li>
</ul>
</li>
</ul>
</li>
<li><p>启动服务：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code>:重载配置文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">sftp</span></code>：启动sftp服务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">sftp</span></code>：开机自启动</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="xdotool">
<h2>57. xdotool<a class="headerlink" href="#xdotool" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>xdotool是一款可以模拟鼠标和按键操作的强大工具,可以作为自动化工具.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span> <span class="pre">xdotool</span></code>：安装xdotool</p></li>
<li><p>按键事件模拟</p>
<ul>
<li><p>单个按键输入：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">key</span> <span class="pre">a</span></code>：模拟按键并抬起</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">keydown</span> <span class="pre">a</span> <span class="pre">keyup</span> <span class="pre">a</span></code>：按键按下，抬起。与上条命令等价</p></li>
</ul>
</li>
<li><p>多个按键组合输入，可以组合2/3个组合按键：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xsotool</span> <span class="pre">key</span> <span class="pre">alt+F11</span></code>：模拟组合按键alt+F11</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">key</span> <span class="pre">ctrl+shift+t</span></code>：模拟组合按键ctrl+shift+t</p></li>
</ul>
</li>
</ul>
</li>
<li><p>模拟鼠标</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">getmouselocation</span></code>：获取当前鼠标坐标
x:1326 y:293 screen:0 window：48234502</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">mousemove</span> <span class="pre">1326</span> <span class="pre">293</span></code>：鼠标移动到指定位置</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">click</span> <span class="pre">1/2/3/4/5</span></code>：点击鼠标左键/中键/右键/滚轮向上滚动/滚轮向下滚动</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">click</span> <span class="pre">1</span> <span class="pre">click</span> <span class="pre">1</span></code>：双击左键</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">mousemove_relative</span> <span class="pre">100</span> <span class="pre">100</span></code>：将鼠标相对当前位置分别移动x=100,y=100</p></li>
</ul>
</li>
<li><p>文本输入</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">type</span> <span class="pre">'test'</span></code>：对获取焦点的窗口，输入文本 test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">type</span> <span class="pre">--delay</span> <span class="pre">50</span> <span class="pre">&quot;hello</span> <span class="pre">world&quot;</span></code>：对获取焦点的窗口 每隔500ms自动输入一个字符，输入文本 Hello world</p></li>
</ul>
</li>
<li><p>window相关操作</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">getactivewindow</span></code>：获取当前窗口ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">getdisplaygeometry</span></code>：获得显示器长宽</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">getwindowgeometry</span> <span class="pre">[窗口ID]</span></code>：通过[窗口ID]获得window的起点和窗口长宽</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">selectwindow</span></code>：选中窗口，通过该命令 会出现一个图标，选中哪个窗口，就能输出哪个窗口的[窗口ID]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdotool</span> <span class="pre">windowfocus</span> <span class="pre">[窗口ID]</span></code>：使得窗口ID为39845898的窗口，获得焦点</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="free">
<h2>58. free<a class="headerlink" href="#free" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span></code>命令中的信息都来自于<code class="docutils literal notranslate"><span class="pre">/proc/meminfo</span></code>文件。<code class="docutils literal notranslate"><span class="pre">/proc/meminfo</span></code>文件包含了更多更原始的信息，只是看起来不太直观</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span> <span class="pre">-h</span></code>:以友好的方式显示内存的使用情况</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">total</span>        <span class="n">used</span>        <span class="n">free</span>      <span class="n">shared</span>  <span class="n">buff</span><span class="o">/</span><span class="n">cache</span>   <span class="n">available</span>
<span class="n">Mem</span><span class="p">:</span>        <span class="mi">8148480</span>      <span class="mi">319136</span>     <span class="mi">7349392</span>       <span class="mi">15872</span>      <span class="mi">479952</span>     <span class="mi">7549824</span>
<span class="n">Swap</span><span class="p">:</span>       <span class="mi">8385532</span>           <span class="mi">0</span>     <span class="mi">8385532</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span> <span class="pre">-s</span> <span class="pre">n</span></code>：n秒打印一次内存使用情况
| 字段 | 解释 |
| — | — |
| total | 总计物理（swap）内存的大小 |
| used | 已使用物理内存（swap）的大小 |
| free | 可用的物理内存（swap）大小 |
| shared | 多个进程共享的内存总额 |
| buff/cache | 磁盘的缓存大小 |
| available | 可以被新应用程序使用的内存大小 |</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="tee">
<h2>59. tee<a class="headerlink" href="#tee" title="Link to this heading">¶</a></h2>
<ul>
<li><p>tee命令读取标准输入并将其写入标准输出和一个或多个文件，从而有效地复制其输入。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">tee</span> <span class="pre">[options]</span> <span class="pre">[file]</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-a</span></code>：追加到指定文件而非覆盖</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span></code>：忽略中断</p></li>
<li><p>文件可以是一个或多个</p></li>
</ul>
</li>
<li><p>重定向到<code class="docutils literal notranslate"><span class="pre">/dev/null</span></code>隐藏tee命令输出</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lsblk</span> <span class="pre">|</span> <span class="pre">tee</span> <span class="pre">file.txt</span> <span class="pre">&gt;</span> <span class="pre">/dev/null</span></code></p></li>
</ul>
</li>
<li><p>忽略任何中断</p>
<ul>
<li><p>有时我们想执行一个文本文件或任何其他格式的文件，但会发生一些中断并且进程停止。 为了忽略这些中断并希望tee顺利退出，使用<code class="docutils literal notranslate"><span class="pre">tee</span> <span class="pre">-i</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ping</span> <span class="pre">172.30.22.24</span> <span class="pre">|</span> <span class="pre">tee</span> <span class="pre">-i</span> <span class="pre">file.txt</span></code></p>
<ul>
<li><p>运行过程中ctrl+c打断，仍然顺利执行</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 不加-i打断</span>
<span class="c1"># ping 172.30.22.24 | tee file.txt</span>
<span class="c1"># cat file.txt </span>
<span class="n">PING</span> <span class="mf">172.30.22.24</span> <span class="p">(</span><span class="mf">172.30.22.24</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">172.30.22.24</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.546</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">172.30.22.24</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.564</span> <span class="n">ms</span>

<span class="c1"># 加-i打断</span>
<span class="c1"># ping 172.30.22.24 | tee -i file.txt</span>
<span class="c1"># cat file.txt</span>
<span class="n">PING</span> <span class="mf">172.30.22.24</span> <span class="p">(</span><span class="mf">172.30.22.24</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">172.30.22.24</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.349</span> <span class="n">ms</span>

<span class="o">---</span> <span class="mf">172.30.22.24</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">1</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mf">0.349</span><span class="o">/</span><span class="mf">0.349</span><span class="o">/</span><span class="mf">0.349</span><span class="o">/</span><span class="mf">0.000</span> 
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="lsof">
<h2>60. lsof<a class="headerlink" href="#lsof" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lsof</span></code>：List Open Files，列出系统中已经打开的文件，包括普通文件，目录，块特殊文件，字符特殊文件，正在执行的文本引用，库，流或网络文件（例如：网络套接字，NFS文件或UNIX域套接字）。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">lsof</span> <span class="pre">[options]</span></code></p>
<ul>
<li><p>常用options</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span> <span class="n">cmd</span><span class="err">：</span><span class="n">输出</span> <span class="n">COMMAND</span> <span class="n">列包含</span> <span class="n">cmd</span> <span class="n">的项</span>
<span class="o">-</span><span class="n">p</span> <span class="n">pid</span><span class="err">：</span><span class="n">输出进程号为pid的进程打开的文件</span>
<span class="o">-</span><span class="n">u</span> <span class="n">user</span><span class="err">：</span><span class="n">输出user用户打开的文件</span>
<span class="o">-</span><span class="n">d</span> <span class="n">n</span><span class="err">：</span><span class="n">输出打开文件描述符n的所有项</span>
<span class="n">file</span><span class="err">：</span><span class="n">查看打开文件file的进程项</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ulimit">
<h2>61. ulimit<a class="headerlink" href="#ulimit" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ulimit</span></code>：用来限制每个用户可使用的资源，如CPU、内存、句柄等。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-a</span></code>：列出所有资源限制</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">当某些程序发生错误时</span><span class="err">，</span><span class="n">系统可能会将该程序在内存中的信息写成文件</span><span class="p">(</span><span class="n">出错用</span><span class="p">)</span><span class="err">，</span><span class="n">这种文件就被称为核心文件</span><span class="p">(</span><span class="n">core</span> <span class="n">file</span><span class="p">)</span><span class="err">。</span><span class="n">此为限制每个核心文件的最大容量</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">每个进程数据段的最大值</span>
<span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">当前shell可创建的最大文件容量</span>
<span class="o">-</span><span class="n">l</span><span class="err">：</span><span class="n">可以锁定的物理内存的最大值</span>
<span class="o">-</span><span class="n">m</span><span class="err">：</span><span class="n">可以使用的常驻内存的最大值</span>
<span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">每个进程可以同时打开的最大文件句柄数</span>
<span class="o">-</span><span class="n">p</span><span class="err">：</span><span class="n">管道的最大值</span>
<span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">堆栈的最大值</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">每个进程可以使用CPU的最大时间</span>
<span class="o">-</span><span class="n">u</span><span class="err">：</span><span class="n">每个用户运行的最大进程并发数</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">当前shell可使用的最大虚拟内存</span>
</pre></div>
</div>
</li>
<li><p>临时修改资源限制</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">[-SHcdefilmnpqrstuvx]</span> <span class="pre">[limit]</span></code>：查看的命令后面加上限制值，就可以调整某一项限制，但只对当前登录shell有效</p>
<ul>
<li><p>参数<code class="docutils literal notranslate"><span class="pre">S</span></code>表示设置软限制；参数<code class="docutils literal notranslate"><span class="pre">H</span></code>表示设置硬限制；当都不指定时，表示设置软限制和硬限制均为指定值</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="tar">
<h2>62. tar<a class="headerlink" href="#tar" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span></code>：tar是一个用于在Unix和类Unix系统上创建、查看、提取和压缩归档文件的命令行工具。它通常用于将多个文件和目录组合成单个归档文件，以便于传输、备份或分发。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">[选项]</span> <span class="pre">[归档文件名]</span> <span class="pre">[需要打包的文件/目录</span> <span class="pre">...]</span></code></p>
<ul>
<li><p>归档文件名以<code class="docutils literal notranslate"><span class="pre">.tar</span></code>结尾,用gzip压缩则用<code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code>结尾,便于识别</p></li>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以下5个命令是独立的，压缩解压都要用到其中一个，可以和别的命令连用但只能用其中一个。</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">表示产生新的包</span><span class="err">，</span><span class="n">将文件</span><span class="o">/</span><span class="n">目录打包到新的包中</span>
<span class="o">-</span><span class="n">r</span><span class="err">：</span><span class="n">表示增加文件的意思</span><span class="err">，</span><span class="n">将文件</span><span class="o">/</span><span class="n">目录增加到已有的包中</span><span class="err">，</span><span class="n">也可以产生新的包</span>
<span class="o">-</span><span class="n">u</span><span class="err">：</span><span class="n">表示更新文件</span><span class="err">，</span><span class="n">更新原来包中的某文件</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">列出包中的文件</span><span class="err">，</span><span class="n">列出包中的所有文件</span>
<span class="o">-</span><span class="n">x</span><span class="err">：</span><span class="n">解开包的意思</span>
<span class="c1"># 与以上参数一起使用</span>
<span class="o">-</span><span class="n">f</span><span class="p">:</span> <span class="n">使用档案名字</span><span class="p">,</span><span class="n">切记</span><span class="err">，</span><span class="n">这个参数是最后一个参数</span><span class="p">,</span><span class="n">后面只能接档案名</span><span class="err">。</span>  <span class="n">这个参数是必须要存在的</span><span class="err">。</span>
<span class="o">-</span><span class="n">z</span><span class="err">：</span><span class="n">有gzip属性的</span><span class="p">,</span><span class="n">打包</span><span class="o">/</span><span class="n">解包的同时压缩</span><span class="o">/</span><span class="n">解压文件</span>
<span class="o">-</span><span class="n">j</span><span class="err">：</span><span class="n">有bz2属性的</span><span class="p">,</span><span class="n">打包</span><span class="o">/</span><span class="n">解包的同时压缩</span><span class="o">/</span><span class="n">解压文件</span>
<span class="o">-</span><span class="n">Z</span><span class="err">：</span><span class="n">有compress属性的</span><span class="p">,</span><span class="n">打包</span><span class="o">/</span><span class="n">解包的同时压缩</span><span class="o">/</span><span class="n">解压文件</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">显示所有过程</span>
<span class="o">-</span><span class="n">O</span><span class="err">：</span><span class="n">将文件解开到标准输出</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.zip</span></code>文件和<code class="docutils literal notranslate"><span class="pre">.rar</span></code>文件的解压和压缩</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.zip</span></code>文件</p>
<ul>
<li><p>下载zip：<code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span> <span class="pre">zip</span></code></p></li>
<li><p>压缩：<code class="docutils literal notranslate"><span class="pre">zip</span> <span class="pre">all.zip</span> <span class="pre">*.jpg</span></code></p></li>
<li><p>解压：<code class="docutils literal notranslate"><span class="pre">unzip</span> <span class="pre">all.zip</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.rar</span></code>文件</p>
<ul>
<li><p>下载rar：<code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span> <span class="pre">rar</span></code></p></li>
<li><p>压缩：<code class="docutils literal notranslate"><span class="pre">rar</span> <span class="pre">a</span> <span class="pre">all</span> <span class="pre">*.jpg</span></code></p>
<ul>
<li><p>将所有的.jpg文件压缩到all.rar中，该程序会自动将.rar后缀补充道all后面</p></li>
</ul>
</li>
<li><p>解压：<code class="docutils literal notranslate"><span class="pre">rar</span> <span class="pre">e</span> <span class="pre">all.rar</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="echo">
<h2>63. echo<a class="headerlink" href="#echo" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span></code>：功能是在显示器上显示一段文字，一般起到一个提示的作用。此外，也可以直接在文件中写入要写的内容。也可以用于脚本编程时显示某一个变量的值，或者直接输出指定的字符串。</p></li>
<li><p>语法：`echo [选项] [输出内容]</p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">输出之后不换行</span>
<span class="o">-</span><span class="n">e</span><span class="err">：</span><span class="n">支持反斜线控制的字符转换</span><span class="err">，</span><span class="n">前面有斜线的字符将作为转义字符</span><span class="err">，</span><span class="n">但是需要要有单引号或者双引号包含</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>常用的转义字符
| 转义字符 | 含义 |
| — | — |
| \a | 发出警告声 |
| \b | 删除\b前一个字符 |
| \c | \c后面的字符将不再输出，同时输出完毕后内容也不换行 |
| \f | 换页符，光标停在原来的位置 |
| \n | 换行且光标移至行首 |
| \r | 回车符,光标移至行首，但不换行，相当于使用”\r”以后的字符覆盖”\r”之前同等长度的字符:但是当”\r”后面不存在任何字符时，”\r”前面的字符不会被覆盖 |
| \t | 水平制表符，就是Tab键 |
| \v | 垂直制表符 |
| \ | 插入\字符 |
| \e | Esc键 |
| \0nnn | 按照八进制 ASCII 码表输出字符。其中 0 为数字 0，nnn 是三位八进制数 |
| \xhh | 按照十六进制 ASCH 码表输出字符。其中 hh 是两位十六进制数 |
| \e[A;B;Cm 内容 \e[Am |  A 为格式控制，编号0-9（1标准格式，0表示颜色输出结束）；B 为字体颜色，编号30-37；C 为背景色），编号40-47（与字体颜色对应）； |
| 033[31m 和 \033[0m | ANSI控制码格式：\033[显示方式；前景色；背景色m |</p></li>
<li><p>格式控制
| 代码十进制 | 作用 |
| - - - | - - -|
| 0 | 清除所有格式（常用在格式控制末尾，以免对后序字符串造成影响） |
| 1 | 加粗，与格式2冲突 |
| 2 | 字体变暗，与格式1冲突 |
| 3 | 斜体 |
| 4 | 下划线 |
| 5 | 呼吸闪烁（但有的机器上没效果)） |
| 6 | 同上 |
| 7 | 反显（背景色当前景色，前景色当背景色） |
| 8 | 隐形（字符仍然存在，可以选中，只是看不到） |
| 9 | 删除 |</p></li>
<li><p>向文件添加内容：</p>
<ul class="simple">
<li><p>覆盖：echo 内容 &gt; file</p></li>
<li><p>追加：echo 内容 &gt;&gt; file</p></li>
</ul>
</li>
<li><p>输出命令执行结果</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="err">`</span><span class="n">COMMAND</span><span class="err">`</span>
<span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">COMMAND</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>输出所有文件和文件夹</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">*</span></code>：和<code class="docutils literal notranslate"><span class="pre">ls</span></code>一样</p></li>
</ul>
</li>
<li><p>将内容输出到命令执行的结果中</p>
<ul>
<li><p>echo -e “root/root” | passwd test1：为test1用户修改密码</p></li>
<li><p>给<code class="docutils literal notranslate"><span class="pre">/dev/sdb</span></code>设备划分一个分区</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;n</span>
<span class="n">p</span>
<span class="mi">1</span>

<span class="o">+</span><span class="mi">1</span><span class="n">G</span>
<span class="n">Y</span>
<span class="n">w</span><span class="s2">&quot; | fdisk /dev/sdb</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="tcpdump">
<h2>64. tcpdump<a class="headerlink" href="#tcpdump" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tcpdump</span></code>：dump the traffic on a network，根据使用者的定义对网络上的数据包进行截获的包分析工具。 tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息；</p></li>
<li><p>直接启动tcpdump将监视第一个网络接口上所有流过的数据包；</p></li>
<li><p>语法：tcpdump [options] [file.pcap]</p>
<ul>
<li><p>写入file.pcap,必须跟-w选项,并且文件扩展名必须为pcap</p></li>
<li><p>常用options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">i</span> <span class="nb">any</span><span class="err">：</span><span class="n">监视指定网络接口的数据包</span><span class="err">，</span><span class="n">any表示所有网卡</span><span class="err">，</span><span class="n">如果不指定网卡</span><span class="err">，</span><span class="n">默认tcpdump只会监视第一个网络接口</span>
<span class="o">-</span><span class="n">n</span> <span class="err">：</span><span class="n">不对地址</span><span class="p">(</span><span class="n">比如</span><span class="p">,</span> <span class="n">主机地址</span><span class="p">,</span> <span class="n">端口号</span><span class="p">)</span><span class="n">进行数字表示到名字表示的转换</span>
<span class="o">-</span><span class="n">w</span> <span class="n">file</span><span class="o">.</span><span class="n">pcap</span><span class="err">：</span><span class="n">把包数据直接写入文件而不进行分析和打印输出</span><span class="o">.</span> <span class="n">这些包数据可在随后通过</span><span class="o">-</span><span class="n">r</span> <span class="n">选项来重新读入并进行分析和打印</span>
<span class="o">-</span><span class="n">r</span> <span class="n">file</span><span class="o">.</span><span class="n">pcap</span><span class="err">：</span><span class="n">读取数据内容</span>
<span class="o">-</span><span class="n">s</span> <span class="mi">0</span> <span class="err">：</span> <span class="n">抓取数据包时默认抓取长度为68字节</span><span class="err">。</span><span class="n">加上</span><span class="o">-</span><span class="n">S</span> <span class="mi">0</span> <span class="n">后可以抓到完整的数据包</span>
<span class="o">-</span><span class="n">v</span><span class="err">：</span><span class="n">显示详细信息</span>
<span class="n">host</span> <span class="n">主机名</span><span class="o">/</span><span class="n">ip</span><span class="err">：</span><span class="n">监视指定主机</span><span class="o">/</span><span class="n">ip的数据包</span>
<span class="p">[</span><span class="n">tcp</span><span class="o">/</span><span class="n">udp</span><span class="p">]</span> <span class="n">port</span> <span class="n">端口号</span><span class="err">：</span><span class="n">监视指定</span><span class="p">[</span><span class="n">tcp</span><span class="o">/</span><span class="n">udp</span><span class="p">]</span><span class="n">端口号的数据包</span>
<span class="n">dst</span> <span class="n">host</span> <span class="n">主机名</span><span class="o">/</span><span class="n">ip</span><span class="err">：</span><span class="n">监视指定目的主机</span><span class="o">/</span><span class="n">ip的数据包</span>
<span class="n">src</span> <span class="n">host</span> <span class="n">主机名</span><span class="o">/</span><span class="n">ip</span><span class="err">：</span><span class="n">监视指定源主机</span><span class="o">/</span><span class="n">ip的数据包</span>
<span class="n">dst</span> <span class="n">port</span> <span class="n">端口号</span><span class="err">：</span><span class="n">监视指定目的端口号的数据包</span>
<span class="n">src</span> <span class="n">port</span> <span class="n">端口号</span><span class="err">：</span><span class="n">监视指定源端口号的数据包</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>例：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tcpdump</span> <span class="pre">-i</span> <span class="pre">any</span> <span class="pre">-nv</span> <span class="pre">dst</span> <span class="pre">host</span> <span class="pre">172.30.22.24</span> <span class="pre">and</span> <span class="pre">dst</span> <span class="pre">port</span> <span class="pre">9092</span> <span class="pre">-w</span> <span class="pre">test.pcap</span></code>：监视任意网口，目的主机为172.30.22.24,端口号为9092的数据包,并写入test.pcap文件中</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="nmap">
<h2>65. nmap<a class="headerlink" href="#nmap" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nmap</span></code>基本功能</p>
<ul>
<li><p>检测存活在网络上的设备（设备发现）</p></li>
<li><p>检测开放的端口号（端口发现或枚举）</p></li>
<li><p>检测到相应的端口号（服务发现）的软件和版本</p></li>
<li><p>检测操做系统，硬件地址，以及软件地址</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="top">
<h2>66. top<a class="headerlink" href="#top" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code>命令各行信息解释</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span> <span class="pre">-</span> <span class="pre">15:21:25</span> <span class="pre">up</span> <span class="pre">1</span> <span class="pre">day,</span> <span class="pre">23:20,</span>&#160; <span class="pre">2</span> <span class="pre">users,</span>&#160; <span class="pre">load</span> <span class="pre">average:</span> <span class="pre">0.09,</span> <span class="pre">0.08,</span> <span class="pre">0.01</span></code></p>
<ul>
<li><p>显示的是系统状态信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">-</span> <span class="mi">15</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">25</span><span class="err">：</span><span class="n">系统当前时间</span>
<span class="n">up</span> <span class="mi">1</span> <span class="n">day</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span><span class="mi">20</span><span class="err">：</span><span class="n">系统到目前为止已运行的时间</span>
<span class="mi">2</span> <span class="n">user</span><span class="err">：</span><span class="n">当前登录系统的用户数量</span>
<span class="n">load</span> <span class="n">average</span><span class="p">:</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.01</span><span class="err">：</span><span class="n">系统负载</span><span class="err">（</span><span class="n">任务队列的平均长度</span><span class="err">），</span><span class="mi">3</span><span class="n">个数值分别为1分钟</span><span class="err">、</span><span class="mi">5</span><span class="n">分钟</span><span class="err">、</span><span class="mi">15</span><span class="n">分钟前到现在的平均值</span>
</pre></div>
</div>
</li>
<li><p>ps:<code class="docutils literal notranslate"><span class="pre">top</span></code>给出的系统运行时间，反应了当前系统存活多久，对于某些应用而言，系统需要保证7*24小时的高可用性，这个字段信息就能很好的衡量系统的高可用性。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tasks:</span> <span class="pre">1194</span> <span class="pre">total,</span>&#160;&#160; <span class="pre">1</span> <span class="pre">running,</span> <span class="pre">1193</span> <span class="pre">sleeping,</span>&#160;&#160; <span class="pre">0</span> <span class="pre">stopped,</span>&#160;&#160; <span class="pre">0</span> <span class="pre">zombie</span></code></p>
<ul>
<li><p>显示的是进程状态信息的汇总信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">1194</span> <span class="n">total</span><span class="err">：</span><span class="n">所有启动的进程数</span>
<span class="mi">1</span> <span class="n">running</span><span class="err">：</span><span class="n">正在运行的进程数</span>
<span class="mi">1193</span> <span class="n">sleeping</span><span class="err">：</span><span class="n">挂起的进程数</span>
<span class="mi">0</span> <span class="n">stopped</span><span class="err">：</span><span class="n">停止的进程数</span>
<span class="mi">0</span> <span class="n">zombie</span><span class="err">：</span><span class="n">僵尸进程数</span>
</pre></div>
</div>
</li>
<li><p>在linux操作系统中，一般有以下5种状态的进程信息：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="err">：</span><span class="n">不可中断睡眠态</span><span class="err">（</span><span class="n">通常出现在IO阻塞</span><span class="err">）</span>
<span class="n">R</span><span class="err">：</span><span class="n">运行态</span>
<span class="n">S</span><span class="err">：</span><span class="n">睡眠态</span>
<span class="n">T</span><span class="err">：</span><span class="n">已停止</span>
<span class="n">z</span><span class="err">：</span><span class="n">僵尸态</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">%Cpu(s):</span>&#160; <span class="pre">0.0</span> <span class="pre">us,</span>&#160; <span class="pre">0.0</span> <span class="pre">sy,</span>&#160; <span class="pre">0.0</span> <span class="pre">ni,</span> <span class="pre">99.9</span> <span class="pre">id,</span>&#160; <span class="pre">0.0</span> <span class="pre">wa,</span>&#160; <span class="pre">0.0</span> <span class="pre">hi,</span>&#160; <span class="pre">0.0</span> <span class="pre">si,</span>&#160; <span class="pre">0.0</span> <span class="pre">st</span></code></p>
<ul>
<li><p>显示的是cpu状态信息，表示当前CPU的平均值，默认top命令配置显示的是平均的CPU使用情况，如果按下键盘<code class="docutils literal notranslate"><span class="pre">1</span></code>可以显示各颗逻辑CPU的使用情况。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mf">0.0</span> <span class="n">us</span><span class="err">：</span><span class="n">用户空间占用CPU百分比</span>
<span class="mf">0.0</span> <span class="n">sy</span><span class="err">：</span><span class="n">内核空间占用CPU百分比</span>
<span class="mf">0.0</span> <span class="n">ni</span><span class="err">：</span><span class="n">用户进程空间内改变过优先级的进程占用CPU百分比</span>
<span class="mf">99.9</span> <span class="nb">id</span><span class="err">：</span><span class="n">空闲CPU百分比</span>
<span class="mf">0.0</span> <span class="n">wa</span><span class="err">：</span><span class="n">等待输入输入的CPU百分比</span>
<span class="mf">0.0</span> <span class="n">hi</span><span class="err">：</span><span class="n">硬</span><span class="p">(</span><span class="n">件</span><span class="p">)</span><span class="n">中断占用CPU百分比</span>
<span class="mf">0.0</span> <span class="n">si</span><span class="err">：</span><span class="n">软</span><span class="p">(</span><span class="n">软</span><span class="p">)</span><span class="n">中断CPU百分比</span>
<span class="mf">0.0</span> <span class="n">st</span><span class="err">：</span><span class="n">虚拟CPU等待实际CPU的时间的百分比</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ni</span></code>：优先级（priority）为操作系统用来决定CPU分类的参数，Linux使用（round-robin）的算法来做CPU排程，优先序越高，有可能获得的CPU时间就越多。但是我们可以通过nice命令以更改过的优先序来执行程序，如果未指定程序，则会打印出目前的排程优先序，内定的adjustment为10，范围为-20（最高优先序）到19（最低优先序）。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MiB</span> <span class="pre">Mem</span> <span class="pre">:</span>&#160; <span class="pre">62932.6</span> <span class="pre">total,</span>&#160; <span class="pre">28294.6</span> <span class="pre">free,</span>&#160;&#160; <span class="pre">4589.0</span> <span class="pre">used,</span>&#160; <span class="pre">30049.0</span> <span class="pre">buff/cache</span></code></p>
<ul>
<li><p>显示的是物理内存的状态信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mf">62932.6</span> <span class="n">total</span><span class="err">：</span><span class="n">物理内存总量</span>
<span class="mf">28294.6</span> <span class="n">free</span><span class="err">：</span><span class="n">已经使用的物理内存</span>
<span class="mf">4589.0</span> <span class="n">used</span><span class="err">：</span><span class="n">空闲物理内存</span>
<span class="mf">30049.0</span> <span class="n">buff</span><span class="o">/</span><span class="n">cache</span><span class="err">：</span><span class="n">内核缓存内存</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MiB</span> <span class="pre">Swap:</span>&#160; <span class="pre">22896.0</span> <span class="pre">total,</span>&#160; <span class="pre">22893.2</span> <span class="pre">free,</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">2.8</span> <span class="pre">used.</span>&#160; <span class="pre">54577.7</span> <span class="pre">avail</span> <span class="pre">Mem</span></code></p>
<ul>
<li><p>显示的是虚拟（交换）内存的状态信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mf">22896.0</span> <span class="n">total</span><span class="err">：</span><span class="n">交换区总量</span>
<span class="mf">22893.2</span> <span class="n">free</span><span class="err">：</span><span class="n">已使用交互区总量</span>
<span class="mf">2.8</span> <span class="n">used</span><span class="o">.</span><span class="err">：</span><span class="n">空闲交换区总量</span>
<span class="mf">54577.7</span> <span class="n">avail</span> <span class="n">Mem</span><span class="err">：</span><span class="n">缓冲的交换区总量</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buffer</span></code>和<code class="docutils literal notranslate"><span class="pre">cache</span></code>的作用是所用<code class="docutils literal notranslate"><span class="pre">I/O</span></code>系统调用的时间，比如读写等。一般一个系统而言，如果<code class="docutils literal notranslate"><span class="pre">cache</span></code>的值很大，说明<code class="docutils literal notranslate"><span class="pre">cache</span></code>住的文件多。如果频繁访问文件都能被命中，很明显会比读取磁盘调用快，磁盘的IO必定会减小；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cache</span></code>的命中率很关键，如果频繁访问的文件不能被命中，对于cache而言是个比较的大的资源浪费，此时应考虑<code class="docutils literal notranslate"><span class="pre">drop</span> <span class="pre">cache</span></code>并提升对应的cache的命中率。</p></li>
<li><p>从字段的意义上来说mem.free表示的是空闲内存总量，但是需要注意的是，虽然buffer/cache会占用一定的物理内存，但是当系统需要内存的时候，这些内存立即释放出来，也就是说buffer/cache可以看成可用内存。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PID</span> <span class="pre">USER</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">PR</span>&#160; <span class="pre">NI</span>&#160;&#160;&#160; <span class="pre">VIRT</span>&#160;&#160;&#160; <span class="pre">RES</span>&#160;&#160;&#160; <span class="pre">SHR</span> <span class="pre">S</span>&#160; <span class="pre">%CPU</span>&#160; <span class="pre">%MEM</span>&#160;&#160;&#160;&#160; <span class="pre">TIME+</span> <span class="pre">COMMAND</span> <span class="pre">DATA</span></code></p>
<ul>
<li><p>显示的是进程信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PID</span><span class="err">：</span><span class="n">进程ID</span>
<span class="n">USER</span><span class="err">：</span><span class="n">进程所有者</span>
<span class="n">PR</span><span class="err">：</span><span class="n">优先级</span>
<span class="n">NI</span><span class="err">：</span><span class="n">ice值</span><span class="err">，</span><span class="n">负值表示高优先级</span><span class="err">，</span><span class="n">正值表示低优先级</span>
<span class="n">VIRT</span><span class="err">：</span><span class="n">进程需要的虚拟内存总量</span><span class="p">,</span><span class="n">单位kb</span><span class="p">,</span><span class="n">VIRT</span><span class="o">=</span><span class="n">SWAP</span><span class="o">+</span><span class="n">RES</span>
<span class="c1"># 进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等</span>
<span class="c1"># 假如进程申请100m的内存，但实际只使用了10m，那么它会增长100m，而不是实际的使用量</span>
<span class="n">RES</span><span class="err">：</span><span class="n">进程使用的</span><span class="err">、</span><span class="n">未被换出的物理内存大小</span><span class="err">，</span><span class="n">单位kb</span><span class="p">,</span><span class="n">RES</span><span class="o">=</span><span class="n">CODE</span><span class="o">+</span><span class="n">DATA</span>
<span class="c1"># 进程当前使用的内存大小，但不包括swap out</span>
<span class="c1"># 包含其他进程的共享</span>
<span class="c1"># 如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反</span>
<span class="c1"># 关于库占用内存的情况，它只统计加载的库文件所占内存大小</span>
<span class="n">SHR</span><span class="err">：</span><span class="n">共享内存大小</span><span class="err">，</span><span class="n">单位kb</span>
<span class="n">S</span><span class="err">：</span><span class="n">进程状态</span><span class="err">，</span><span class="n">S</span><span class="p">,</span><span class="n">睡眠态</span>
<span class="o">%</span><span class="n">CPU</span><span class="err">：</span><span class="n">上传更新到现在的CPU时间占用百分比</span>
<span class="o">%</span><span class="n">MEM</span><span class="err">：</span><span class="n">进程使用的物理内存百分比</span>
<span class="n">TIME</span><span class="o">+</span><span class="err">：</span><span class="n">进程使用的CPU时间总计</span><span class="err">，</span><span class="n">单位1</span><span class="o">/</span><span class="mi">100</span><span class="n">秒</span>
<span class="n">COMMAND</span><span class="err">：</span><span class="n">命令名</span><span class="o">/</span><span class="n">命令行</span>
<span class="n">DATA</span><span class="err">：</span><span class="n">数据占用的内存</span><span class="err">。</span><span class="n">如果top没有显示</span><span class="err">，</span><span class="n">按f键可以添加</span>
<span class="c1"># 真正的该程序要求的数据空间，是真正在运行中要使用的</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code>命令</p>
<ul>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">top</span> <span class="pre">[options]</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">以批处理模式操作</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">显示完整的治命令</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">屏幕刷新间隔时间</span>
<span class="o">-</span><span class="n">I</span><span class="err">：</span><span class="n">忽略失效过程</span>
<span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">保密模式</span>
<span class="o">-</span><span class="n">S</span><span class="err">：</span><span class="n">累积模式</span>
<span class="o">-</span><span class="n">i</span><span class="o">&lt;</span><span class="n">时间</span><span class="o">&gt;</span><span class="err">：</span><span class="n">设置间隔时间</span>
<span class="o">-</span><span class="n">u</span><span class="o">&lt;</span><span class="n">用户名</span><span class="o">&gt;</span><span class="err">：</span><span class="n">指定用户名</span>
<span class="o">-</span><span class="n">p</span><span class="o">&lt;</span><span class="n">进程号</span><span class="o">&gt;</span><span class="err">：</span><span class="n">指定进程</span>
<span class="o">-</span><span class="n">n</span><span class="o">&lt;</span><span class="n">次数</span><span class="o">&gt;</span><span class="err">：</span><span class="n">循环显示的次数</span>
</pre></div>
</div>
</li>
<li><p>在运行中可以通过 top 的内部命令对进程的显示方式进行控制。内部命令如下</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="err">–</span> <span class="n">改变画面更新频率</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">如果有小数</span><span class="err">，</span><span class="n">就换算成ms</span><span class="err">。</span><span class="n">输入0值则系统将不断刷新</span>
<span class="n">l</span> <span class="err">–</span> <span class="n">关闭或开启第一部分第一行</span> <span class="n">top</span> <span class="n">信息的表示</span>
<span class="n">t</span> <span class="err">–</span> <span class="n">切换显示cpu信息显示</span><span class="err">，</span><span class="n">关闭或开启第一部分第二行</span> <span class="n">Tasks</span> <span class="n">和第三行</span> <span class="n">Cpus</span> <span class="n">信息的表示</span>
<span class="n">m</span> <span class="err">–</span> <span class="n">切换显示内存信息显示</span><span class="err">，</span><span class="n">关闭或开启第一部分第四行</span> <span class="n">Mem</span> <span class="n">和</span> <span class="n">第五行</span> <span class="n">Swap</span> <span class="n">信息的表示</span>
<span class="n">N</span> <span class="err">–</span> <span class="n">以</span> <span class="n">PID</span> <span class="n">的大小的顺序排列表示进程列表</span>
<span class="n">P</span> <span class="err">–</span> <span class="n">以</span> <span class="n">CPU</span> <span class="n">占用率大小的顺序排列进程列表</span>
<span class="n">M</span> <span class="err">–</span> <span class="n">以内存占用率大小的顺序排列进程列表</span>
<span class="n">h</span> <span class="err">–</span> <span class="n">显示帮助</span>
<span class="n">n</span> <span class="err">–</span> <span class="n">设置在进程列表所显示进程的数量</span>
<span class="n">k</span> <span class="err">–</span> <span class="n">终止一个进程</span><span class="err">，</span><span class="n">输入pid和信号</span>
<span class="n">i</span> <span class="err">–</span> <span class="n">忽略闲置和僵死进程</span>
<span class="n">r</span> <span class="err">–</span> <span class="n">重新安排一个进程的优先级别</span>
<span class="n">f或者F</span> <span class="err">–</span> <span class="n">从当前显示中添加或者删除项目</span><span class="p">,</span><span class="n">空格或d来添加或删除</span><span class="err">，</span><span class="n">s以该项排序显示</span>
<span class="n">c</span> <span class="err">–</span> <span class="n">切换显示命令名称和完整命令行</span>
<span class="n">W</span> <span class="err">–</span> <span class="n">将当前设置写入</span><span class="o">~/.</span><span class="n">toprc文件中</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="watch">
<h2>67. watch<a class="headerlink" href="#watch" title="Link to this heading">¶</a></h2>
<ul>
<li><p>周期性的用来执行某命令，并把某命令执行结果输出到屏幕上。使用watch命令，可以周期性的监测并输出某命令的执行结果到屏幕上，省得手动一遍一遍运行某命令，提高工作效率</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">watch</span> <span class="pre">[options]</span> <span class="pre">&quot;COMMAND&quot;</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">n</span><span class="err">：</span><span class="n">设置watch时间间隔</span><span class="err">，</span><span class="n">默认为2s</span>
<span class="o">-</span><span class="n">d</span><span class="err">：</span><span class="n">高亮显示变化的区域</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">不显示顶部的时间间隔信息</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="read">
<h2>68. read<a class="headerlink" href="#read" title="Link to this heading">¶</a></h2>
<ul>
<li><p>为变量着色：终止并重新启动转义序列，从而将变量扩展移到外部</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmd</span><span class="o">=</span><span class="s2">&quot;Enter something&quot;</span>
<span class="n">read</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="s1">&#39;\e[31m&#39;</span><span class="s2">&quot;$</span><span class="si">{mmd}</span><span class="s2">&quot;</span><span class="err">$</span><span class="s1">&#39;\e[0m: &#39;</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ipmitool">
<h2>69. ipmitool<a class="headerlink" href="#ipmitool" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipmitool</span> <span class="pre">sdr</span> <span class="pre">[list]</span></code>：打印传感器信息和状态</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SYS_FAN1</span>         <span class="o">|</span> <span class="mi">4100</span> <span class="n">RPM</span>          <span class="o">|</span> <span class="n">ok</span>
<span class="n">Air_Inlet_Temp1</span>  <span class="o">|</span> <span class="mf">29.50</span> <span class="n">degrees</span> <span class="n">C</span>   <span class="o">|</span> <span class="n">ok</span>
<span class="n">PSU1_Status</span>      <span class="o">|</span> <span class="mh">0x00</span>              <span class="o">|</span> <span class="n">ok</span>
</pre></div>
</div>
<ul class="simple">
<li><p>第一列是传感器的名称；</p></li>
<li><p>第二列是传感器的值（比如传感器的问题，如果是风扇的话就是转速，电源的话就是电压了）；</p></li>
<li><p>第三列就是传感器的状态。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipmitool</span> <span class="pre">sdr</span> <span class="pre">type</span> <span class="pre">&quot;power</span> <span class="pre">supply&quot;</span></code>：获取电源状态信息</p>
<ul>
<li><p>正常情况下的电源状态：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PS1</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C4h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.1</span> <span class="o">|</span> <span class="n">Presence</span> <span class="n">detected</span>
<span class="n">PS2</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C5h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.2</span> <span class="o">|</span> <span class="n">Presence</span> <span class="n">detected</span>
<span class="c1"># Presence detected 检测到存在</span>
</pre></div>
</div>
</li>
<li><p>其中一个拔掉电源插头，状态就会如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PS1</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C4h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.1</span> <span class="o">|</span> <span class="n">Presence</span> <span class="n">detected</span>
<span class="n">PS2</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C5h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.2</span> <span class="o">|</span> <span class="n">Presence</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Failure</span> <span class="n">detected</span><span class="p">,</span> <span class="n">Power</span> <span class="n">Supply</span> <span class="n">AC</span> <span class="n">lost</span>
</pre></div>
</div>
</li>
<li><p>如果我们将其中一个的电源模块(PSU, power supply unit)直接从服务器上拔出，状态就会如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PS1</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C4h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.1</span> <span class="o">|</span> <span class="n">Presence</span> <span class="n">detected</span>
<span class="n">PS2</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">C5h</span> <span class="o">|</span> <span class="n">ok</span> <span class="o">|</span> <span class="mf">10.2</span> <span class="o">|</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="history">
<h2>70. history<a class="headerlink" href="#history" title="Link to this heading">¶</a></h2>
<ul>
<li><p>历史命令是被保存在<code class="docutils literal notranslate"><span class="pre">内存和~/.bash_history</span></code>中;当退出或者登录shell时,会自动保存或读取</p></li>
<li><p>环境变量：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTCONTROL</span></code>：控制历史命令的记录方式。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTCONTROL</span></code>有以下的选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ignoredups</span><span class="err">：</span><span class="n">默认</span><span class="err">，</span><span class="n">忽略重复命令</span>
<span class="n">ignorespace</span><span class="err">：</span><span class="n">忽略所有以空格开头的命令</span>
<span class="n">ignoreboth</span><span class="err">：</span><span class="n">ignoredups</span> <span class="n">和</span> <span class="n">ignorespace</span> <span class="n">的组合</span>
<span class="n">erasedups</span><span class="err">：</span><span class="n">删除历史记录中重复命令</span><span class="err">，</span><span class="n">相同的指令仅保留最近的一个</span>
</pre></div>
</div>
</li>
<li><p>如果同时设定多个选项，中间使用冒号隔开：<code class="docutils literal notranslate"><span class="pre">HISTCONTROL=ignorespace:erasedups</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTFILE</span></code>： 记录<code class="docutils literal notranslate"><span class="pre">history</span></code>历史命令记录文件的位置,要有读写权限,默认是<code class="docutils literal notranslate"><span class="pre">~/.bash_history</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chattr</span> <span class="pre">+a</span> <span class="pre">~/.bash_history</span></code> 即append,设定该参数后,只能向文件中添加数据,而不能删除</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTSIZE</span></code>： 命令缓冲区的大小</p>
<ul class="simple">
<li><p>当启动一个shell时，shell会从<code class="docutils literal notranslate"><span class="pre">~/.bash_history</span></code>文件中读取历史记录，存储到相应内存的缓冲区。我们平时执行的命令，都会记录在缓冲区中，包括<code class="docutils literal notranslate"><span class="pre">history</span></code>所执行的历史命令管理，都是在操作缓冲区，而不是直接操作<code class="docutils literal notranslate"><span class="pre">~/.bash_history</span></code>文件。</p></li>
<li><p>执行的命令先记录在命令缓冲区,在缓冲区满或退出shell时才将命令写入<code class="docutils literal notranslate"><span class="pre">$HISTFILE</span></code></p></li>
<li><p>禁用 <code class="docutils literal notranslate"><span class="pre">history</span></code>:<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">HISTSIZE=0</span></code>，此时<code class="docutils literal notranslate"><span class="pre">history</span></code>无输出,并且<code class="docutils literal notranslate"><span class="pre">ctrl+r</span></code>不生效</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTTIMEFORMAT</span></code>：使<code class="docutils literal notranslate"><span class="pre">history</span></code>命令格式化输出历史命令</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTCMD</span></code>：记录下一个命令在history命令中的编号</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="mi">103</span> <span class="o">~</span><span class="p">]</span><span class="c1"># history | tail -n 1</span>
  <span class="mi">245</span>  <span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span> <span class="mi">16</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">09</span> <span class="n">root</span> <span class="mi">103</span> <span class="n">history</span> <span class="o">|</span> <span class="n">tail</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="c1"># 当前命令编号为245</span>
  <span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="mi">103</span> <span class="o">~</span><span class="p">]</span><span class="c1"># echo $HISTCMD  # 执行该命令编号为246，所以下一个命令编号为247</span>
  <span class="mi">247</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTFILESIZE</span></code>： 设置`HISTFILE文件记录命令的行数,限制历史命令记录的行数</p>
<ul class="simple">
<li><p>定义了在文件<code class="docutils literal notranslate"><span class="pre">~/.bash_history</span></code>中保存命令的记录总数</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTIGNORE</span></code>: 忽略历史中的特定命令</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="man">
<h2>71. man<a class="headerlink" href="#man" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">7</span> <span class="pre">signal</span></code>:查看第7节中关于 signal 的手册页条目。</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="vim">
<h2>72. vim？？？？？？？？<a class="headerlink" href="#vim" title="Link to this heading">¶</a></h2>
<ul>
<li><p>在<code class="docutils literal notranslate"><span class="pre">～/.vimrc</span></code>或<code class="docutils literal notranslate"><span class="pre">/etc/vimrc</span></code>中设置变量，使编辑器有不同的效果，也可以在vim编辑文件时<code class="docutils literal notranslate"><span class="pre">:set</span> <span class="pre">var</span></code>临时设置：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">noswapfile</span><span class="err">：</span><span class="n">禁用交换文件</span>
<span class="nb">set</span> <span class="n">tabstop</span><span class="o">=</span><span class="mi">4</span><span class="err">：</span><span class="n">设置制表符宽度</span><span class="err">（</span><span class="n">以空格数量表示</span><span class="err">）</span>
<span class="nb">set</span> <span class="n">hlsearch</span><span class="err">：</span><span class="n">高亮搜索内容的所有匹配位置</span>
<span class="nb">set</span> <span class="n">incsearch</span><span class="err">：</span><span class="n">搜索过程中动态显示匹配内容</span>
<span class="nb">set</span> <span class="n">laststatus</span><span class="o">=</span><span class="mi">2</span><span class="err">：</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="utmpdump">
<h2>73. utmpdump<a class="headerlink" href="#utmpdump" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">utmp/wtmp/btmp</span></code>日志</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/var/run/utmp</span></code>：用于记录当前打开的会话，被<code class="docutils literal notranslate"><span class="pre">who</span></code>和<code class="docutils literal notranslate"><span class="pre">w</span></code>工具用来记录当前有谁登录以及他们正在做什么，而<code class="docutils literal notranslate"><span class="pre">uptime</span></code>用来记录启动时间；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code>：用于存储系统连接历史记录，被<code class="docutils literal notranslate"><span class="pre">last</span></code>工具用来记录最后登录的用户的列表；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/btmp</span></code>：记录登录失败的尝试，被<code class="docutils literal notranslate"><span class="pre">lastb</span></code>工具用来记录最后失败的登录尝试的列表。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">utmpdump</span></code>的使用</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">utmpdump</span></code>来自<code class="docutils literal notranslate"><span class="pre">sysvinit-tools</span></code>包，可以用来转储二进制日志文件到文本格式的文件以便检查。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utmpdump</span> <span class="pre">/var/run/utmp</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">00000</span><span class="p">]</span> <span class="p">[</span><span class="o">~~</span>  <span class="p">]</span> <span class="p">[</span><span class="n">reboot</span>  <span class="p">]</span> <span class="p">[</span><span class="o">~</span>           <span class="p">]</span> <span class="p">[</span><span class="mf">4.19.0</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">linx</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">amd64</span><span class="p">]</span> <span class="p">[</span><span class="mf">0.0.0.0</span>        <span class="p">]</span> <span class="p">[</span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span><span class="n">T00</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">817825</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">00053</span><span class="p">]</span> <span class="p">[</span><span class="o">~~</span>  <span class="p">]</span> <span class="p">[</span><span class="n">runlevel</span><span class="p">]</span> <span class="p">[</span><span class="o">~</span>           <span class="p">]</span> <span class="p">[</span><span class="mf">4.19.0</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">linx</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">amd64</span><span class="p">]</span> <span class="p">[</span><span class="mf">0.0.0.0</span>        <span class="p">]</span> <span class="p">[</span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span><span class="n">T00</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="mi">051217</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">00744</span><span class="p">]</span> <span class="p">[</span><span class="n">tty1</span><span class="p">]</span> <span class="p">[</span><span class="n">LOGIN</span>   <span class="p">]</span> <span class="p">[</span><span class="n">tty1</span>        <span class="p">]</span> <span class="p">[</span>                    <span class="p">]</span> <span class="p">[</span><span class="mf">0.0.0.0</span>        <span class="p">]</span> <span class="p">[</span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span><span class="n">T00</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="mi">937466</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>第一个字段显示了会话识别符</p></li>
<li><p>第二个字段是PID</p></li>
<li><p>第三个字段可以是：–（表示运行等级改变或系统重启）；bw（启动守护进程）；数字（表示TTY编号）；字符或数字（表示伪终端）</p></li>
<li><p>第四个字段可以为：空；用户名；重启；运行级别</p></li>
<li><p>第五个字段是主TTY或PTY（伪终端）</p></li>
<li><p>第六个字段是远程主机名，本地登录该字段为空，运行级别信息除外，他会返回内核版本</p></li>
<li><p>第七个字段是远程系统的IP地址，本地登录，该字段为0.0.0.0。如果没有提供DNS解析，第六和第七字段会显示相同的信息（远程IP地址）</p></li>
<li><p>第八个字段指明了该记录创建的日期和时间</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="timedatectl">
<h2>74. timedatectl<a class="headerlink" href="#timedatectl" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>查看当前时区：</p>
<ul>
<li><p>方法一：<code class="docutils literal notranslate"><span class="pre">timedatectl</span></code></p></li>
<li><p>方法二：<code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/etc/localtime</span></code></p></li>
</ul>
</li>
<li><p>修改时区：</p>
<ul>
<li><p>查看可选时区：<code class="docutils literal notranslate"><span class="pre">timedatectl</span> <span class="pre">list-timezones</span></code></p></li>
<li><p>设置时区：</p>
<ul>
<li><p>方法一：<code class="docutils literal notranslate"><span class="pre">timedatectl</span> <span class="pre">set-timezone</span> <span class="pre">&lt;time_zone&gt;</span></code></p>
<ul>
<li><p>如：<code class="docutils literal notranslate"><span class="pre">timedatectl</span> <span class="pre">set-timezone</span> <span class="pre">America/New_York</span></code></p></li>
</ul>
</li>
<li><p>方法二：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">/etc/localtime</span> <span class="pre">/etc/localtime.bak</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/usr/share/zoneinfo/Asia/Shanghai</span> <span class="pre">/etc/localtime</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>CTS：Asia/Shanghai</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="ping">
<h2>75. ping<a class="headerlink" href="#ping" title="Link to this heading">¶</a></h2>
<ul>
<li></li>
<li><p>常用参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">M</span> <span class="n">do</span><span class="err">：</span><span class="n">不允许分片</span><span class="p">,</span><span class="n">甚至不允许在本地分片</span>
<span class="o">-</span><span class="n">M</span> <span class="n">want</span><span class="err">：</span><span class="n">找出PMTU</span><span class="err">，</span><span class="n">如果包太大的就在本地分片</span><span class="err">。</span><span class="n">PMTU</span><span class="err">（</span><span class="n">路径MTU</span><span class="err">）：</span><span class="n">一种动态发现网络上任意一条路径的最大传输单元的技术</span>
<span class="o">-</span><span class="n">M</span> <span class="n">dont</span><span class="err">：</span><span class="n">不要设置IP首部的DF位</span><span class="err">，</span><span class="n">即允许分片</span>
<span class="o">-</span><span class="n">s</span> <span class="n">packetsize</span><span class="err">：</span><span class="n">指定要发送数据的字节量</span><span class="err">。</span><span class="n">缺省值为</span> <span class="mi">56</span> <span class="err">，</span><span class="n">这正好在添加了</span> <span class="mi">8</span> <span class="n">字节的</span> <span class="n">ICMP</span> <span class="n">首部后组装成</span> <span class="mi">64</span> <span class="n">字节的</span> <span class="n">ICMP</span> <span class="n">数据报</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="xxd">
<h2>76. xxd<a class="headerlink" href="#xxd" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">xxd</span></code>：主要用来查看文件对应的十六进制形式，也可以将文件对应的十六进制形式输出到一个指定的文件。</p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span> <span class="p">:</span> <span class="n">它的作用是自动跳过空白内容</span><span class="err">，</span><span class="n">默认是关闭的</span><span class="err">；</span>
<span class="o">-</span><span class="n">c</span> <span class="p">:</span> <span class="n">它的后面加上数字表示每行显示多少字节的十六进制数</span><span class="err">，</span><span class="n">默认是16bytes</span><span class="err">，</span><span class="n">最大是256bytes</span><span class="err">；</span>
<span class="o">-</span><span class="n">g</span> <span class="p">:</span> <span class="n">设定以几个字节为一块</span><span class="err">，</span><span class="n">默认为2bytes</span><span class="err">；</span>
<span class="o">-</span><span class="n">l</span> <span class="p">:</span> <span class="n">显示多少字节的内容</span><span class="err">；</span>
<span class="o">-</span><span class="n">s</span> <span class="p">:</span> <span class="n">后面接</span><span class="err">【±】</span><span class="n">和address</span><span class="err">。“</span><span class="o">+</span><span class="err">”</span><span class="n">表示从地址处开始的内容</span><span class="err">，“</span><span class="o">-</span><span class="err">”</span><span class="n">表示距末尾address开始的内容</span><span class="err">；</span>
<span class="o">-</span><span class="n">b</span> <span class="p">:</span> <span class="n">以二进制</span><span class="err">（</span><span class="mi">0</span> <span class="ow">or</span> <span class="mi">1</span><span class="err">）</span><span class="n">的形式查看文件内容</span><span class="err">；</span>
<span class="o">-</span><span class="n">p</span> <span class="p">:</span> <span class="n">以</span> <span class="n">postscript</span> <span class="n">的连续十六进制转储输出</span><span class="err">，</span><span class="n">这也叫做纯十六进制转储</span><span class="err">。</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id16">
<h2>77. 文件 相关命令<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<section id="iconv">
<h3>77.1. iconv<a class="headerlink" href="#iconv" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">iconv</span></code>：转换给定文件的编码。</p>
<ul class="simple">
<li><p>用法： iconv [选项…] [文件…]</p></li>
<li><p>常用选项：</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">指定源文件的字符编码</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">指定目标文件的字符编码</span>
<span class="o">-</span><span class="n">c</span><span class="err">：</span><span class="n">当遇到无法转换的字符是</span><span class="err">，</span><span class="n">忽略错误并继续转换</span>
<span class="o">-</span><span class="n">o</span><span class="err">：</span><span class="n">输出文件</span><span class="err">，</span><span class="n">如果未指定输出文件</span><span class="err">，</span><span class="n">则将结果输出到标准输出</span><span class="err">（</span><span class="n">stdout</span><span class="err">）</span>
<span class="o">-</span><span class="n">s</span><span class="err">：</span><span class="n">静默模式</span><span class="err">，</span><span class="n">不显示警告和错误信息</span>
<span class="o">--</span><span class="n">verbose</span><span class="err">：</span><span class="n">打印进度信息</span>
<span class="o">-</span><span class="n">V</span><span class="err">：</span><span class="n">打印程序版本号</span>
<span class="o">-</span><span class="n">l</span><span class="err">：</span><span class="n">列出支持的字符集</span>
</pre></div>
</div>
</li>
<li><p>例：将utf-8编码的文件utf8.txt转换为gb18030编码,并输出为文件gb18030.txt
<code class="docutils literal notranslate"><span class="pre">iconv</span> <span class="pre">-f</span> <span class="pre">utf8</span> <span class="pre">-t</span> <span class="pre">gb18030</span> <span class="pre">utf8.txt</span> <span class="pre">-o</span> <span class="pre">gb18030.txt</span></code></p></li>
</ul>
</section>
<section id="file">
<h3>77.2. file<a class="headerlink" href="#file" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">file</span></code>：用于检测文件类型，根据文件的二进制数据来确定其类型</p></li>
</ul>
</section>
<section id="string">
<h3>77.3. string<a class="headerlink" href="#string" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code>：在对象文件或二进制文件中查找可打印的字符串</p></li>
</ul>
<hr class="docutils" />
</section>
</section>
<hr class="docutils" />
<section id="id17">
<h2>78. 磁盘相关命令<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h2>
<section id="wipefs">
<h3>78.1. wipefs<a class="headerlink" href="#wipefs" title="Link to this heading">¶</a></h3>
<ul>
<li><p>每个磁盘和分区都有某种签名和元数据，使用<code class="docutils literal notranslate"><span class="pre">wipefs</span></code>可以查看/清除文件系统、raid或分区表签名/元数据。</p></li>
<li><p>用法：``wipefs [options] <device></p>
<ul>
<li><p>常用选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 不加任何选项查看磁盘当前签名</span>
<span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">擦除磁盘的签名</span>
<span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">强制擦除</span>
<span class="o">-</span><span class="n">b</span><span class="err">：</span><span class="n">备份签名到</span><span class="err">$</span><span class="n">HOME目录下</span>
	<span class="c1"># 查看签名：wipefs /dev/sdb1</span>
		  <span class="n">DEVICE</span> <span class="n">OFFSET</span> <span class="n">TYPE</span> <span class="n">UUID</span>                                 <span class="n">LABEL</span>
		  <span class="n">sdb1</span>   <span class="mh">0x438</span>  <span class="n">ext4</span> <span class="mi">9709</span><span class="n">acfb</span><span class="o">-</span><span class="mi">2</span><span class="n">de5</span><span class="o">-</span><span class="mi">43</span><span class="n">a1</span><span class="o">-</span><span class="mi">9</span><span class="n">c69</span><span class="o">-</span><span class="n">be3d2b9af7e2</span> 
	<span class="c1"># 擦除签名并备份：wipefs -a -f -b /dev/sdb1</span>
			<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span><span class="p">:</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">were</span> <span class="n">erased</span> <span class="n">at</span> <span class="n">offset</span> <span class="mh">0x00000438</span> <span class="p">(</span><span class="n">ext4</span><span class="p">):</span> <span class="mi">53</span> <span class="n">ef</span>
	<span class="c1"># 查看签名（无任何信息）：wipefs /dev/sdb1</span>
	<span class="c1"># 恢复签名：dd if=~/wipefs-sdb1-0x00000438.bak of=/dev/sdb1 seek=$((0x00000438)) bs=1 conv=notrunc</span>
	<span class="c1"># 查看磁盘签名(已恢复，与擦除前一致)：wipefs /dev/sdb1</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="pvs">
<h3>78.2. pvs<a class="headerlink" href="#pvs" title="Link to this heading">¶</a></h3>
</section>
<section id="pvcreate">
<h3>78.3. pvcreate<a class="headerlink" href="#pvcreate" title="Link to this heading">¶</a></h3>
</section>
<section id="pvremove">
<h3>78.4. pvremove<a class="headerlink" href="#pvremove" title="Link to this heading">¶</a></h3>
</section>
<section id="vgs">
<h3>78.5. vgs<a class="headerlink" href="#vgs" title="Link to this heading">¶</a></h3>
</section>
<section id="vgcreate">
<h3>78.6. vgcreate<a class="headerlink" href="#vgcreate" title="Link to this heading">¶</a></h3>
</section>
<section id="vgremove">
<h3>78.7. vgremove<a class="headerlink" href="#vgremove" title="Link to this heading">¶</a></h3>
</section>
<section id="lvs">
<h3>78.8. lvs<a class="headerlink" href="#lvs" title="Link to this heading">¶</a></h3>
</section>
<section id="lvcreate">
<h3>78.9. lvcreate<a class="headerlink" href="#lvcreate" title="Link to this heading">¶</a></h3>
</section>
<section id="lvremove">
<h3>78.10. lvremove<a class="headerlink" href="#lvremove" title="Link to this heading">¶</a></h3>
</section>
<section id="mdadm">
<h3>78.11. mdadm<a class="headerlink" href="#mdadm" title="Link to this heading">¶</a></h3>
</section>
<section id="vgdisplay">
<h3>78.12. vgdisplay<a class="headerlink" href="#vgdisplay" title="Link to this heading">¶</a></h3>
</section>
<section id="pvmove">
<h3>78.13. pvmove<a class="headerlink" href="#pvmove" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mdadm</span></code>：即”multipe devices admin”,它的主要功能是用来管理RAID磁盘阵列组，是linux系统中实现软raid设备的命令，可以进行创建，调整，监控，删除等全套管理操作。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">mdadm</span> <span class="pre">[模式]</span> <span class="pre">[磁盘阵列]</span> <span class="pre">[参数]</span> <span class="pre">设备名</span></code></p>
<ul>
<li><p>基本参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="hdparm">
<h3>78.14. hdparm<a class="headerlink" href="#hdparm" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="renice">
<h2>79. renice<a class="headerlink" href="#renice" title="Link to this heading">¶</a></h2>
</section>
<section id="sar">
<h2>80. sar<a class="headerlink" href="#sar" title="Link to this heading">¶</a></h2>
</section>
<section id="swap-off">
<h2>81. swap off<a class="headerlink" href="#swap-off" title="Link to this heading">¶</a></h2>
</section>
<section id="netdata">
<h2>82. netdata<a class="headerlink" href="#netdata" title="Link to this heading">¶</a></h2>
</section>
<section id="quota">
<h2>83. quota<a class="headerlink" href="#quota" title="Link to this heading">¶</a></h2>
</section>
<section id="dump">
<h2>84. dump<a class="headerlink" href="#dump" title="Link to this heading">¶</a></h2>
</section>
<section id="restore">
<h2>85. restore<a class="headerlink" href="#restore" title="Link to this heading">¶</a></h2>
</section>
<section id="sos">
<h2>86. sos<a class="headerlink" href="#sos" title="Link to this heading">¶</a></h2>
</section>
<section id="aide">
<h2>87. aide<a class="headerlink" href="#aide" title="Link to this heading">¶</a></h2>
</section>
<section id="suricata">
<h2>88. suricata<a class="headerlink" href="#suricata" title="Link to this heading">¶</a></h2>
</section>
<section id="jq">
<h2>89. jq<a class="headerlink" href="#jq" title="Link to this heading">¶</a></h2>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="gnone">
<h2>90. gnone桌面相关命令<a class="headerlink" href="#gnone" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gsettings</span> <span class="pre">get</span> <span class="pre">org.mate.screensaver</span> <span class="pre">lock-delay</span></code>：获取锁屏延迟时间</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gsettings</span> <span class="pre">set</span> <span class="pre">org.mate.screensaver</span> <span class="pre">lock-delay</span> <span class="pre">0</span></code>：设置锁屏延迟时间为0,息屏即锁屏</p></li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="rev">
<h2>91. rev<a class="headerlink" href="#rev" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rev</span></code>:将文件中的每行内容以字符为单位反向输出，即第一个字符最后输出，最后一个字符最先输出。</p></li>
<li><p>例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">echo</span> <span class="s2">&quot;1234&quot;</span> <span class="o">|</span> <span class="n">rev</span> <span class="c1"># 输出：4321</span>

 <span class="n">echo</span> <span class="s2">&quot;反向输出&quot;</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span>
 <span class="n">rev</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span>   <span class="c1"># 输出：出输向反</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
</section>
<hr class="docutils" />
<section id="type">
<h2>92. type<a class="headerlink" href="#type" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>：显示命令类型的信息。</p></li>
<li><p>语法：<code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">[-afptP]</span> <span class="pre">名称</span> <span class="pre">[名称</span> <span class="pre">...]</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span><span class="err">：</span><span class="n">显示命令</span><span class="err">（</span><span class="n">别名</span><span class="err">、</span><span class="n">内建</span><span class="err">、</span><span class="n">函数</span><span class="err">，</span><span class="n">外部命令</span><span class="err">，</span><span class="n">关键字</span><span class="err">）</span><span class="n">的所有内容</span>
<span class="o">-</span><span class="n">f</span><span class="err">：</span><span class="n">抑制</span> <span class="n">shell</span> <span class="n">函数查询</span>
<span class="o">-</span><span class="n">P</span><span class="err">：</span><span class="n">显示命令</span><span class="err">（</span><span class="n">别名</span><span class="err">、</span><span class="n">内建</span><span class="err">、</span><span class="n">函数</span><span class="err">、</span><span class="n">外部命令</span><span class="err">）</span><span class="n">的路径</span>
<span class="o">-</span><span class="n">p</span><span class="err">：</span><span class="n">从PATH路径搜索</span><span class="err">，</span><span class="n">返回外部命令</span><span class="err">（</span><span class="n">file</span><span class="err">）</span><span class="n">的路径</span><span class="err">，</span><span class="n">当type</span> <span class="o">-</span><span class="n">t</span> <span class="n">NAME不返回file时不返回任何值</span>
<span class="o">-</span><span class="n">t</span><span class="err">：</span><span class="n">返回下列词中的任何一个alias</span><span class="err">、</span><span class="n">keyword</span><span class="err">、</span><span class="n">function</span><span class="err">、</span><span class="n">builtin</span><span class="err">、</span><span class="n">file</span><span class="err">、</span><span class="n">无返回值</span>
	<span class="c1"># alias:别名；</span>
	<span class="c1"># keyword:关键字(shell保留字)；</span>
	<span class="c1"># function: shell函数</span>
	<span class="c1"># builtin： shell内建命令</span>
	<span class="c1"># file：磁盘文件（外部命令）</span>
	<span class="c1"># 无返回值：没有找到该命令</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
<hr class="docutils" />
<ul class="simple">
<li><p>为什么要修改网卡名称</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Py’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CommonProblem.html" class="btn btn-neutral float-right" title="常见问题" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, wl.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>